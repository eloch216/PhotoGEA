<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Analyzing TDL Data • PhotoGEA</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analyzing TDL Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    padding-top: 70px;

    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PhotoGEA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/PhotoGEA.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/analyzing_ball_berry_data.html">Analyzing Ball-Berry Data</a></li>
    <li><a class="dropdown-item" href="../articles/analyzing_c3_aci_curves.html">Analyzing C3 A-Ci Curves</a></li>
    <li><a class="dropdown-item" href="../articles/analyzing_c4_aci_curves.html">Analyzing C4 A-Ci Curves</a></li>
    <li><a class="dropdown-item" href="../articles/analyzing_gm_data.html">Analyzing Mesophyll Conductance Data</a></li>
    <li><a class="dropdown-item" href="../articles/analyzing_tdl_data.html">Analyzing TDL Data</a></li>
    <li><a class="dropdown-item" href="../articles/combining_with_other_packages.html">Combining PhotoGEA With Other Packages</a></li>
    <li><a class="dropdown-item" href="../articles/creating_your_own_processing_tools.html">Creating Your Own Processing Tools</a></li>
    <li><a class="dropdown-item" href="../articles/developing_a_data_analysis_pipeline.html">Developing a Data Analysis Pipeline</a></li>
    <li><a class="dropdown-item" href="../articles/working_with_extended_data_frames.html">Working With Extended Data Frames</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/eloch216/PhotoGEA/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Analyzing TDL Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/eloch216/PhotoGEA/blob/v1.0.0/vignettes/analyzing_tdl_data.Rmd" class="external-link"><code>vignettes/analyzing_tdl_data.Rmd</code></a></small>
      <div class="d-none name"><code>analyzing_tdl_data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>In this vignette, we will give an example showing how to analyze data
from a tunable diode laser (TDL) using the <code>PhotoGEA</code>
package. The commands in this vignette can be used to initialize your
own script, as described in <a href="#customizing-your-script">Customizing Your Script</a>.</p>
</div>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>Because the process of photosynthesis tends to preferentially
assimilate <sup>12</sup>C more often than the rarer and heavier stable
isotope <sup>13</sup>C, carbon isotope discrimination measurements have
proven to be incredibly useful in the fields of plant biology and
climate science <span class="citation">(<a href="#ref-evans_temperature_2013">Evans and Caemmerer 2013</a>)</span>.
Although several methods are available for measuring the relative
concentrations of <sup>12</sup>C and <sup>13</sup>C gas mixtures,
tunable diode laser (TDL) absorption spectroscopy has emerged as one of
the most popular due to its high sensitivity and relatively short
measurement times. In this technique, the emission wavelength of the
laser is tuned over the characteristic absorption lines of species
present in a gas, and the resulting decrease in light transmission can
be used to determine the gas concentration and even other properties
such as temperature. For more information about the general technique,
please see its <a href="https://en.wikipedia.org/wiki/Tunable_diode_laser_absorption_spectroscopy" class="external-link">Wikipedia
page</a>.</p>
<p>The gas concentrations reported directly by a TDL measurement system
tend to be influenced by electrical noise and subtle changes in air
properties within the measurement room. For this reason, it is usually
necessary to make frequent measurements of gas mixtures with known
concentrations so the output signals can be calibrated. In fact, most
TDL systems used in plant biology include a gas handling system with
multiple valves that can be attached to various gas sources, including
calibration tanks as well as the lines with gas whose isotopic makeup is
to be determined. During measurement, the gas handling system
periodically cycles through each valve in succession, and a data logger
is used to record the TDL output signal from each valve. These “TDL
cycles” are the basic unit of a TDL measurement. A typical output file
from a TDL being used for carbon isotope discrimination measurements
therefore includes the following columns (at minimum): time stamp, valve
number, raw <sup>12</sup>C concentration, and raw <sup>13</sup>C
concentration.</p>
<p>To analyze such a data set, it is necessary to identify the
individual TDL cycles within the entire set and use the calibration
valves to determine accurate gas concentrations in the other valves.
Additional operations may also be required, such as removing cycles that
seem to be unreliable or smoothing the data before calibration to
decrease noise. In this vignette, we will demonstrate several tools from
the <code>PhotoGEA</code> package that can help to streamline these
operations in the R environment.</p>
</div>
<div class="section level2">
<h2 id="loading-packages">Loading Packages<a class="anchor" aria-label="anchor" href="#loading-packages"></a>
</h2>
<p>As always, the first step is to load the packages we will be using.
In addition to <code>PhotoGEA</code>, we will also use the
<code>lattice</code> package for generating plots.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/eloch216/PhotoGEA" class="external-link">PhotoGEA</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lattice.r-forge.r-project.org/" class="external-link">lattice</a></span><span class="op">)</span></span></code></pre></div>
<p>If the <code>lattice</code> package is not installed on your R setup,
you can install it by typing
<code>install.packages('lattice')</code>.</p>
</div>
<div class="section level2">
<h2 id="loading-tdl-data">Loading TDL Data<a class="anchor" aria-label="anchor" href="#loading-tdl-data"></a>
</h2>
<p>The <code>PhotoGEA</code> package includes two files representing TDL
data that was recorded with a Campbell Scientific CR3000 data logger on
two consecutive days. Although these two files are based on real data,
noise was added to it since it is unpublished, so these files should
only be used as examples.</p>
<p>The files will be stored on your computer somewhere in your R package
installation directory, and full paths to these files can be obtained
with <code>PhotoGEA_example_file_path</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define a vector of paths to the files we wish to load; in this case, we are</span></span>
<span><span class="co"># loading example files included with the PhotoGEA package</span></span>
<span><span class="va">file_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/PhotoGEA_example_file_path.html">PhotoGEA_example_file_path</a></span><span class="op">(</span><span class="st">'tdl_sampling_1.dat'</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/PhotoGEA_example_file_path.html">PhotoGEA_example_file_path</a></span><span class="op">(</span><span class="st">'tdl_sampling_2.dat'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>(<strong>Note:</strong> When loading your own files for analysis, it
is not advisable to use <code>PhotoGEA_example_file_path</code> as we
have done here. Instead, file paths can be directly written, or files
can be chosen using an interactive window. See <a href="#input-files">Input Files</a> below for more information.)</p>
<p>To actually read the data in the files and store them in R objects,
we will use the <code>read_gasex_file</code> function from
<code>PhotoGEA</code>. Since there are multiple files to read, we will
call this function once for each file using <code>lapply</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load each file, storing the result in a list</span></span>
<span><span class="va">tdl_exdf_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">file_paths</span>, <span class="kw">function</span><span class="op">(</span><span class="va">fpath</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/read_gasex_file.html">read_gasex_file</a></span><span class="op">(</span><span class="va">fpath</span>, <span class="st">'TIMESTAMP'</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>The result from this command is an R list of “extended data frames”
(abbreviated as <code>exdf</code> objects). The <code>exdf</code> class
is a special data structure defined by the <code>PhotoGEA</code>
package. In many ways, an <code>exdf</code> object is equivalent to a
data frame, with the major difference being that an <code>exdf</code>
object includes the units of each column. For more information, type
<code><a href="../reference/exdf.html">?exdf</a></code> in the R terminal to access the built-in help menu
entry, or check out the <a href="working_with_extended_data_frames.html">Working With Extended Data
Frames</a> vignette.</p>
<p>Generally, it is more convenient to work with a single
<code>exdf</code> object rather than a list of them, so our next step
will be to combine the objects in the list. This action can be
accomplished using the <code>rbind</code> function, which combines
table-like objects by their rows; in other words, it stacks two or more
tables vertically. This action only makes sense if the tables have the
same columns, so before we combine the <code>exdf</code> objects, we
should make sure this is the case.</p>
<p>The <code>PhotoGEA</code> package includes a function called
<code>identify_common_columns</code> that can be used to get the names
of all columns that are present in all of the TDL files. Then, we can
extract just those columns, and then combine the <code>exdf</code>
objects into a single one.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the names of all columns that are present in all of the TDL files</span></span>
<span><span class="va">columns_to_keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">identify_common_columns</span>, <span class="va">tdl_exdf_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract just these columns</span></span>
<span><span class="va">tdl_exdf_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">tdl_exdf_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span> , <span class="va">columns_to_keep</span>, <span class="cn">TRUE</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use `rbind` to combine all the data</span></span>
<span><span class="va">tdl_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">tdl_exdf_list</span><span class="op">)</span></span></code></pre></div>
<p>Now we have a single R object called <code>tdl_files</code> that
includes all the data from several TDL data files. For more information
about consolidating information from multiple files, see the <em>Common
Patterns</em> section of the <a href="working_with_extended_data_frames.html#combining-data-from-several-files">Working
With Extended Data Frames</a> vignette.</p>
</div>
<div class="section level2">
<h2 id="identifying-tdl-cycles">Identifying TDL Cycles<a class="anchor" aria-label="anchor" href="#identifying-tdl-cycles"></a>
</h2>
<p>The first step when analyzing TDL data is to identify the “TDL
cycles” that are present within it. To do that, we need to know the
following information:</p>
<ul>
<li>The name of the column in the TDL data that indicates which valve is
being measured.</li>
<li>The valve number that marks the beginning of a new cycle.</li>
<li>How many valves are measured in each cycle.</li>
<li>The name of the column in the TDL data that indicates the time at
which each measurement was made.</li>
<li>The amount of time it should take to cycle through the valves.</li>
</ul>
<p>This information is usually known beforehand from the settings that
were specified when operating the TDL; alternatively, if it isn’t known
already, it can often be determined by taking a look at the data via
<code>View(tdl_files)</code>. Once this information is obtained, the
<code>identify_tdl_cycles</code> function from the <code>PhotoGEA</code>
package can be used to automatically assign a number to each measurement
cycle:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assign numbers to all full cycles in the data set</span></span>
<span><span class="va">tdl_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/identify_tdl_cycles.html">identify_tdl_cycles</a></span><span class="op">(</span></span>
<span>  <span class="va">tdl_files</span>,</span>
<span>  valve_column_name <span class="op">=</span> <span class="st">'valve_number'</span>,</span>
<span>  cycle_start_valve <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  expected_cycle_length_minutes <span class="op">=</span> <span class="fl">2.7</span>,</span>
<span>  expected_cycle_num_valves <span class="op">=</span> <span class="fl">9</span>,</span>
<span>  timestamp_colname <span class="op">=</span> <span class="st">'TIMESTAMP'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now the <code>tdl_files</code> object has two new columns: one is
called <code>cycle_num</code> and specifies each TDL cycle, and the
other is called <code>elapsed_time</code> and indicates the elapsed time
at the start of each cycle.</p>
</div>
<div class="section level2">
<h2 id="processing-tdl-cycles">Processing TDL Cycles<a class="anchor" aria-label="anchor" href="#processing-tdl-cycles"></a>
</h2>
<p>Now that the individual cycles have been identified, the next step is
to use the reference valves to calibrate the TDL readings. In general,
this procedure will depend strongly on the individual TDL system, since
each one may have different types of reference tanks. The data used in
this vignette was measured using the TDL in Carl Bernacchi’s lab in the
Edward R. Madigan Laboratory at the University of Illinois,
Urbana-Champaign. It includes five reference tanks that can be broken
into three types:</p>
<ul>
<li>One is a certified tank whose total CO<sub>2</sub> concentration and
carbon isotope ratio are supplied from NOAA.</li>
<li>One is a nitrogen tank that should have no carbon in it.</li>
<li>The final type of reference is another CO<sub>2</sub> tank whose
isotype ratio was measured at UIUC using a different method; this tank
is mixed with nitrogen in three different ratios to provide a range of
carbon concentrations.</li>
</ul>
<p>The full procedure for using these references to calibrate the TDL
signal is somewhat complicated. Fortunately, it is easy to determine and
apply the calibrations for a single TDL cycle using the
<code>process_tdl_cycle_erml</code> function from <code>PhotoGEA</code>.
To apply this function to each TDL cycle in a larger data set and then
consolidate the results, we can use it in conjunction with
<code>by</code> and <code>consolidate</code>, which are also part of
<code>PhotoGEA</code>. (For more information about these functions, see
the built-in help menu entries by typing
<code><a href="../reference/process_tdl_cycle_erml.html">?process_tdl_cycle_erml</a></code>, <code><a href="../reference/by.exdf.html">?by.exdf</a></code>, or
<code><a href="../reference/consolidate.html">?consolidate</a></code>, or check out the <em>Common Patterns</em>
section of the <a href="working_with_extended_data_frames.html#processing-multiple-pieces-of-an-extended-data-frame">Working
With Extended Data Frames</a> vignette.) As with the previous function,
many of the inputs here (such as
<code>noaa_cylinder_isotope_ratio</code>) must be obtained from whoever
is managing the TDL system being used:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use the data from the calibration valves to determine calibrated carbon</span></span>
<span><span class="co"># concentrations from all valves in each TDL cycle</span></span>
<span><span class="va">processed_tdl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/consolidate.html">consolidate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span></span>
<span>  <span class="va">tdl_files</span>,</span>
<span>  <span class="va">tdl_files</span><span class="op">[</span>, <span class="st">'cycle_num'</span><span class="op">]</span>,</span>
<span>  <span class="va">process_tdl_cycle_erml</span>,</span>
<span>  valve_column_name <span class="op">=</span> <span class="st">'valve_number'</span>,</span>
<span>  noaa_valve <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  calibration_0_valve <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  calibration_1_valve <span class="op">=</span> <span class="fl">21</span>,</span>
<span>  calibration_2_valve <span class="op">=</span> <span class="fl">23</span>,</span>
<span>  calibration_3_valve <span class="op">=</span> <span class="fl">26</span>,</span>
<span>  raw_12c_colname <span class="op">=</span> <span class="st">'Conc12C_Avg'</span>,</span>
<span>  raw_13c_colname <span class="op">=</span> <span class="st">'Conc13C_Avg'</span>,</span>
<span>  noaa_cylinder_co2_concentration <span class="op">=</span> <span class="fl">294.996</span>,</span>
<span>  noaa_cylinder_isotope_ratio <span class="op">=</span> <span class="op">-</span><span class="fl">8.40</span>,</span>
<span>  calibration_isotope_ratio <span class="op">=</span> <span class="op">-</span><span class="fl">11.505</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The output from this function – <code>processed_tdl</code> – is a
list of several <code>exdf</code> objects that include calibrated TDL
readings from each valve and information about the calibration
parameters that were determined while processing the data.</p>
<div class="section level3">
<h3 id="checking-the-calibrated-data">Checking the Calibrated Data<a class="anchor" aria-label="anchor" href="#checking-the-calibrated-data"></a>
</h3>
<p>Typically it is a good idea to check over the raw data, calibrated
data, and calibration constants for any issues that might affect the
reliability of the results. Since there are many valves involved and the
calibration involves several different steps (see
<code><a href="../reference/process_tdl_cycle_erml.html">?process_tdl_cycle_erml</a></code>), there are also many possible
things to check. A full check of the data might require creating and
viewing many different plots.</p>
<p>Here we will first take a look at the raw and calibrated values of
<sup>12</sup>C from each valve. This information is stored in the
<code>tdl_data</code> element of <code>processed_tdl</code>. The
<code>lattice</code> library makes it simple to include each valve as
its own separate subplot of a figure, with the raw and calibrated values
as separate traces. Our goal is simply to keep an eye out for anythign
that looks unusual in the data.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the 12C concentration data from all the valves</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">Conc12C_Avg</span> <span class="op">+</span> <span class="va">calibrated_12c</span> <span class="op">~</span> <span class="va">cycle_num</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">valve_number</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">processed_tdl</span><span class="op">$</span><span class="va">tdl_data</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'p'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Elapsed time ('</span>, <span class="va">processed_tdl</span><span class="op">$</span><span class="va">tdl_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">cycle_num</span>, <span class="st">')'</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'12C concentration ('</span>, <span class="va">processed_tdl</span><span class="op">$</span><span class="va">tdl_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Conc12C_Avg</span>, <span class="st">')'</span><span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="st">'12C concentrations'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_tdl_data_files/figure-html/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;"></p>
<p>In this figure, it is apparent that valves 23 and 26 have large
spikes, which is surprising since these are calibration valves; the gas
flowing to the TDL from these valves is expected to have a fairly
constant carbon concentration. It is possible to view just one valve at
a time for more detailed analysis. Here we will take a look at the
<sup>12</sup>C concentration from valve 26, which exhibits a spike.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Specify a single valve to plot</span></span>
<span><span class="va">valve_to_plot</span> <span class="op">&lt;-</span> <span class="fl">26</span></span>
<span></span>
<span><span class="co"># Get the processed data from the single valve</span></span>
<span><span class="va">single_valve</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">processed_tdl</span><span class="op">$</span><span class="va">tdl_data</span><span class="op">[</span><span class="va">processed_tdl</span><span class="op">$</span><span class="va">tdl_data</span><span class="op">[</span>, <span class="st">'valve_number'</span><span class="op">]</span> <span class="op">==</span> <span class="va">valve_to_plot</span>, , <span class="cn">TRUE</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Plot the 12C concentration data from the single valve</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">Conc12C_Avg</span> <span class="op">+</span> <span class="va">calibrated_12c</span> <span class="op">~</span> <span class="va">cycle_num</span>,</span>
<span>  data <span class="op">=</span> <span class="va">single_valve</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">'TDL cycle'</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'12C concentration ('</span>, <span class="va">single_valve</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Conc12C_Avg</span>, <span class="st">')'</span><span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'12C concentrations from valve'</span>, <span class="va">valve_to_plot</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_tdl_data_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;"></p>
<p>In this graph, we can see that the calibrated <sup>12</sup>C
concentration has a large deviation from the raw values near the large
spike, although the calibrated and raw values are generally very similar
in the rest of the data. In fact, we can see that in valve 12 (one of
the valves whose composition we are trying to determine), there is also
a large deviation between the raw and calibrated <sup>12</sup>C signals
near the spike.</p>
<p><img src="analyzing_tdl_data_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Finally, we can also see traces of this anomaly in the calibration
constants determined during the TDL cycle processing. In this plot, the
<sup>12</sup>C gain factor is nearly constant at all times with the
exception of the cycles where there is also a spike in the
<sup>12</sup>C signal in valve 26.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the 12C gain factor determined during the calibration process</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">gain_12CO2</span> <span class="op">~</span> <span class="va">cycle_num</span>,</span>
<span>  data <span class="op">=</span> <span class="va">processed_tdl</span><span class="op">$</span><span class="va">calibration_12CO2</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">'TDL cycle'</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'12C gain factor ('</span>, <span class="va">processed_tdl</span><span class="op">$</span><span class="va">calibration_12CO2</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">gain_12CO2</span>, <span class="st">')'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_tdl_data_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="processing-tdl-cycles-with-removal-and-smoothing">Processing TDL Cycles (With Removal and Smoothing)<a class="anchor" aria-label="anchor" href="#processing-tdl-cycles-with-removal-and-smoothing"></a>
</h2>
<p>In <a href="#processing-tdl-cycles">Processing TDL Cycles</a>, we
processed the full contents of the raw TDL file. However, users
sometimes with to remove unreliable cycles or apply smoothing functions
to some valves before processing the data. In this section, we
demonstrate how to do this.</p>
<div class="section level3">
<h3 id="removing-problematic-cycles">Removing Problematic Cycles<a class="anchor" aria-label="anchor" href="#removing-problematic-cycles"></a>
</h3>
<p>In <a href="#checking-the-calibrated-data">Checking the Calibrated
Data</a>, we located a spike in the measured <sup>12</sup>C
concentration from valve 26, which is one of the calibration values.
Since the presence of this spike indicates that something unexpected
happened to the TDL system, and there is evidence that the calibration
may be compromised during the spike, it is probably a good idea to
remove the TDL cycles where the <sup>12</sup>C signal from valve 26
suddenly becomes large.</p>
<p>Fortunately, this is simple to do using the
<code>remove_points</code> function from <code>PhotoGEA</code>. The
following illustrates how to “clean” the data by removing the unreliable
TDL cycles; here, we actually remove two regions of the data that appear
to be suspicious:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define a vector of cycle numbers that should be removed</span></span>
<span><span class="va">tdl_cycles_to_remove</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">145</span><span class="op">:</span><span class="fl">150</span>, <span class="co"># The big spike in valve 26</span></span>
<span>  <span class="fl">103</span><span class="op">:</span><span class="fl">107</span>  <span class="co"># A smaller spike in valve 26</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove them</span></span>
<span><span class="va">tdl_files_clean</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/remove_points.html">remove_points</a></span><span class="op">(</span><span class="va">tdl_files</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cycle_num <span class="op">=</span> <span class="va">tdl_cycles_to_remove</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="smoothing-the-tdl-data">Smoothing the TDL Data<a class="anchor" aria-label="anchor" href="#smoothing-the-tdl-data"></a>
</h3>
<p>Since TDL signals are susceptible to several types of noise and the
composition of gas from the calibration tanks is expected to be
relatively constant, it is safe to assume that any high-frequency
variations in the calibration valve signals are due to noise. For this
reason, it may be helpful to smooth the data from the calibration valves
before processing the TDL cycles. This may reduce noise in the
calibrated values from the “unknown” valves.</p>
<p>There are many possible strategies for smoothing the time series of
values measured from a valve, and the <code>PhotoGEA</code> package does
not attempt to provide its own smoothing algorithms. Instead,
<code>PhotoGEA</code> provides a general function called
<code>smooth_tdl_data</code> that can apply a smoothing function to the
data from one valve. To use this function, a user must specify their own
smoothing method. (For more information, see the help menu entry by
typing <code><a href="../reference/smooth_tdl_data.html">?smooth_tdl_data</a></code>.) Here we will show how the spline
smoothing function from the base R package can be used to smooth the
<sup>12</sup>C and <sup>13</sup>C signals from the calibration
valves:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define a spline smoothing function</span></span>
<span><span class="va">spline_smoothing_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">Y</span>, <span class="va">X</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/smooth.spline.html" class="external-link">smooth.spline</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">ss</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Specify the valves that should be smoothed</span></span>
<span><span class="va">valves_to_smooth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">20</span>, <span class="fl">21</span>, <span class="fl">23</span>, <span class="fl">26</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize a smoothed copy of the data</span></span>
<span><span class="va">tdl_files_smooth</span> <span class="op">&lt;-</span> <span class="va">tdl_files_clean</span></span>
<span></span>
<span><span class="co"># Apply the smoothing function to the 12C and 13C signal from each valve</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">valve</span> <span class="kw">in</span> <span class="va">valves_to_smooth</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">column</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Conc12C_Avg'</span>, <span class="st">'Conc13C_Avg'</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tdl_files_smooth</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/smooth_tdl_data.html">smooth_tdl_data</a></span><span class="op">(</span></span>
<span>      <span class="va">tdl_files_smooth</span>,</span>
<span>      <span class="va">column</span>,</span>
<span>      <span class="st">'valve_number'</span>,</span>
<span>      <span class="va">valve</span>,</span>
<span>      <span class="va">spline_smoothing_function</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="checking-the-data-after-cleaning-and-smoothing">Checking the Data After Cleaning and Smoothing<a class="anchor" aria-label="anchor" href="#checking-the-data-after-cleaning-and-smoothing"></a>
</h3>
<p>Now that we have removed some problematic cycles and applied a spline
smoothing function to the calibration valves, we can process the TDL
cycles again using the same command from <a href="#processing-tdl-cycles">Processing TDL Cycles</a>; the only
difference here is that we are operating on the smoothed data:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use the data from the calibration valves to determine calibrated carbon</span></span>
<span><span class="co"># concentrations from all valves in each TDL cycle</span></span>
<span><span class="va">processed_smooth_tdl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/consolidate.html">consolidate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span></span>
<span>  <span class="va">tdl_files_smooth</span>,</span>
<span>  <span class="va">tdl_files_smooth</span><span class="op">[</span>, <span class="st">'cycle_num'</span><span class="op">]</span>,</span>
<span>  <span class="va">process_tdl_cycle_erml</span>,</span>
<span>  valve_column_name <span class="op">=</span> <span class="st">'valve_number'</span>,</span>
<span>  noaa_valve <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  calibration_0_valve <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  calibration_1_valve <span class="op">=</span> <span class="fl">21</span>,</span>
<span>  calibration_2_valve <span class="op">=</span> <span class="fl">23</span>,</span>
<span>  calibration_3_valve <span class="op">=</span> <span class="fl">26</span>,</span>
<span>  raw_12c_colname <span class="op">=</span> <span class="st">'Conc12C_Avg'</span>,</span>
<span>  raw_13c_colname <span class="op">=</span> <span class="st">'Conc13C_Avg'</span>,</span>
<span>  noaa_cylinder_co2_concentration <span class="op">=</span> <span class="fl">294.996</span>,</span>
<span>  noaa_cylinder_isotope_ratio <span class="op">=</span> <span class="op">-</span><span class="fl">8.40</span>,</span>
<span>  calibration_isotope_ratio <span class="op">=</span> <span class="op">-</span><span class="fl">11.505</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>It is important to confirm that the smoothing procedure has produced
reasonable outputs. Here we create a plot comparing the raw and smoothed
<sup>12</sup>C signal from all valves:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add columns indicating which which operations have been applied to each exdf</span></span>
<span><span class="va">tdl_files</span><span class="op">[</span> , <span class="st">'data_type'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'01 raw data'</span></span>
<span><span class="va">tdl_files_clean</span><span class="op">[</span> , <span class="st">'data_type'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'02 cleaned data'</span></span>
<span><span class="va">tdl_files_smooth</span><span class="op">[</span> , <span class="st">'data_type'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'03 cleaned smoothed data'</span></span>
<span></span>
<span><span class="co"># Make a big exdf object with the raw and smoothed data</span></span>
<span><span class="va">tdl_compare</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">tdl_files</span>, <span class="va">tdl_files_clean</span>, <span class="va">tdl_files_smooth</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Keep only the valves that were smoothed</span></span>
<span><span class="va">tdl_compare</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">tdl_compare</span><span class="op">[</span><span class="va">tdl_compare</span><span class="op">[</span> , <span class="st">'valve_number'</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">valves_to_smooth</span>, , <span class="cn">TRUE</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Plot the uncalibrated 12C concentration data from all the valves</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">Conc12C_Avg</span> <span class="op">~</span> <span class="va">cycle_num</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">valve_number</span><span class="op">)</span>,</span>
<span>  group <span class="op">=</span> <span class="va">data_type</span>,</span>
<span>  data <span class="op">=</span> <span class="va">tdl_compare</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">'TDL cycle'</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Uncalibrated 12C concentration ('</span>, <span class="va">tdl_compare</span><span class="op">$</span><span class="va">tdl_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Conc12C_Avg</span>, <span class="st">')'</span><span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="st">'Uncalibrated 12C concentrations'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_tdl_data_files/figure-html/compare_smoothing-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Although it is clear that we have successfully removed the spikes
from valve 26, it may be helpful to display just that valve to take a
closer look:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Specify a single valve to plot</span></span>
<span><span class="va">valve_to_compare</span> <span class="op">&lt;-</span> <span class="fl">26</span></span>
<span></span>
<span><span class="co"># Get the comparison data from the single valve</span></span>
<span><span class="va">single_valve_compare</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">tdl_compare</span><span class="op">[</span><span class="va">tdl_compare</span><span class="op">[</span>, <span class="st">'valve_number'</span><span class="op">]</span> <span class="op">==</span> <span class="va">valve_to_compare</span>, , <span class="cn">TRUE</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Plot the 12C concentration data from the single valve</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">Conc12C_Avg</span> <span class="op">~</span> <span class="va">cycle_num</span>,</span>
<span>  group <span class="op">=</span> <span class="va">data_type</span>,</span>
<span>  data <span class="op">=</span> <span class="va">single_valve_compare</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">'TDL cycle'</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Uncalibrated 12C concentration ('</span>, <span class="va">single_valve_compare</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Conc12C_Avg</span>, <span class="st">')'</span><span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Uncalibrated 12C concentrations from valve'</span>, <span class="va">valve_to_compare</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_tdl_data_files/figure-html/compare_single_valve-1.png" width="672" style="display: block; margin: auto;"></p>
<p>In this graph we can see that the spike was indeed removed and that
the smoothed data does a good job of following the raw data for this
valve. As another check, we can also see how the smoothed data is
altered after the calibration process. Here we will look at valve 12, as
in <a href="#checking-the-calibrated-data">Checking the Calibrated
Data</a>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Specify a single valve to plot</span></span>
<span><span class="va">valve_to_plot</span> <span class="op">&lt;-</span> <span class="fl">12</span></span>
<span></span>
<span><span class="co"># Get the processed data from the single valve</span></span>
<span><span class="va">single_valve_smooth</span> <span class="op">&lt;-</span> <span class="va">processed_smooth_tdl</span><span class="op">$</span><span class="va">tdl_data</span><span class="op">[</span></span>
<span>  <span class="va">processed_smooth_tdl</span><span class="op">$</span><span class="va">tdl_data</span><span class="op">[</span>, <span class="st">'valve_number'</span><span class="op">]</span> <span class="op">==</span> <span class="va">valve_to_plot</span>, , <span class="cn">TRUE</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Plot the 12C concentration data from the single valve</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">Conc12C_Avg</span> <span class="op">+</span> <span class="va">calibrated_12c</span> <span class="op">~</span> <span class="va">cycle_num</span>,</span>
<span>  data <span class="op">=</span> <span class="va">single_valve_smooth</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">'TDL cycle'</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'12C concentration ('</span>, <span class="va">single_valve_smooth</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Conc12C_Avg</span>, <span class="st">')'</span><span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'12C concentrations from valve'</span>, <span class="va">valve_to_plot</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_tdl_data_files/figure-html/plot_single_valve_smooth-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Here we see that after cleaning and smoothing the data, the
calibrated data from this “unknown” valve is only slightly different
than its raw data across all the cycles. Finally, we can also plot the
<sup>12</sup>C gain factor as in <a href="#checking-the-calibrated-data">Checking the Calibrated
Data</a>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the 12C gain factor determined during the calibration process</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">gain_12CO2</span> <span class="op">~</span> <span class="va">cycle_num</span>,</span>
<span>  data <span class="op">=</span> <span class="va">processed_smooth_tdl</span><span class="op">$</span><span class="va">calibration_12CO2</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">'TDL cycle'</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'12C gain factor ('</span>, <span class="va">processed_smooth_tdl</span><span class="op">$</span><span class="va">calibration_12CO2</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">gain_12CO2</span>, <span class="st">')'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_tdl_data_files/figure-html/plot_12c_gain-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Again, there are no sudden spikes remaining in the gain factor,
indicating that we did a good job of cleaning and smoothing the
data.</p>
</div>
</div>
<div class="section level2">
<h2 id="next-steps">Next steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<p>Having cleaned, smoothed, and visually checked the data, we can now
be confident that the calibrated <sup>12</sup>C and <sup>13</sup>C
values are as accurate as they can be. The next step in the analysis
would be to interpret the data from the valves whose composition is
unknown and to be determined. This will depend on your particular
application, so we cannot give general advice here!</p>
</div>
<div class="section level2">
<h2 id="customizing-your-script">Customizing Your Script<a class="anchor" aria-label="anchor" href="#customizing-your-script"></a>
</h2>
<p>Note that most of the commands in this vignette have been written in
a general way so they can be used as the basis for your own TDL analysis
script (see <a href="#commands-from-this-document">Commands From This
Document</a>). In order to use them in your own script, some or all of
the following changes may be required. There may also be others not
specifically mentioned here.</p>
<div class="section level3">
<h3 id="input-files">Input Files<a class="anchor" aria-label="anchor" href="#input-files"></a>
</h3>
<p>The file paths specified in <code>file_paths</code> will need to be
modified so they point to your TDL files. One way to do this in your own
script is to simply write out relative or absolute paths to the files
you wish to load. For example, you could replace the previous definition
of <code>file_paths</code> with this one:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define a vector of paths to the files we wish to load</span></span>
<span><span class="va">file_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">'myfile1.dat'</span>,             <span class="co"># `myfile1.dat` must be in the current working directory</span></span>
<span>  <span class="st">'C:/documents/myfile2.dat'</span> <span class="co"># This is an absolute path to `myfile2.dat`</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>You may also want to consider using the
<code>choose_input_tdl_files</code> function from <code>PhotoGEA</code>;
this function will create a pop-up browser window where you can
interactively select a set of files. Sometimes this is more convenient
than writing out file paths or names. For example, you could replace the
previous definition of <code>file_paths</code> with this one:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Interactively define a vector of paths to the files we wish to load</span></span>
<span><span class="va">file_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/choose_input_files.html">choose_input_tdl_files</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Unfortunately, <code>choose_input_tdl_files</code> is only available
in interactive R sessions running on Microsoft Windows, but there is
also a platform-independent option: <code>choose_input_files</code>. See
the <em>Translation</em> section of the <a href="developing_a_data_analysis_pipeline.html#translation">Developing a
Data Analysis Pipeline</a> vignette for more details.</p>
</div>
<div class="section level3">
<h3 id="plots-for-checking">Plots for Checking<a class="anchor" aria-label="anchor" href="#plots-for-checking"></a>
</h3>
<p>To keep this vignette shorter, we skipped out on many possible plots
that you may want to view. In addition to the ones generated here, it
may also be helpful to make the following plots:</p>
<ul>
<li>Plots of <sup>13C</sup> signals in addition to plots of
<sup>12</sup>C.</li>
<li>Individual plots of the raw, cleaned, and smoothed data for each
valve.</li>
<li>Plots of the <sup>13C</sup> calibration constants.</li>
<li>Plots of the <sup>13</sup>C calibration fits.</li>
</ul>
<p>These plots can all be created by making small modifications to the
commands in this document.</p>
</div>
<div class="section level3">
<h3 id="cycles-to-remove">Cycles to Remove<a class="anchor" aria-label="anchor" href="#cycles-to-remove"></a>
</h3>
<p>When beginning to analyze a new data set, it is advisable to not
remove any TDL cycles; this can be accomplished by defining
<code>tdl_cycles_to_remove</code> with the following command in place of
the one used above:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tdl_cycles_to_remove</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>After viewing all of the data, unreliable cycles that should be
removed can be identified.</p>
</div>
<div class="section level3">
<h3 id="smoothing-function">Smoothing Function<a class="anchor" aria-label="anchor" href="#smoothing-function"></a>
</h3>
<p>When beginning to analyze a new data set, it is advisable to disable
smoothing. This can be done by definining a “null” smoothing function;
in other words, a function that does not actually perform any
smoothing:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define a null smoothing function</span></span>
<span><span class="va">null_smoothing_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">Y</span>, <span class="va">X</span><span class="op">)</span> <span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
<p>Then, this function should be passed to <code>smooth_tdl_data</code>
in place of <code>spline_smoothing_function</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="commands-from-this-document">Commands From This Document<a class="anchor" aria-label="anchor" href="#commands-from-this-document"></a>
</h2>
<p>The following code chunk includes all the central commands used
throughout this document. They are compiled here to make them easy to
copy/paste into a text file to initialize your own script. Annotation
has also been added to clearly indicate the four steps involved in data
analysis, as described in the <a href="developing_a_data_analysis_pipeline.html">Developing a Data
Analysis Pipeline</a> vignette.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">###</span></span>
<span><span class="co">### PRELIMINARIES:</span></span>
<span><span class="co">### Loading packages, defining constants, creating helping functions, etc.</span></span>
<span><span class="co">###</span></span>
<span></span>
<span><span class="co"># Load required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/eloch216/PhotoGEA" class="external-link">PhotoGEA</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lattice.r-forge.r-project.org/" class="external-link">lattice</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">###</span></span>
<span><span class="co">### TRANSLATION:</span></span>
<span><span class="co">### Creating convenient R objects from raw data files</span></span>
<span><span class="co">###</span></span>
<span></span>
<span><span class="co">## IMPORTANT: When loading your own files, it is not advised to use</span></span>
<span><span class="co">## `PhotoGEA_example_file_path` as in the code below. Instead, write out the</span></span>
<span><span class="co">## names or use the `choose_input_tdl_files` function.</span></span>
<span></span>
<span><span class="co"># Define a vector of paths to the files we wish to load; in this case, we are</span></span>
<span><span class="co"># loading example files included with the PhotoGEA package</span></span>
<span><span class="va">file_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/PhotoGEA_example_file_path.html">PhotoGEA_example_file_path</a></span><span class="op">(</span><span class="st">'tdl_sampling_1.dat'</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/PhotoGEA_example_file_path.html">PhotoGEA_example_file_path</a></span><span class="op">(</span><span class="st">'tdl_sampling_2.dat'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load each file, storing the result in a list</span></span>
<span><span class="va">tdl_exdf_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">file_paths</span>, <span class="kw">function</span><span class="op">(</span><span class="va">fpath</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/read_gasex_file.html">read_gasex_file</a></span><span class="op">(</span><span class="va">fpath</span>, <span class="st">'TIMESTAMP'</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the names of all columns that are present in all of the TDL files</span></span>
<span><span class="va">columns_to_keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">identify_common_columns</span>, <span class="va">tdl_exdf_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract just these columns</span></span>
<span><span class="va">tdl_exdf_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">tdl_exdf_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span> , <span class="va">columns_to_keep</span>, <span class="cn">TRUE</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use `rbind` to combine all the data</span></span>
<span><span class="va">tdl_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">tdl_exdf_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co">###</span></span>
<span><span class="co">### VALIDATION:</span></span>
<span><span class="co">### Organizing the data, checking its consistency and quality, cleaning it</span></span>
<span><span class="co">###</span></span>
<span></span>
<span><span class="co"># Assign numbers to all full cycles in the data set</span></span>
<span><span class="va">tdl_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/identify_tdl_cycles.html">identify_tdl_cycles</a></span><span class="op">(</span></span>
<span>  <span class="va">tdl_files</span>,</span>
<span>  valve_column_name <span class="op">=</span> <span class="st">'valve_number'</span>,</span>
<span>  cycle_start_valve <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  expected_cycle_length_minutes <span class="op">=</span> <span class="fl">2.7</span>,</span>
<span>  expected_cycle_num_valves <span class="op">=</span> <span class="fl">9</span>,</span>
<span>  timestamp_colname <span class="op">=</span> <span class="st">'TIMESTAMP'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a vector of cycle numbers that should be removed</span></span>
<span><span class="va">tdl_cycles_to_remove</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">145</span><span class="op">:</span><span class="fl">150</span>, <span class="co"># The big spike in valve 26</span></span>
<span>  <span class="fl">103</span><span class="op">:</span><span class="fl">107</span>  <span class="co"># A smaller spike in valve 26</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove them</span></span>
<span><span class="va">tdl_files_clean</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/remove_points.html">remove_points</a></span><span class="op">(</span><span class="va">tdl_files</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cycle_num <span class="op">=</span> <span class="va">tdl_cycles_to_remove</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a spline smoothing function</span></span>
<span><span class="va">spline_smoothing_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">Y</span>, <span class="va">X</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/smooth.spline.html" class="external-link">smooth.spline</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">ss</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Specify the valves that should be smoothed</span></span>
<span><span class="va">valves_to_smooth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">20</span>, <span class="fl">21</span>, <span class="fl">23</span>, <span class="fl">26</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize a smoothed copy of the data</span></span>
<span><span class="va">tdl_files_smooth</span> <span class="op">&lt;-</span> <span class="va">tdl_files_clean</span></span>
<span></span>
<span><span class="co"># Apply the smoothing function to the 12C and 13C signal from each valve</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">valve</span> <span class="kw">in</span> <span class="va">valves_to_smooth</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">column</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Conc12C_Avg'</span>, <span class="st">'Conc13C_Avg'</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tdl_files_smooth</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/smooth_tdl_data.html">smooth_tdl_data</a></span><span class="op">(</span></span>
<span>      <span class="va">tdl_files_smooth</span>,</span>
<span>      <span class="va">column</span>,</span>
<span>      <span class="st">'valve_number'</span>,</span>
<span>      <span class="va">valve</span>,</span>
<span>      <span class="va">spline_smoothing_function</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">###</span></span>
<span><span class="co">### PROCESSING:</span></span>
<span><span class="co">### Extracting new pieces of information from the data</span></span>
<span><span class="co">###</span></span>
<span></span>
<span><span class="co"># Use the data from the calibration valves to determine calibrated carbon</span></span>
<span><span class="co"># concentrations from all valves in each TDL cycle</span></span>
<span><span class="va">processed_smooth_tdl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/consolidate.html">consolidate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span></span>
<span>  <span class="va">tdl_files_smooth</span>,</span>
<span>  <span class="va">tdl_files_smooth</span><span class="op">[</span>, <span class="st">'cycle_num'</span><span class="op">]</span>,</span>
<span>  <span class="va">process_tdl_cycle_erml</span>,</span>
<span>  valve_column_name <span class="op">=</span> <span class="st">'valve_number'</span>,</span>
<span>  noaa_valve <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  calibration_0_valve <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  calibration_1_valve <span class="op">=</span> <span class="fl">21</span>,</span>
<span>  calibration_2_valve <span class="op">=</span> <span class="fl">23</span>,</span>
<span>  calibration_3_valve <span class="op">=</span> <span class="fl">26</span>,</span>
<span>  raw_12c_colname <span class="op">=</span> <span class="st">'Conc12C_Avg'</span>,</span>
<span>  raw_13c_colname <span class="op">=</span> <span class="st">'Conc13C_Avg'</span>,</span>
<span>  noaa_cylinder_co2_concentration <span class="op">=</span> <span class="fl">294.996</span>,</span>
<span>  noaa_cylinder_isotope_ratio <span class="op">=</span> <span class="op">-</span><span class="fl">8.40</span>,</span>
<span>  calibration_isotope_ratio <span class="op">=</span> <span class="op">-</span><span class="fl">11.505</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">###</span></span>
<span><span class="co">### SYNTHESIS:</span></span>
<span><span class="co">### Using plots and statistics to help draw conclusions from the data</span></span>
<span><span class="co">###</span></span>
<span></span>
<span><span class="co"># Add columns indicating which which operations have been applied to each exdf</span></span>
<span><span class="va">tdl_files</span><span class="op">[</span> , <span class="st">'data_type'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'01 raw data'</span></span>
<span><span class="va">tdl_files_clean</span><span class="op">[</span> , <span class="st">'data_type'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'02 cleaned data'</span></span>
<span><span class="va">tdl_files_smooth</span><span class="op">[</span> , <span class="st">'data_type'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'03 cleaned smoothed data'</span></span>
<span></span>
<span><span class="co"># Make a big exdf object with the raw and smoothed data</span></span>
<span><span class="va">tdl_compare</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">tdl_files</span>, <span class="va">tdl_files_clean</span>, <span class="va">tdl_files_smooth</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Keep only the valves that were smoothed</span></span>
<span><span class="va">tdl_compare</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">tdl_compare</span><span class="op">[</span><span class="va">tdl_compare</span><span class="op">[</span> , <span class="st">'valve_number'</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">valves_to_smooth</span>, , <span class="cn">TRUE</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Plot the uncalibrated 12C concentration data from all the valves</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">Conc12C_Avg</span> <span class="op">~</span> <span class="va">cycle_num</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">valve_number</span><span class="op">)</span>,</span>
<span>  group <span class="op">=</span> <span class="va">data_type</span>,</span>
<span>  data <span class="op">=</span> <span class="va">tdl_compare</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">'TDL cycle'</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Uncalibrated 12C concentration ('</span>, <span class="va">tdl_compare</span><span class="op">$</span><span class="va">tdl_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Conc12C_Avg</span>, <span class="st">')'</span><span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="st">'Uncalibrated 12C concentrations'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specify a single valve to plot</span></span>
<span><span class="va">valve_to_compare</span> <span class="op">&lt;-</span> <span class="fl">26</span></span>
<span></span>
<span><span class="co"># Get the comparison data from the single valve</span></span>
<span><span class="va">single_valve_compare</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">tdl_compare</span><span class="op">[</span><span class="va">tdl_compare</span><span class="op">[</span>, <span class="st">'valve_number'</span><span class="op">]</span> <span class="op">==</span> <span class="va">valve_to_compare</span>, , <span class="cn">TRUE</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Plot the 12C concentration data from the single valve</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">Conc12C_Avg</span> <span class="op">~</span> <span class="va">cycle_num</span>,</span>
<span>  group <span class="op">=</span> <span class="va">data_type</span>,</span>
<span>  data <span class="op">=</span> <span class="va">single_valve_compare</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">'TDL cycle'</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Uncalibrated 12C concentration ('</span>, <span class="va">single_valve_compare</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Conc12C_Avg</span>, <span class="st">')'</span><span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Uncalibrated 12C concentrations from valve'</span>, <span class="va">valve_to_compare</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specify a single valve to plot</span></span>
<span><span class="va">valve_to_plot</span> <span class="op">&lt;-</span> <span class="fl">12</span></span>
<span></span>
<span><span class="co"># Get the processed data from the single valve</span></span>
<span><span class="va">single_valve_smooth</span> <span class="op">&lt;-</span> <span class="va">processed_smooth_tdl</span><span class="op">$</span><span class="va">tdl_data</span><span class="op">[</span></span>
<span>  <span class="va">processed_smooth_tdl</span><span class="op">$</span><span class="va">tdl_data</span><span class="op">[</span>, <span class="st">'valve_number'</span><span class="op">]</span> <span class="op">==</span> <span class="va">valve_to_plot</span>, , <span class="cn">TRUE</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Plot the 12C concentration data from the single valve</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">Conc12C_Avg</span> <span class="op">+</span> <span class="va">calibrated_12c</span> <span class="op">~</span> <span class="va">cycle_num</span>,</span>
<span>  data <span class="op">=</span> <span class="va">single_valve_smooth</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">'TDL cycle'</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'12C concentration ('</span>, <span class="va">single_valve_smooth</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Conc12C_Avg</span>, <span class="st">')'</span><span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'12C concentrations from valve'</span>, <span class="va">valve_to_plot</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the 12C gain factor determined during the calibration process</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">gain_12CO2</span> <span class="op">~</span> <span class="va">cycle_num</span>,</span>
<span>  data <span class="op">=</span> <span class="va">processed_smooth_tdl</span><span class="op">$</span><span class="va">calibration_12CO2</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">'TDL cycle'</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'12C gain factor ('</span>, <span class="va">processed_smooth_tdl</span><span class="op">$</span><span class="va">calibration_12CO2</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">gain_12CO2</span>, <span class="st">')'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-evans_temperature_2013" class="csl-entry">
Evans, John R., and Susanne von Caemmerer. 2013. <span>“Temperature
Response of Carbon Isotope Discrimination and Mesophyll Conductance in
Tobacco.”</span> <em>Plant, Cell &amp; Environment</em> 36 (4): 745–56.
<a href="https://doi.org/10.1111/j.1365-3040.2012.02591.x" class="external-link">https://doi.org/10.1111/j.1365-3040.2012.02591.x</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Edward B. Lochocki.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
