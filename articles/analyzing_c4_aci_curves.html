<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="PhotoGEA">
<title>Analyzing C4 A-Ci Curves • PhotoGEA</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analyzing C4 A-Ci Curves">
<meta property="og:description" content="PhotoGEA">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    padding-top: 70px;

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">PhotoGEA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/PhotoGEA.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/analyzing_ball_berry_data.html">Analyzing Ball-Berry Data</a>
    <a class="dropdown-item" href="../articles/analyzing_c3_aci_curves.html">Analyzing C3 A-Ci Curves</a>
    <a class="dropdown-item" href="../articles/analyzing_c4_aci_curves.html">Analyzing C4 A-Ci Curves</a>
    <a class="dropdown-item" href="../articles/analyzing_tdl_data.html">Analyzing TDL Data</a>
    <a class="dropdown-item" href="../articles/combining_with_other_packages.html">Combining PhotoGEA With Other Packages</a>
    <a class="dropdown-item" href="../articles/creating_your_own_processing_tools.html">Creating Your Own Processing Tools</a>
    <a class="dropdown-item" href="../articles/developing_a_data_analysis_pipeline.html">Developing a Data Analysis Pipeline</a>
    <a class="dropdown-item" href="../articles/working_with_extended_data_frames.html">Working With Extended Data Frames</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/eloch216/PhotoGEA/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Analyzing C4 A-Ci Curves</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/eloch216/PhotoGEA/blob/HEAD/vignettes/analyzing_c4_aci_curves.Rmd" class="external-link"><code>vignettes/analyzing_c4_aci_curves.Rmd</code></a></small>
      <div class="d-none name"><code>analyzing_c4_aci_curves.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>In this vignette, we will give an example showing how to analyze
C<sub>4</sub> A-Ci data using the <code>PhotoGEA</code> package. The
commands in this vignette can be used to initialize your own script, as
described in <a href="#customizing-your-script">Customizing Your
Script</a>.</p>
</div>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<div class="section level3">
<h3 id="understanding-c4-a-ci-curves">Understanding C4 A-Ci Curves<a class="anchor" aria-label="anchor" href="#understanding-c4-a-ci-curves"></a>
</h3>
<p>An <em>A-Ci curve</em> (or <em>CO<sub>2</sub> response curve</em>) is
a particular type of gas exchange measurement where a living leaf is
exposed to varying concentrations of CO<sub>2</sub>. For each
CO<sub>2</sub> concentration in the sequence, the net assimilation rate
<span class="math inline">\(A_n\)</span>, stomatal conductance to
H<sub>2</sub>O (<span class="math inline">\(g_{sw}\)</span>), and other
important quantities are measured and recorded. Typically, other
environmental variables such as temperature, humidity, and incident
photosynthetically-active photon flux density are held constant during
the measurement sequence so that changes in photosynthesis can be
attributed to CO<sub>2</sub> alone.</p>
<p>Because of their different cell structures and biochemical pathways,
C<sub>3</sub> and C<sub>4</sub> plants have very different responses to
CO<sub>2</sub>. Here, we will only be discussing C<sub>4</sub>
plants.</p>
<p>The full C<sub>4</sub> photosynthetic pathway is quite complicated,
consisting of at least two hundred individual reactions, each of which
may have an impact on a measured A-Ci curve. However, simplified models
for photosynthesis are available and are much easier to understand and
work with. These models tend to be based around PEP carboxylase and
rubisco kinetics, describing how the net assimilation rate responds to
the partial pressure of CO<sub>2</sub> in the mesophyll or bundle sheath
cells. The most widely-used model is described in in <em>Biochemical
Models of Leaf Photosynthesis</em> <span class="citation">(<a href="#ref-caemmerer_biochemical_2000" role="doc-biblioref">S. von
Caemmerer 2000</a>)</span>.</p>
<p>This model provides a framework for understanding the changes in
<span class="math inline">\(A_n\)</span> that occur as a C<sub>4</sub>
plant is exposed to successively higher concentrations of
CO<sub>2</sub>. Overall, the photosynthetic response to CO<sub>2</sub>
under high light conditions can be divided into two separate ranges:</p>
<ul>
<li>For low levels of CO<sub>2</sub>, CO<sub>2</sub> assimilation is
primarily limited by PEP carboxylation in the mesophyll cells.</li>
<li>For high levels of CO<sub>2</sub>, CO<sub>2</sub> assimilation is
primarily limited by rubisco activity in the bundle sheath cells (or
possibly by the rate of PEP carboxylase regeneration).</li>
</ul>
<p>More specifically, the model provides equations that calculate the
net assimilation rate <span class="math inline">\(A_n\)</span> from the
maximumum rate of PEP carboxylation (<span class="math inline">\(V_{p,max}\)</span>), the maximum rate of PEP
carboxylase regeneration (<span class="math inline">\(V_{p,r}\)</span>),
the maximum rate of rubisco activity (<span class="math inline">\(V_{c,max}\)</span>), the total rate of
mitochondrial respiration in the mesophyll and bundle sheath cells
(<span class="math inline">\(R_d\)</span>), the partial pressure of
CO<sub>2</sub> in the mesophyll (<span class="math inline">\(P_{cm}\)</span>), and several other parameters.
The full equations are quite complicated, but can be approximated by a
simpler version where <span class="math inline">\(A_n\)</span> is given
by the minimum of three separate enzyme-limited assimilation rates:</p>
<ul>
<li>The PEP-carboxylation-limited rate (<span class="math inline">\(A_{pc}\)</span>).</li>
<li>The rubisco-limited rate (<span class="math inline">\(A_r\)</span>).</li>
<li>The PEP-regeneration-limited rate (<span class="math inline">\(A_{pr}\)</span>).</li>
</ul>
<p>Using the equations that compose this model, it is possible to
calculate plots like the one below, which illustrates the three
different limiting rates and the overall net assimilation rate
calculated using the full equations. The two distinct ranges can be
identified as the initial part of the curve (where there is a roughly
linear increase in <span class="math inline">\(A_n\)</span> with <span class="math inline">\(P_{cm}\)</span>) and the later part (where <span class="math inline">\(A_n\)</span> is nearly flat with very little
dependence on <span class="math inline">\(P_{cm}\)</span>).</p>
<p><img src="analyzing_c4_aci_curves_files/figure-html/unnamed-chunk-2-1.png" width="720" style="display: block; margin: auto;"></p>
<p>(Note: this figure was generated using the
<code>calculate_c4_assimilation</code> function from the
<code>PhotoGEA</code> package, and it represents the photosynethetic
response of a C<sub>4</sub> leaf according to the model with
<code>Rd</code> = 1 micromol m^(-2) s^(-1), <code>Vpmax</code> = 150
micromol m^(-2) s^(-1), <code>Vcmax</code> = 30 micromol m^(-2) s^(-1),
<code>Vpr</code> = 80 micromol m^(-2) s^(-1), and a leaf temperature of
30 degrees C. Arrhenius temperature response parameters were taken from
<span class="citation">S. von Caemmerer (<a href="#ref-von_caemmerer_updating_2021" role="doc-biblioref">2021</a>)</span>.)</p>
<p>Thus, one of the most common reasons to measure an A-Ci curve is to
interpret it in the context of this model. In other words, by fitting
the model’s equations to a measured curve, it is possible to estimate
values for <code>Rd</code>, <code>Vpmax</code>, <code>Vcmax</code>, and
<code>Vpr</code>. See the documentation for
<code>calculate_c4_assimilation</code> for more information about these
important quantities.</p>
<p>As is evident from the figure above, rubisco activity and PEP
regeneration limitations actually both produce a very similar end
result, where <span class="math inline">\(A_n\)</span> becomes
essentially flat as <span class="math inline">\(P_{cm}\)</span>
increases. For this reason, it is practically impossible to distinguish
between the two types of limiting rates when analyzing a C<sub>4</sub>
A-Ci curve; if both limitations are considered simultaneously, it is not
usually possible for an optimization algorithm to determine a unique
solution. Because of this, it is common to set either <code>Vpr</code>
or <code>Vcmax</code> to a high value when fitting (so it never becomes
a limiting factor), and only allow the other to vary. In the rest of
this document, we will be setting <code>Vpr = 800</code> and only
allowing <code>Vcmax</code> to vary when performing fits; this is the
default behavior of the <code>fit_c4_aci</code> function from the
<code>PhotoGEA</code> package, which will be discussed later.</p>
</div>
<div class="section level3">
<h3 id="practicalities">Practicalities<a class="anchor" aria-label="anchor" href="#practicalities"></a>
</h3>
<p>There are a few important practicalities to keep in mind when
thinking about CO<sub>2</sub> response curves.</p>
<p>One point is that C4 photosynthesis models generally predict the
response of assimilation to the partial pressure of CO<sub>2</sub> in
the mesophyll (<span class="math inline">\(P_{cm}\)</span>), but gas
exchange measurements can only determine the CO<sub>2</sub>
concentration in the leaf’s intercellular spaces (<span class="math inline">\(C_i\)</span>). Thus, an extra step is required
when interpreting A-Ci curves. If the mesophyll conductance to
CO<sub>2</sub> (<span class="math inline">\(g_{mc}\)</span>) and the
total pressure (<span class="math inline">\(P\)</span>) are known, then
it is possible to calculate values of <span class="math inline">\(P_{cm}\)</span> from <span class="math inline">\(A_n\)</span>, <span class="math inline">\(C_i\)</span>, <span class="math inline">\(P\)</span>, and <span class="math inline">\(g_{mc}\)</span>. Otherwise, it is also possible to
assume an infinite mesophyll conductance; in this case, <span class="math inline">\(C_m = C_i\)</span>, and the estimated values of
<code>Vcmax</code> and other parameters can be considered to be
“effective values” describing the plant’s response to intercellular
CO<sub>2</sub>.</p>
<p>Another important point is that plants generally do not appreciate
being starved of CO<sub>2</sub>, so it is not usually possible to start
a response curve at low CO<sub>2</sub> and proceed upwards. A more
typical approach is to:</p>
<ol style="list-style-type: decimal">
<li>Begin at ambient atmospheric CO<sub>2</sub> levels.</li>
<li>Decrease towards a low value.</li>
<li>Return to ambient levels and wait for the plant to reacclimate; this
waiting period is usually accomplished by logging several points at
ambient CO<sub>2</sub> levels.</li>
<li>Increase to higher values.</li>
</ol>
<p>When taking this approach, it therefore becomes necessary to remove
the extra points measured at ambient CO<sub>2</sub> levels and to
reorder the points according to their CO<sub>2</sub> values before
plotting or analyzing them.</p>
</div>
<div class="section level3">
<h3 id="the-data">The Data<a class="anchor" aria-label="anchor" href="#the-data"></a>
</h3>
<p>A-Ci curves are commonly measured using a Licor portable
photosynthesis system such as the Li-6400 or Li-6800. These machines
record values of <span class="math inline">\(A_n\)</span>, <span class="math inline">\(g_{sw}\)</span>, and many other important
quantities. They produce two types of output files: plain-text and
Microsoft Excel. It is often more convenient to work with the Excel
files since the entries can be easily modified (for example, to remove
an extraneous row or add a new column). On the other hand, it can be
more difficult to access the file contents using other pieces of
software such as R. However, the <code>PhotoGEA</code> package reduces
this barrier by including tools for reading Licor Excel files in R,
which will be demonstrated in the following section.</p>
</div>
</div>
<div class="section level2">
<h2 id="loading-packages">Loading Packages<a class="anchor" aria-label="anchor" href="#loading-packages"></a>
</h2>
<p>As always, the first step is to load the packages we will be using.
In addition to <code>PhotoGEA</code>, we will also use the
<code>lattice</code> package for generating plots.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/eloch216/PhotoGEA" class="external-link">PhotoGEA</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lattice.r-forge.r-project.org/" class="external-link">lattice</a></span><span class="op">)</span></span></code></pre></div>
<p>If the <code>lattice</code> package is not installed on your R setup,
you can install it by typing
<code>install.packages('lattice')</code>.</p>
</div>
<div class="section level2">
<h2 id="loading-licor-data">Loading Licor Data<a class="anchor" aria-label="anchor" href="#loading-licor-data"></a>
</h2>
<p>The <code>PhotoGEA</code> package includes two files representing
A-Ci curves measured using two Li-6800 instruments. The data is stored
in Microsoft Excel files, and includes curves measured from two
different crop species (tobacco and soybean) and several different plots
of each. Each curve is a sixteen-point CO<sub>2</sub> response curve; in
other words, the CO<sub>2</sub> concentration in the air surrounding the
leaf was varied, and <span class="math inline">\(A_n\)</span> (among
other variables) was measured at each CO<sub>2</sub> setpoint. Although
these two files are based on real data, noise was added to it since it
is unpublished, so these files should only be used as examples.</p>
<p>The files will be stored on your computer somewhere in your R package
installation directory, and full paths to these files can be obtained
with <code>system.file</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define a vector of paths to the files we wish to load</span></span>
<span><span class="va">file_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata'</span>, <span class="st">'c4_aci_1.xlsx'</span>, package <span class="op">=</span> <span class="st">'PhotoGEA'</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata'</span>, <span class="st">'c4_aci_2.xlsx'</span>, package <span class="op">=</span> <span class="st">'PhotoGEA'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>To actually read the data in the files and store them in R objects,
we will use the <code>read_gasex_file</code> function from
<code>PhotoGEA</code>. Since there are multiple files to read, we will
call this function once for each file using <code>lapply</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load each file, storing the result in a list</span></span>
<span><span class="va">licor_exdf_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">file_paths</span>, <span class="kw">function</span><span class="op">(</span><span class="va">fpath</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/read_gasex_file.html">read_gasex_file</a></span><span class="op">(</span><span class="va">fpath</span>, <span class="st">'time'</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>The result from this command is an R list of “extended data frames”
(abbreviated as <code>exdf</code> objects). The <code>exdf</code> class
is a special data structure defined by the <code>PhotoGEA</code>
package. In many ways, an <code>exdf</code> object is equivalent to a
data frame, with the major difference being that an <code>exdf</code>
object includes the units of each column. For more information, type
<code><a href="../reference/exdf.html">?exdf</a></code> in the R terminal to access the built-in help menu
entry, or check out the <a href="working_with_extended_data_frames.html">Working With Extended Data
Frames</a> vignette.</p>
<p>Generally, it is more convenient to work with a single
<code>exdf</code> object rather than a list of them, so our next step
will be to combine the objects in the list. This action can be
accomplished using the <code>rbind</code> function, which combines
table-like objects by their rows; in other words, it stacks two or more
tables vertically. This action only makes sense if the tables have the
same columns, so before we combine the <code>exdf</code> objects, we
should make sure this is the case.</p>
<p>The <code>PhotoGEA</code> package includes a function called
<code>identify_common_columns</code> that can be used to get the names
of all columns that are present in all of the Licor files. Then, we can
extract just those columns, and then combine the <code>exdf</code>
objects into a single one.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the names of all columns that are present in all of the Licor files</span></span>
<span><span class="va">columns_to_keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">identify_common_columns</span>, <span class="va">licor_exdf_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract just these columns</span></span>
<span><span class="va">licor_exdf_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">licor_exdf_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span> , <span class="va">columns_to_keep</span>, <span class="cn">TRUE</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use `rbind` to combine all the data</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">licor_exdf_list</span><span class="op">)</span></span></code></pre></div>
<p>Now we have a single R object called <code>licor_data</code> that
includes all the data from several Licor Excel files. For more
information about consolidating information from multiple files, see the
<em>Common Patterns</em> section of the <a href="working_with_extended_data_frames.html#combining-data-from-several-files">Working
With Extended Data Frames</a> vignette.</p>
</div>
<div class="section level2">
<h2 id="validating-the-data">Validating the Data<a class="anchor" aria-label="anchor" href="#validating-the-data"></a>
</h2>
<p>Before attempting to fit the curves, it is a good idea to do some
basic checks of the data to ensure it is organized properly and that it
was measured properly.</p>
<div class="section level3">
<h3 id="basic-checks">Basic Checks<a class="anchor" aria-label="anchor" href="#basic-checks"></a>
</h3>
<p>First, we should make sure there is a column in the data whose value
uniquely identifies each curve. In this particular data set, several
“user constants” were defined while making the measurements that help to
identify each curve: <code>instrument</code>, <code>species</code>, and
<code>plot</code>. However, neither of these columns alone are
sufficient to uniquely identify each curve. We can solve this issue by
creating a new column that combines the values from each of these:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a new identifier column formatted like `instrument - species - plot`</span></span>
<span><span class="va">licor_data</span><span class="op">[</span> , <span class="st">'curve_identifier'</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">licor_data</span><span class="op">[</span> , <span class="st">'instrument'</span><span class="op">]</span>, <span class="st">'-'</span>, <span class="va">licor_data</span><span class="op">[</span> , <span class="st">'species'</span><span class="op">]</span>, <span class="st">'-'</span>, <span class="va">licor_data</span><span class="op">[</span> , <span class="st">'plot'</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>The next step is to make sure that this column correctly identifies
each response curve. To do this, we can use the
<code>check_licor_data</code> function from <code>PhotoGEA</code>. Here
we will supply the name of a column that should uniquely identify each
response curve (<code>curve_identifier</code>), the expected number of
points in each curve (<code>16</code>), the name of a “driving” column
that should follow the same sequence in each curve
(<code>CO2_r_sp</code>). If the data passes the checks, this function
will have no output and will not produce any messages. (For more
information, see the built-in help menu entry by typing
<code><a href="../reference/check_licor_data.html">?check_licor_data</a></code>.)</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make sure the data meets basic requirements</span></span>
<span><span class="fu"><a href="../reference/check_licor_data.html">check_licor_data</a></span><span class="op">(</span><span class="va">licor_data</span>, <span class="st">'curve_identifier'</span>, <span class="fl">16</span>, <span class="st">'CO2_r_sp'</span><span class="op">)</span></span></code></pre></div>
<p>However, if <code>check_licor_data</code> detects an issue, it will
print a helpful message to the R terminal. For example, if we had
specified the wrong number of points or the wrong identifier column, we
would get error messages:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_licor_data.html">check_licor_data</a></span><span class="op">(</span><span class="va">licor_data</span>, <span class="st">'curve_identifier'</span>, <span class="fl">15</span><span class="op">)</span></span>
<span><span class="co">#&gt;      curve_identifier npts</span></span>
<span><span class="co">#&gt; 1   ripe1 - maize - 5   16</span></span>
<span><span class="co">#&gt; 2 ripe1 - sorghum - 2   16</span></span>
<span><span class="co">#&gt; 3 ripe1 - sorghum - 3   16</span></span>
<span><span class="co">#&gt; 4   ripe2 - maize - 2   16</span></span>
<span><span class="co">#&gt; 5 ripe2 - sorghum - 3   16</span></span>
<span><span class="co">#&gt; Error in check_licor_data(licor_data, "curve_identifier", 15): One or more curves does not have the expected number of points.</span></span>
<span></span>
<span><span class="fu"><a href="../reference/check_licor_data.html">check_licor_data</a></span><span class="op">(</span><span class="va">licor_data</span>, <span class="st">'species'</span>, <span class="fl">16</span><span class="op">)</span></span>
<span><span class="co">#&gt;   species npts</span></span>
<span><span class="co">#&gt; 1   maize   32</span></span>
<span><span class="co">#&gt; 2 sorghum   48</span></span>
<span><span class="co">#&gt; Error in check_licor_data(licor_data, "species", 16): One or more curves does not have the expected number of points.</span></span>
<span></span>
<span><span class="fu"><a href="../reference/check_licor_data.html">check_licor_data</a></span><span class="op">(</span><span class="va">licor_data</span>, <span class="st">'curve_identifier'</span>, <span class="fl">16</span>, <span class="st">'Ci'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in check_licor_data(licor_data, "curve_identifier", 16, "Ci"): Point 1 from curve `ripe1 - maize - 5` has value `Ci = 95.1988547749169`, but the average value for this point across all curves is `Ci = 90.7350174923248`</span></span>
<span><span class="co">#&gt;   Point 1 from curve `ripe2 - maize - 2` has value `Ci = 112.053645568057`, but the average value for this point across all curves is `Ci = 90.7350174923248`</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plotting-the-a-ci-curves">Plotting the A-Ci Curves<a class="anchor" aria-label="anchor" href="#plotting-the-a-ci-curves"></a>
</h3>
<p>One qualitative way to check the data is to simply create a plot of
the A-Ci curves. In this situation, the <code>lattice</code> library
makes it simple to include each curve as its own separate subplot of a
figure. For example:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot all A-Ci curves in the data set</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">A</span> <span class="op">~</span> <span class="va">Ci</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">licor_data</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Intercellular CO2 concentration ['</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Ci</span>, <span class="st">']'</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Net CO2 assimilation rate ['</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">A</span>, <span class="st">']'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_c4_aci_curves_files/figure-html/plot_aci-1.png" width="720" style="display: block; margin: auto;"></p>
<p>Whoops! Why do these curves look so strange? Well, some of the issues
are related to the sequence of CO<sub>2</sub> values that was used when
measuring the curves. As discussed in <a href="#practicalities">Practicalities</a>, there are several repeated
points logged at the same CO<sub>2</sub> concentration, and the points
are not logged in order of ascending or descending concentration. In
fact, the sequence of CO<sub>2</sub> setpoints is as follows:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">licor_data</span><span class="op">[</span><span class="va">licor_data</span><span class="op">[</span>, <span class="st">'curve_identifier'</span><span class="op">]</span> <span class="op">==</span> <span class="st">'ripe2 - maize - 2'</span>, <span class="st">'CO2_r_sp'</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1]  400  300  200  150  100   75   50   20  400  400  600  800 1000 1200 1500</span></span>
<span><span class="co">#&gt; [16] 1800</span></span></code></pre></div>
<p>Ideally, we would like to remove the ninth and tenth points (where
the setpoint has been reset to 400 to allow the leaf to reacclimate to
ambient CO<sub>2</sub> levels), and reorder the data so it is arranged
from low to high values of <code>Ci</code>. This can be done using the
<code>organize_response_curve</code> function from
<code>PhotoGEA</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Remove points with duplicated `CO2_r_sp` values and order by `Ci`</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/organize_response_curve_data.html">organize_response_curve_data</a></span><span class="op">(</span></span>
<span>    <span class="va">licor_data</span>,</span>
<span>    <span class="st">'curve_identifier'</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>    <span class="st">'Ci'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now we can plot them again:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot all A-Ci curves in the data set</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">A</span> <span class="op">~</span> <span class="va">Ci</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">licor_data</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Intercellular CO2 concentration ['</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Ci</span>, <span class="st">']'</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Net CO2 assimilation rate ['</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">A</span>, <span class="st">']'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_c4_aci_curves_files/figure-html/unnamed-chunk-4-1.png" width="720" style="display: block; margin: auto;"></p>
<p>They still look a bit strange. Some of this is related to the noise
that was intentionally added to the data. Nevertheless, there are a few
points that we should probably exclude before attempting to fit the
curves. One issue is that the model <em>never</em> predicts a decrease
in <span class="math inline">\(A\)</span> when <span class="math inline">\(Ci\)</span> increases. So, it is usually a good
idea to exclude any points at high <span class="math inline">\(Ci\)</span> where <span class="math inline">\(A\)</span> is observed to decrease. This dropoff
in assimilation is due to one or more processes that are not captured by
the model, and the fits will be unreliable. We will remove these points
later, after we have made several other data quality checks.</p>
</div>
<div class="section level3">
<h3 id="additional-plots-for-qualitative-validation">Additional Plots for Qualitative Validation<a class="anchor" aria-label="anchor" href="#additional-plots-for-qualitative-validation"></a>
</h3>
<p>Sometimes a Licor will override the temperature or humidity controls
while making measurements; in this case, conditions inside the
measurement chamber may not be stable, and we may wish to exclude some
of these points. We can check for these types of issues by making more
plots. In the following sections, we will generate several different
plots to check each curve for quality.</p>
<div class="section level4">
<h4 id="humidity-control">Humidity Control<a class="anchor" aria-label="anchor" href="#humidity-control"></a>
</h4>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a plot to check humidity control</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">RHcham</span> <span class="op">+</span> <span class="va">`Humidifier_%`</span> <span class="op">+</span> <span class="va">`Desiccant_%`</span> <span class="op">~</span> <span class="va">Ci</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">licor_data</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Intercellular CO2 concentration ['</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Ci</span>, <span class="st">']'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_c4_aci_curves_files/figure-html/plot_humidity-1.png" width="720" style="display: block; margin: auto;"></p>
<p>Here, <code>Humidifier_%</code> and <code>Desiccant_%</code>
represent the flow from the humidifier and desiccant columns, where a
value of 0 indicates that the valve to the column is fully closed and a
value of 100 indicates that the valve to the column is fully opened.
<code>RHcham</code> represents the relative humidity inside the chamber
as a percentage (in other words, as a value between 0 and 100).</p>
<p>When these curves were measured, a chamber humidity setpoint was
specified. So, when looking at this plot, we should check that the
relative humidity is fairly constant during each curve. Typically, this
should be accompanied by relatively smooth changes in the valve
percentages as they accomodate changes in ambient humidity and leaf
photosynthesis. In this plot, all the data looks good.</p>
</div>
<div class="section level4">
<h4 id="temperature-control">Temperature Control<a class="anchor" aria-label="anchor" href="#temperature-control"></a>
</h4>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a plot to check temperature control</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">TleafCnd</span> <span class="op">+</span> <span class="va">Txchg</span> <span class="op">~</span> <span class="va">Ci</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">licor_data</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Intercellular CO2 concentration ['</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Ci</span>, <span class="st">']'</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Temperature ('</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">TleafCnd</span>, <span class="st">')'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_c4_aci_curves_files/figure-html/plot_temperature-1.png" width="720" style="display: block; margin: auto;"></p>
<p>Here, <code>TleafCnd</code> is the leaf temperature measured using a
thermocouple, and <code>Txchg</code> is the temperature of the heat
exhanger that is used to control the air temperature in the measurement
instrument. When these curves were measured, an exchanger setpoint was
specified. So, when looking at this plot, we should check that
<code>Txchg</code> is constant during each curve and that the leaf
temperature does not vary in an erratic way. In this plot, all the data
looks good.</p>
</div>
<div class="section level4">
<h4 id="co2-control">CO<sub>2</sub> Control<a class="anchor" aria-label="anchor" href="#co2-control"></a>
</h4>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a plot to check CO2 control</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">CO2_s</span> <span class="op">+</span> <span class="va">CO2_r</span> <span class="op">+</span> <span class="va">CO2_r_sp</span> <span class="op">~</span> <span class="va">Ci</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">licor_data</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Intercellular CO2 concentration ['</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Ci</span>, <span class="st">']'</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'CO2 concentration ('</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">CO2_r</span>, <span class="st">')'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_c4_aci_curves_files/figure-html/plot_co2-1.png" width="720" style="display: block; margin: auto;"></p>
<p>Here, <code>CO2_s</code> is the CO<sub>2</sub> concentration in the
sample cell, <code>CO2_r</code> is the CO<sub>2</sub> concentration in
the reference cell, and <code>CO2_r_sp</code> is the setpoint for
<code>CO2_r</code>. When these curves were measured, a sequence of
<code>CO2_r</code> values was specified, so, when looking at this plot,
we should check that <code>CO2_r</code> is close to
<code>CO2_r_sp</code>. We also expect that <code>CO2_s</code> should be
a bit lower than <code>CO2_r</code> because the leaf in the sample
chamber is assimilating CO<sub>2</sub>, which should reduce its
concentration in the surrounding air. (An exception to this rule occurs
at very low values of <code>CO2_r_sp</code>, since in this case there is
not enough carbon available to assimilate, and the leaf actually
releases CO<sub>2</sub> due to respiration.) In this plot, all the data
looks good.</p>
</div>
<div class="section level4">
<h4 id="stability">Stability<a class="anchor" aria-label="anchor" href="#stability"></a>
</h4>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a plot to check stability criteria</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">`A:OK`</span> <span class="op">+</span> <span class="va">`gsw:OK`</span> <span class="op">+</span> <span class="va">Stable</span> <span class="op">~</span> <span class="va">Ci</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">licor_data</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Intercellular CO2 concentration ['</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Ci</span>, <span class="st">']'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_c4_aci_curves_files/figure-html/plot_stability-1.png" width="720" style="display: block; margin: auto;"></p>
<p>When measuring response curves with a Licor, it is possible to
specify stability criteria for each point in addition to minimum and
maximum wait times. In other words, once the set point for the driving
variable is changed, the machine waits until the stability criteria are
met; there is a minimum waiting period, and also a maximum to prevent
the machine from waiting for too long.</p>
<p>When these curves were measured, stability criteria were supplied for
the net assimilation rate <code>A</code> and the stomatal conductance
<code>gsw</code>. The stability status for each was stored in the log
file because the appropriate logging option for stability was set. Now,
for each point, it is possible to check whether stability was achieved
or whether the point was logged because the maximum waiting period had
been met. If the maximum waiting period is reached and the plant has
still not stabilized, the data point may be unreliable, so it can be
helpful to check this information.</p>
<p>In the plot, <code>A:OK</code> indicates whether <code>A</code> was
stable (0 for no, 1 for yes), <code>gsw:OK</code> indicates whether
<code>gsw</code> was stable (0 for no, 1 for yes), and
<code>Stable</code> indicates the total number of stability conditions
that were met. So, we are looking for points where <code>Stable</code>
is 2. Otherwise, we can check the other traces to see whether
<code>A</code> or <code>gsw</code> was unstable.</p>
<p>Comparing these plots with the ones in <a href="#plotting-the-a-ci-curves">Plotting the A-Ci Curves</a>, it seems
that the unstable points correspond with some of the “odd-looking”
points in the A-Ci curves, so it is probably a good idea to remove them
before fitting the data.</p>
</div>
</div>
<div class="section level3">
<h3 id="cleaning-the-licor-data">Cleaning the Licor Data<a class="anchor" aria-label="anchor" href="#cleaning-the-licor-data"></a>
</h3>
<p>While checking over the plots in the previous sections, two issues
were noticed: (1) some points were logged before stability was achieved
and (2) some of the curves exhibit a decrease in <span class="math inline">\(A\)</span> at high values of <span class="math inline">\(C_i\)</span>. In this section, we will demonstrate
how to remove the unstable and unusual points.</p>
<p>The following command will keep only the points where
<code>Stable</code> is exactly 2; this condition means that all of the
stability criteria were satisfied. Sometimes, following this procedure,
a curve will have very few stable points remaining; it is usually a good
idea to automatically exclude any curve with fewer than three stable
points.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Only keep points where stability was achieved</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="va">licor_data</span><span class="op">[</span><span class="va">licor_data</span><span class="op">[</span>, <span class="st">'Stable'</span><span class="op">]</span> <span class="op">==</span> <span class="fl">2</span>, , <span class="cn">TRUE</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Remove any curves that have fewer than three remaining points</span></span>
<span><span class="va">npts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span><span class="va">licor_data</span>, <span class="va">licor_data</span><span class="op">[</span>, <span class="st">'curve_identifier'</span><span class="op">]</span>, <span class="va">nrow</span><span class="op">)</span></span>
<span><span class="va">ids_to_keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">npts</span><span class="op">[</span><span class="va">npts</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="va">licor_data</span><span class="op">[</span><span class="va">licor_data</span><span class="op">[</span>, <span class="st">'curve_identifier'</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ids_to_keep</span>, , <span class="cn">TRUE</span><span class="op">]</span></span></code></pre></div>
<p>Next, we can use the <code>remove_points</code> function from
<code>PhotoGEA</code> to exclude the points where there is a decrease in
<span class="math inline">\(A\)</span> at high <span class="math inline">\(C_i\)</span>. It just so happens that all of these
points were measured by the <code>ripe1</code> instrument and occur at
the highest CO<sub>2</sub> setpoint value, so it is easy to specify them
all at once:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Remove points where `instrument` is `ripe1` and `CO2_r_sp` is 1800</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/remove_points.html">remove_points</a></span><span class="op">(</span></span>
<span>  <span class="va">licor_data</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>instrument <span class="op">=</span> <span class="st">'ripe1'</span>, CO2_r_sp <span class="op">=</span> <span class="fl">1800</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="fitting-licor-data">Fitting Licor Data<a class="anchor" aria-label="anchor" href="#fitting-licor-data"></a>
</h2>
<p>Now that we have checked the data quality, we are ready to perform
the fitting. In order to fit the curves, there are several required
pieces of information that are not included in the Licor data files as
produced by the instrument: temperature-dependent values of important
photosynthetic parameters such as <span class="math inline">\(\gamma^*\)</span>, values of the total pressure,
and values of the partial pressure of CO<sub>2</sub> in the mesophyll
<span class="math inline">\(P_{cm}\)</span>. However, the
<code>PhotoGEA</code> package includes three functions to help with
these calculations: <code>calculate_arrhenius</code>,
<code>calculate_total_pressure</code>, and <code>apply_gm</code>. Each
of these requires an <code>exdf</code> object containing Licor data. The
units for each required column will be checked in an attempt to avoid
unit-related errors. More information about these functions can be
obtained from the built-in help system by typing
<code><a href="../reference/calculate_arrhenius.html">?calculate_arrhenius</a></code>,
<code><a href="../reference/calculate_total_pressure.html">?calculate_total_pressure</a></code>, or <code><a href="../reference/apply_gm.html">?apply_gm</a></code>.</p>
<p>First, we can use <code>calculate_arrhenius</code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate temperature-dependent values of C4 photosynthetic parameters</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_arrhenius.html">calculate_arrhenius</a></span><span class="op">(</span><span class="va">licor_data</span>, <span class="va">c4_arrhenius_von_caemmerer</span><span class="op">)</span></span></code></pre></div>
<p>With this simple command, we have used the leaf temperature from the
Licor file to calculate values of several key C4 photosynthetic
parameters (Vcmax_norm, Vpmax_norm, Rd_norm, Kc, Ko, Kp, gamma_star, ao,
gmc) according to the Arrhenius activation energies specified in <span class="citation">S. von Caemmerer (<a href="#ref-von_caemmerer_updating_2021" role="doc-biblioref">2021</a>)</span>. Notice that this command
calculated values of the mesophyll conductance to CO2 (<code>gmc</code>)
in units of mol m<span class="math inline">\(^{-2}\)</span> s<span class="math inline">\(^{-1}\)</span> bar<span class="math inline">\(^{-1}\)</span>. These values were estmated for
<em>Setaria viridis</em> and may not be appropriate for all C4 plants.
They can easily be overwritten to another value; here we will set
<code>gmc = 3.0 mol / m^2 / s / bar</code> for maize and
<code>gmc = Inf</code> for sorghum; in this case, the sorghum parameters
determined by the fitting process will be “effective” parameters.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Override default mesophyll conductance and specify different values for each</span></span>
<span><span class="co"># species</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_variable.html">set_variable</a></span><span class="op">(</span></span>
<span>  <span class="va">licor_data</span>, <span class="st">'gmc'</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">'species'</span>,</span>
<span>  value_table <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maize <span class="op">=</span> <span class="fl">3.0</span>, sorghum <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now we can use <code>calculate_total_pressure</code> and
<code>apply_gm</code> to calculate <code>PCm</code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate the total pressure in the Licor chamber</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_total_pressure.html">calculate_total_pressure</a></span><span class="op">(</span><span class="va">licor_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate PCm</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply_gm.html">apply_gm</a></span><span class="op">(</span></span>
<span>  <span class="va">licor_data</span>,</span>
<span>  <span class="st">'C4'</span> <span class="co"># Indicate C4 photosynthesis</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Together, these functions have added several new columns to
<code>licor_data</code>, including <code>gmc</code>, ‘PCm’,
‘gamma_star’, and others. With this information, we are now ready to
perform the fitting procedure. For this operation, we can use the
<code>fit_c4_aci</code> function from the <code>PhotoGEA</code> package,
which fits a single response curve to extract the values of key
photosynthetic parameters. To apply this function to each curve in a
larger data set and then consolidate the results, we can use it in
conjunction with <code>by</code> and <code>consolidate</code>, which are
also part of <code>PhotoGEA</code>. (For more information about these
functions, see the built-in help menu entries by typing
<code><a href="../reference/fit_c4_aci.html">?fit_c4_aci</a></code>, <code><a href="../reference/by.exdf.html">?by.exdf</a></code>, or
<code><a href="../reference/consolidate.html">?consolidate</a></code>, or check out the <em>Common Patterns</em>
section of the <a href="working_with_extended_data_frames.html#processing-multiple-pieces-of-an-extended-data-frame">Working
With Extended Data Frames</a> vignette.) Together, these functions will
split apart the main data using the curve identifier column we defined
before (<a href="#basic-checks">Basic Checks</a>), fit each A-Ci curve
using the model discussed in <a href="#understanding-c4-a-ci-curves">Understanding C4 A-Ci Curves</a>,
and return the resulting parameters and fits:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit the C4 A-Ci curves</span></span>
<span><span class="va">c4_aci_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/consolidate.html">consolidate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span></span>
<span>  <span class="va">licor_data</span>,                       <span class="co"># The `exdf` object containing the curves</span></span>
<span>  <span class="va">licor_data</span><span class="op">[</span>, <span class="st">'curve_identifier'</span><span class="op">]</span>, <span class="co"># A factor used to split `licor_data` into chunks</span></span>
<span>  <span class="va">fit_c4_aci</span>                        <span class="co"># The function to apply to each chunk of `licor_data`</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="viewing-the-fitted-curves">Viewing the Fitted Curves<a class="anchor" aria-label="anchor" href="#viewing-the-fitted-curves"></a>
</h3>
<p>Having made the fits, it is now a good idea to visually check them,
making sure they look reasonable. As before, we can use
<code>xyplot</code> from the <code>lattice</code> library to quickly
make plots of all the fits, which are stored in
<code>c4_aci_results$fits</code>, an <code>exdf</code> object:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the C4 A-Ci fits</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">A</span> <span class="op">+</span> <span class="va">A_fit</span> <span class="op">~</span> <span class="va">Ci</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Intercellular CO2 concentration ['</span>, <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Ci</span>, <span class="st">']'</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Net CO2 assimilation rate ['</span>, <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">A</span>, <span class="st">']'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_c4_aci_curves_files/figure-html/plot_fits-1.png" width="720" style="display: block; margin: auto;"></p>
<p>Note that in addition to the fitted values of <code>A</code>, the
output also includes values of the individual limiting rates
<code>Apc</code> and <code>Ar</code>. We can also take a look at these,
although they make the plots a bit busy. We can also choose to plot
assimilation against <code>PCm</code> rather than <code>Ci</code>:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the C4 A-PCm fits (including limiting rates)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">A</span> <span class="op">+</span> <span class="va">Apc</span> <span class="op">+</span> <span class="va">Ar</span> <span class="op">+</span> <span class="va">A_fit</span> <span class="op">~</span> <span class="va">PCm</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'l'</span>,</span>
<span>  auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'right'</span><span class="op">)</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Mesophyll CO2 pressure ['</span>, <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">PCm</span>, <span class="st">']'</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Net CO2 assimilation rate ['</span>, <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">A</span>, <span class="st">']'</span><span class="op">)</span>,</span>
<span>  par.settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    superpose.line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fu"><a href="../reference/multi_curve_colors.html">multi_curve_colors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    superpose.symbol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fu"><a href="../reference/multi_curve_colors.html">multi_curve_colors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_c4_aci_curves_files/figure-html/plot_fit_aci_limiting-1.png" width="720" style="display: block; margin: auto;"></p>
<p>Checking the residuals is also a powerful way to gauge the quality of
a fit. The output from <code>fit_c4_aci</code> includes the residuals
(calculated as <code>A - A_fit</code>) in its output, so it is easy to
plot them:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the residuals</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">A_residuals</span> <span class="op">~</span> <span class="va">Ci</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Intercellular CO2 concentration ['</span>, <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Ci</span>, <span class="st">']'</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Assimilation rate residual (measured - fitted)\n['</span>, <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">A</span>, <span class="st">']'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_c4_aci_curves_files/figure-html/plot_residuals-1.png" width="720" style="display: block; margin: auto;"></p>
<p>A good fit should produce small and randomly-distributed residuals;
here there is no clear pattern to the residuals, so this model is able
to reproduce the measured values fairly well.</p>
</div>
</div>
<div class="section level2">
<h2 id="examining-the-results">Examining the Results<a class="anchor" aria-label="anchor" href="#examining-the-results"></a>
</h2>
<div class="section level3">
<h3 id="visualizing-average-fit-parameters">Visualizing Average Fit Parameters<a class="anchor" aria-label="anchor" href="#visualizing-average-fit-parameters"></a>
</h3>
<p>Having performed the fits, we can now take a look at the fitted
parameter values, which are stored in
<code>c4_aci_results$parameters</code>, another <code>exdf</code>
object. One way to do this is by using the
<code>barchart_with_errorbars</code> function from <code>PhotoGEA</code>
to create barcharts of the average values for each species, such as the
following example showing the fitted values of <code>Vpmax</code>:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a barchart showing average Vpmax values</span></span>
<span><span class="fu"><a href="../reference/barchart_with_errorbars.html">barchart_with_errorbars</a></span><span class="op">(</span></span>
<span>  <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">parameters</span><span class="op">[</span>, <span class="st">'Vpmax_at_25'</span><span class="op">]</span>,</span>
<span>  <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">parameters</span><span class="op">[</span>, <span class="st">'species'</span><span class="op">]</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">150</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">'Species'</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Vpmax at 25 degrees C ['</span>, <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Vpmax_at_25</span>, <span class="st">']'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_c4_aci_curves_files/figure-html/vpmax_barchart-1.png" width="720" style="display: block; margin: auto;"></p>
<p>Another option is to create box-whisper plots using the
<code>bwplot</code> function from the <code>lattice</code> package. Here
we use this function to show values of <code>Vcmax</code>:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a boxplot showing the distribution of Vcmax values</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">bwplot</a></span><span class="op">(</span></span>
<span>  <span class="va">Vcmax_at_25</span> <span class="op">~</span> <span class="va">species</span>,</span>
<span>  data <span class="op">=</span> <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">60</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">'Species'</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Vcmax at 25 degrees C ['</span>, <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Vcmax_at_25</span>, <span class="st">']'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_c4_aci_curves_files/figure-html/vcmax_bwplot-1.png" width="720" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="accessing-raw-and-average-values-of-fit-parameters">Accessing Raw and Average Values of Fit Parameters<a class="anchor" aria-label="anchor" href="#accessing-raw-and-average-values-of-fit-parameters"></a>
</h3>
<p>We can also take a look at the raw numbers of the fitted parameters
and their average values. The <code>c4_aci_results$parameters</code>
object contains many columns but we only care about a few of them. We
can view them as follows:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View the C4 parameters</span></span>
<span><span class="va">columns_for_viewing</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'instrument'</span>, <span class="st">'species'</span>, <span class="st">'plot'</span>, <span class="st">'Rd_at_25'</span>, <span class="st">'Vcmax_at_25'</span>, <span class="st">'Vpmax_at_25'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">c4_aci_parameters</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">parameters</span><span class="op">[</span> , <span class="va">columns_for_viewing</span>, <span class="cn">TRUE</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">c4_aci_parameters</span><span class="op">)</span></span>
<span><span class="co">#&gt;   instrument [UserDefCon] (NA) species [UserDefCon] (NA) plot [UserDefCon] (NA)</span></span>
<span><span class="co">#&gt; 1                        ripe1                     maize                      5</span></span>
<span><span class="co">#&gt; 2                        ripe1                   sorghum                      2</span></span>
<span><span class="co">#&gt; 3                        ripe1                   sorghum                      3</span></span>
<span><span class="co">#&gt; 4                        ripe2                     maize                      2</span></span>
<span><span class="co">#&gt; 5                        ripe2                   sorghum                      3</span></span>
<span><span class="co">#&gt;   Rd_at_25 [fit_c4_aci] (micromol m^(-2) s^(-1))</span></span>
<span><span class="co">#&gt; 1                                       1.284540</span></span>
<span><span class="co">#&gt; 2                                       5.049738</span></span>
<span><span class="co">#&gt; 3                                       1.524589</span></span>
<span><span class="co">#&gt; 4                                       5.209604</span></span>
<span><span class="co">#&gt; 5                                       5.190008</span></span>
<span><span class="co">#&gt;   Vcmax_at_25 [fit_c4_aci] (micromol m^(-2) s^(-1))</span></span>
<span><span class="co">#&gt; 1                                          39.35481</span></span>
<span><span class="co">#&gt; 2                                          51.39206</span></span>
<span><span class="co">#&gt; 3                                          46.39016</span></span>
<span><span class="co">#&gt; 4                                          42.73374</span></span>
<span><span class="co">#&gt; 5                                          43.57417</span></span>
<span><span class="co">#&gt;   Vpmax_at_25 [fit_c4_aci] (micromol m^(-2) s^(-1))</span></span>
<span><span class="co">#&gt; 1                                         129.16466</span></span>
<span><span class="co">#&gt; 2                                         103.81965</span></span>
<span><span class="co">#&gt; 3                                          90.54414</span></span>
<span><span class="co">#&gt; 4                                         127.75304</span></span>
<span><span class="co">#&gt; 5                                         102.95831</span></span></code></pre></div>
<p>Alternatively, we can extract average values of the parameters for
each species using the <code>basic_stats</code> function from
<code>PhotoGEA</code>:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute the average and standard error of each parameter for each species</span></span>
<span><span class="va">c4_aci_averages</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_stats.html">basic_stats</a></span><span class="op">(</span><span class="va">c4_aci_results</span><span class="op">$</span><span class="va">parameters</span>, <span class="st">'species'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the averages and errors</span></span>
<span><span class="va">columns_to_view</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">'species'</span>,</span>
<span>  <span class="st">'Rd_at_25_avg'</span>, <span class="st">'Rd_at_25_stderr'</span>,</span>
<span>  <span class="st">'Vcmax_at_25_avg'</span>, <span class="st">'Vcmax_at_25_stderr'</span>,</span>
<span>  <span class="st">'Vpmax_at_25_avg'</span>, <span class="st">'Vpmax_at_25_stderr'</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">c4_aci_averages</span><span class="op">[</span> , <span class="va">columns_to_view</span>, <span class="cn">TRUE</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;   species [UserDefCon] (NA) Rd_at_25_avg [fit_c4_aci] (micromol m^(-2) s^(-1))</span></span>
<span><span class="co">#&gt; 1                     maize                                           3.247072</span></span>
<span><span class="co">#&gt; 2                   sorghum                                           3.921445</span></span>
<span><span class="co">#&gt;   Rd_at_25_stderr [fit_c4_aci] (micromol m^(-2) s^(-1))</span></span>
<span><span class="co">#&gt; 1                                              1.962532</span></span>
<span><span class="co">#&gt; 2                                              1.199112</span></span>
<span><span class="co">#&gt;   Vcmax_at_25_avg [fit_c4_aci] (micromol m^(-2) s^(-1))</span></span>
<span><span class="co">#&gt; 1                                              41.04428</span></span>
<span><span class="co">#&gt; 2                                              47.11880</span></span>
<span><span class="co">#&gt;   Vcmax_at_25_stderr [fit_c4_aci] (micromol m^(-2) s^(-1))</span></span>
<span><span class="co">#&gt; 1                                                 1.689461</span></span>
<span><span class="co">#&gt; 2                                                 2.286047</span></span>
<span><span class="co">#&gt;   Vpmax_at_25_avg [fit_c4_aci] (micromol m^(-2) s^(-1))</span></span>
<span><span class="co">#&gt; 1                                             128.45885</span></span>
<span><span class="co">#&gt; 2                                              99.10737</span></span>
<span><span class="co">#&gt;   Vpmax_at_25_stderr [fit_c4_aci] (micromol m^(-2) s^(-1))</span></span>
<span><span class="co">#&gt; 1                                                0.7058116</span></span>
<span><span class="co">#&gt; 2                                                4.2888289</span></span></code></pre></div>
<p>Of course, more advanced statistical tests to check for differences
between groups can also be performed within R using other packages such
as <code>onewaytests</code> or <code>DescTools</code>. Alternatively,
the parameter values can be exported to a comma-separated-value (CSV)
file and analyzed in another software environment like
<code>jmp</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="customizing-your-script">Customizing Your Script<a class="anchor" aria-label="anchor" href="#customizing-your-script"></a>
</h2>
<p>Note that most of the commands in this vignette have been written in
a general way so they can be used as the basis for your own analysis
script (see <a href="#commands-from-this-document">Commands From This
Document</a>). In order to use them in your own script, some or all of
the following changes may be required. There may also be others not
specifically mentioned here.</p>
<div class="section level3">
<h3 id="input-files">Input Files<a class="anchor" aria-label="anchor" href="#input-files"></a>
</h3>
<p>The file paths specified in <code>file_paths</code> will need to be
modified so they point to your Licor files. In your own script, you may
want to consider using the <code>choose_input_licor_files</code>
function from <code>PhotoGEA</code>; this function will create a pop-up
browser window where you can interactively select a set of Licor files.
Sometimes this is more convenient than writing out full file paths. For
example, you could replace the previous definition of
<code>file_paths</code> with this one:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Interactively define a vector of paths to the files we wish to load</span></span>
<span><span class="va">file_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/choose_input_files.html">choose_input_licor_files</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Unfortunately, <code>choose_input_licor_files</code> is only
available in interactive R sessions running on Microsoft Windows, but
there is also a platform-independent option:
<code>choose_input_files</code>. See the <em>Translation</em> section of
the <a href="developing_a_data_analysis_pipeline.html#translation">Developing a
Data Analysis Pipeline</a> vignette for more details.</p>
</div>
<div class="section level3">
<h3 id="curve-identifier">Curve Identifier<a class="anchor" aria-label="anchor" href="#curve-identifier"></a>
</h3>
<p>Depending on which user constants are defined in your Licor Excel
files, you may need to modify the definition of the
<code>curve_identifier</code> column.</p>
</div>
<div class="section level3">
<h3 id="data-cleaning">Data Cleaning<a class="anchor" aria-label="anchor" href="#data-cleaning"></a>
</h3>
<p>Depending on the qualitative data checks, you may need to change the
input arguments to <code>remove_points</code>. It might also not be
necessary to remove the unstable points before performing the fits.
Often, it is helpful to not perform any data cleaning at first, and then
remove problematic points if they seem to cause problems with the
fits.</p>
</div>
<div class="section level3">
<h3 id="averages-and-standard-errors">Averages and Standard Errors<a class="anchor" aria-label="anchor" href="#averages-and-standard-errors"></a>
</h3>
<p>Depending on how your data is organized, you may want to change the
column used to divide the data when calculating averages and standard
errors.</p>
</div>
<div class="section level3">
<h3 id="plots">Plots<a class="anchor" aria-label="anchor" href="#plots"></a>
</h3>
<p>You may need to change the axis limits in some or all of the plots.
Alternatively, you can remove them, allowing <code>xyplot</code> to
automatically choose them for you.</p>
</div>
<div class="section level3">
<h3 id="saving-results">Saving Results<a class="anchor" aria-label="anchor" href="#saving-results"></a>
</h3>
<p>You may want to use <code>write.csv</code> to save some or all of the
fitting results as <code>csv</code> files. For example, the following
commands will allow you to interactively choose output filenames for the
resulting <code>csv</code> files:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">c4_aci_results</span><span class="op">$</span><span class="va">fits</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.choose.html" class="external-link">file.choose</a></span><span class="op">(</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">c4_aci_results</span><span class="op">$</span><span class="va">parameters</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.choose.html" class="external-link">file.choose</a></span><span class="op">(</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">c4_aci_averages</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.choose.html" class="external-link">file.choose</a></span><span class="op">(</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="commands-from-this-document">Commands From This Document<a class="anchor" aria-label="anchor" href="#commands-from-this-document"></a>
</h2>
<p>The following code chunk includes all the central commands used
throughout this document. They are compiled here to make them easy to
copy/paste into a text file to initialize your own script. Annotation
has also been added to clearly indicate the four steps involved in data
analysis, as described in the <a href="developing_a_data_analysis_pipeline.html">Developing a Data
Analysis Pipeline</a> vignette.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">###</span></span>
<span><span class="co">### PRELIMINARIES:</span></span>
<span><span class="co">### Loading packages, defining constants, creating helping functions, etc.</span></span>
<span><span class="co">###</span></span>
<span></span>
<span><span class="co"># Load required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/eloch216/PhotoGEA" class="external-link">PhotoGEA</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lattice.r-forge.r-project.org/" class="external-link">lattice</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">###</span></span>
<span><span class="co">### TRANSLATION:</span></span>
<span><span class="co">### Creating convenient R objects from raw data files</span></span>
<span><span class="co">###</span></span>
<span></span>
<span><span class="co"># Define a vector of paths to the files we wish to load</span></span>
<span><span class="va">file_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata'</span>, <span class="st">'c4_aci_1.xlsx'</span>, package <span class="op">=</span> <span class="st">'PhotoGEA'</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata'</span>, <span class="st">'c4_aci_2.xlsx'</span>, package <span class="op">=</span> <span class="st">'PhotoGEA'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load each file, storing the result in a list</span></span>
<span><span class="va">licor_exdf_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">file_paths</span>, <span class="kw">function</span><span class="op">(</span><span class="va">fpath</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/read_gasex_file.html">read_gasex_file</a></span><span class="op">(</span><span class="va">fpath</span>, <span class="st">'time'</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the names of all columns that are present in all of the Licor files</span></span>
<span><span class="va">columns_to_keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">identify_common_columns</span>, <span class="va">licor_exdf_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract just these columns</span></span>
<span><span class="va">licor_exdf_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">licor_exdf_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span> , <span class="va">columns_to_keep</span>, <span class="cn">TRUE</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use `rbind` to combine all the data</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">licor_exdf_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co">###</span></span>
<span><span class="co">### VALIDATION:</span></span>
<span><span class="co">### Organizing the data, checking its consistency and quality, cleaning it</span></span>
<span><span class="co">###</span></span>
<span></span>
<span><span class="co"># Create a new identifier column formatted like `instrument - species - plot`</span></span>
<span><span class="va">licor_data</span><span class="op">[</span> , <span class="st">'curve_identifier'</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">licor_data</span><span class="op">[</span> , <span class="st">'instrument'</span><span class="op">]</span>, <span class="st">'-'</span>, <span class="va">licor_data</span><span class="op">[</span> , <span class="st">'species'</span><span class="op">]</span>, <span class="st">'-'</span>, <span class="va">licor_data</span><span class="op">[</span> , <span class="st">'plot'</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make sure the data meets basic requirements</span></span>
<span><span class="fu"><a href="../reference/check_licor_data.html">check_licor_data</a></span><span class="op">(</span><span class="va">licor_data</span>, <span class="st">'curve_identifier'</span>, <span class="fl">16</span>, <span class="st">'CO2_r_sp'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove points with duplicated `CO2_r_sp` values and order by `Ci`</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/organize_response_curve_data.html">organize_response_curve_data</a></span><span class="op">(</span></span>
<span>    <span class="va">licor_data</span>,</span>
<span>    <span class="st">'curve_identifier'</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>    <span class="st">'Ci'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot all A-Ci curves in the data set</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">A</span> <span class="op">~</span> <span class="va">Ci</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">licor_data</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Intercellular CO2 concentration ['</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Ci</span>, <span class="st">']'</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Net CO2 assimilation rate ['</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">A</span>, <span class="st">']'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make a plot to check humidity control</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">RHcham</span> <span class="op">+</span> <span class="va">`Humidifier_%`</span> <span class="op">+</span> <span class="va">`Desiccant_%`</span> <span class="op">~</span> <span class="va">Ci</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">licor_data</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Intercellular CO2 concentration ['</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Ci</span>, <span class="st">']'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make a plot to check temperature control</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">TleafCnd</span> <span class="op">+</span> <span class="va">Txchg</span> <span class="op">~</span> <span class="va">Ci</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">licor_data</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Intercellular CO2 concentration ['</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Ci</span>, <span class="st">']'</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Temperature ('</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">TleafCnd</span>, <span class="st">')'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make a plot to check CO2 control</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">CO2_s</span> <span class="op">+</span> <span class="va">CO2_r</span> <span class="op">+</span> <span class="va">CO2_r_sp</span> <span class="op">~</span> <span class="va">Ci</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">licor_data</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Intercellular CO2 concentration ['</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Ci</span>, <span class="st">']'</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'CO2 concentration ('</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">CO2_r</span>, <span class="st">')'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make a plot to check stability criteria</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">`A:OK`</span> <span class="op">+</span> <span class="va">`gsw:OK`</span> <span class="op">+</span> <span class="va">Stable</span> <span class="op">~</span> <span class="va">Ci</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">licor_data</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Intercellular CO2 concentration ['</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Ci</span>, <span class="st">']'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Only keep points where stability was achieved</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="va">licor_data</span><span class="op">[</span><span class="va">licor_data</span><span class="op">[</span>, <span class="st">'Stable'</span><span class="op">]</span> <span class="op">==</span> <span class="fl">2</span>, , <span class="cn">TRUE</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Remove any curves that have fewer than three remaining points</span></span>
<span><span class="va">npts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span><span class="va">licor_data</span>, <span class="va">licor_data</span><span class="op">[</span>, <span class="st">'curve_identifier'</span><span class="op">]</span>, <span class="va">nrow</span><span class="op">)</span></span>
<span><span class="va">ids_to_keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">npts</span><span class="op">[</span><span class="va">npts</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="va">licor_data</span><span class="op">[</span><span class="va">licor_data</span><span class="op">[</span>, <span class="st">'curve_identifier'</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ids_to_keep</span>, , <span class="cn">TRUE</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Remove points where `instrument` is `ripe1` and `CO2_r_sp` is 1800</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/remove_points.html">remove_points</a></span><span class="op">(</span></span>
<span>  <span class="va">licor_data</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>instrument <span class="op">=</span> <span class="st">'ripe1'</span>, CO2_r_sp <span class="op">=</span> <span class="fl">1800</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">###</span></span>
<span><span class="co">### PROCESSING:</span></span>
<span><span class="co">### Extracting new pieces of information from the data</span></span>
<span><span class="co">###</span></span>
<span></span>
<span><span class="co"># Calculate temperature-dependent values of C4 photosynthetic parameters</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_arrhenius.html">calculate_arrhenius</a></span><span class="op">(</span><span class="va">licor_data</span>, <span class="va">c4_arrhenius_von_caemmerer</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Override default mesophyll conductance and specify different values for each</span></span>
<span><span class="co"># species</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_variable.html">set_variable</a></span><span class="op">(</span></span>
<span>  <span class="va">licor_data</span>, <span class="st">'gmc'</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">'species'</span>,</span>
<span>  value_table <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maize <span class="op">=</span> <span class="fl">3.0</span>, sorghum <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the total pressure in the Licor chamber</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_total_pressure.html">calculate_total_pressure</a></span><span class="op">(</span><span class="va">licor_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate PCm</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply_gm.html">apply_gm</a></span><span class="op">(</span></span>
<span>  <span class="va">licor_data</span>,</span>
<span>  <span class="st">'C4'</span> <span class="co"># Indicate C4 photosynthesis</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the C4 A-Ci curves</span></span>
<span><span class="va">c4_aci_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/consolidate.html">consolidate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span></span>
<span>  <span class="va">licor_data</span>,                       <span class="co"># The `exdf` object containing the curves</span></span>
<span>  <span class="va">licor_data</span><span class="op">[</span>, <span class="st">'curve_identifier'</span><span class="op">]</span>, <span class="co"># A factor used to split `licor_data` into chunks</span></span>
<span>  <span class="va">fit_c4_aci</span>                        <span class="co"># The function to apply to each chunk of `licor_data`</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the C4 A-Ci fits</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">A</span> <span class="op">+</span> <span class="va">A_fit</span> <span class="op">~</span> <span class="va">Ci</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Intercellular CO2 concentration ['</span>, <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Ci</span>, <span class="st">']'</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Net CO2 assimilation rate ['</span>, <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">A</span>, <span class="st">']'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the C4 A-PCm fits (including limiting rates)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">A</span> <span class="op">+</span> <span class="va">Apc</span> <span class="op">+</span> <span class="va">Ar</span> <span class="op">+</span> <span class="va">A_fit</span> <span class="op">~</span> <span class="va">PCm</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'l'</span>,</span>
<span>  auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'right'</span><span class="op">)</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Mesophyll CO2 pressure ['</span>, <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">PCm</span>, <span class="st">']'</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Net CO2 assimilation rate ['</span>, <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">A</span>, <span class="st">']'</span><span class="op">)</span>,</span>
<span>  par.settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    superpose.line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fu"><a href="../reference/multi_curve_colors.html">multi_curve_colors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    superpose.symbol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fu"><a href="../reference/multi_curve_colors.html">multi_curve_colors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the residuals</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">A_residuals</span> <span class="op">~</span> <span class="va">Ci</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Intercellular CO2 concentration ['</span>, <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Ci</span>, <span class="st">']'</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Assimilation rate residual (measured - fitted)\n['</span>, <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">A</span>, <span class="st">']'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">###</span></span>
<span><span class="co">### SYNTHESIS:</span></span>
<span><span class="co">### Using plots and statistics to help draw conclusions from the data</span></span>
<span><span class="co">###</span></span>
<span></span>
<span><span class="co"># Make a barchart showing average Vpmax values</span></span>
<span><span class="fu"><a href="../reference/barchart_with_errorbars.html">barchart_with_errorbars</a></span><span class="op">(</span></span>
<span>  <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">parameters</span><span class="op">[</span>, <span class="st">'Vpmax_at_25'</span><span class="op">]</span>,</span>
<span>  <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">parameters</span><span class="op">[</span>, <span class="st">'species'</span><span class="op">]</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">150</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">'Species'</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Vpmax at 25 degrees C ['</span>, <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Vpmax_at_25</span>, <span class="st">']'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make a boxplot showing the distribution of Vcmax values</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">bwplot</a></span><span class="op">(</span></span>
<span>  <span class="va">Vcmax_at_25</span> <span class="op">~</span> <span class="va">species</span>,</span>
<span>  data <span class="op">=</span> <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">60</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">'Species'</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Vcmax at 25 degrees C ['</span>, <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Vcmax_at_25</span>, <span class="st">']'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the C4 parameters</span></span>
<span><span class="va">columns_for_viewing</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'instrument'</span>, <span class="st">'species'</span>, <span class="st">'plot'</span>, <span class="st">'Rd_at_25'</span>, <span class="st">'Vcmax_at_25'</span>, <span class="st">'Vpmax_at_25'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">c4_aci_parameters</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">c4_aci_results</span><span class="op">$</span><span class="va">parameters</span><span class="op">[</span> , <span class="va">columns_for_viewing</span>, <span class="cn">TRUE</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">c4_aci_parameters</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute the average and standard error of each parameter for each species</span></span>
<span><span class="va">c4_aci_averages</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_stats.html">basic_stats</a></span><span class="op">(</span><span class="va">c4_aci_results</span><span class="op">$</span><span class="va">parameters</span>, <span class="st">'species'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the averages and errors</span></span>
<span><span class="va">columns_to_view</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">'species'</span>,</span>
<span>  <span class="st">'Rd_at_25_avg'</span>, <span class="st">'Rd_at_25_stderr'</span>,</span>
<span>  <span class="st">'Vcmax_at_25_avg'</span>, <span class="st">'Vcmax_at_25_stderr'</span>,</span>
<span>  <span class="st">'Vpmax_at_25_avg'</span>, <span class="st">'Vpmax_at_25_stderr'</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">c4_aci_averages</span><span class="op">[</span> , <span class="va">columns_to_view</span>, <span class="cn">TRUE</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-caemmerer_biochemical_2000" class="csl-entry">
Caemmerer, S. von. 2000. <em>Biochemical <span>Models</span> of
<span>Leaf</span> <span>Photosynthesis</span></em>. CSIRO Publishing. <a href="https://doi.org/10.1071/9780643103405" class="external-link">https://doi.org/10.1071/9780643103405</a>.
</div>
<div id="ref-von_caemmerer_updating_2021" class="csl-entry">
Caemmerer, Susanne von. 2021. <span>“Updating the Steady-State Model of
<span>C4</span> Photosynthesis.”</span> <em>Journal of Experimental
Botany</em> 72 (17): 6003–17. <a href="https://doi.org/10.1093/jxb/erab266" class="external-link">https://doi.org/10.1093/jxb/erab266</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Edward B. Lochocki.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
