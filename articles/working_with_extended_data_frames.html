<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Working With Extended Data Frames • PhotoGEA</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Working With Extended Data Frames">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    padding-top: 70px;

    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PhotoGEA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/PhotoGEA.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/analyzing_ball_berry_data.html">Analyzing Ball-Berry Data</a></li>
    <li><a class="dropdown-item" href="../articles/analyzing_c3_aci_curves.html">Analyzing C3 A-Ci Curves</a></li>
    <li><a class="dropdown-item" href="../articles/analyzing_c4_aci_curves.html">Analyzing C4 A-Ci Curves</a></li>
    <li><a class="dropdown-item" href="../articles/analyzing_gm_data.html">Analyzing Mesophyll Conductance Data</a></li>
    <li><a class="dropdown-item" href="../articles/analyzing_tdl_data.html">Analyzing TDL Data</a></li>
    <li><a class="dropdown-item" href="../articles/combining_with_other_packages.html">Combining PhotoGEA With Other Packages</a></li>
    <li><a class="dropdown-item" href="../articles/creating_your_own_processing_tools.html">Creating Your Own Processing Tools</a></li>
    <li><a class="dropdown-item" href="../articles/developing_a_data_analysis_pipeline.html">Developing a Data Analysis Pipeline</a></li>
    <li><a class="dropdown-item" href="../articles/working_with_extended_data_frames.html">Working With Extended Data Frames</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/eloch216/PhotoGEA/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Working With Extended Data Frames</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/eloch216/PhotoGEA/blob/main/vignettes/working_with_extended_data_frames.Rmd" class="external-link"><code>vignettes/working_with_extended_data_frames.Rmd</code></a></small>
      <div class="d-none name"><code>working_with_extended_data_frames.Rmd</code></div>
    </div>

    
    
<style type="text/css">
p.caption {
  font-size: 0.8em;
}
</style>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The <em>extended data frame</em> (abbreviated as <code>exdf</code>)
class is a special data structure defined by the <code>PhotoGEA</code>
package. In many ways, an <code>exdf</code> object is equivalent to a
data frame, with the major difference being that an <code>exdf</code>
object includes the units and “category” of each column. The
<code>exdf</code> class was originally created as a way to represent the
contents of a Licor Excel file in an R structure. In Licor Excel files,
the data is arranged in a table where each column has a name, units, and
a category; for example, the column for values of net assimilation rate
is called <code>A</code>, has units of <code>micromol / m^2 / s</code>,
and is categorized as a <code>GasEx</code> variable.</p>
<div class="figure" style="text-align: center">
<img src="images%2Fexdf_illustration.png" alt="Illustration comparing data frames (left) to extended data frames (right)." width="95%"><p class="caption">
Illustration comparing data frames (left) to extended data frames
(right).
</p>
</div>
<p>Because <code>exdf</code> objects keep track of the units for each
column, functions acting on <code>exdf</code> objects are able to check
that important variables have the correct units, ensuring that the
output they produce is correct. Additionally, the category for each
column can be used to store other important information about it, such
as the function that was used to calculate its values. For example, the
<code>calculate_ball_berry_index</code> function takes an
<code>exdf</code> object as an input and (1) checks whether the net
assimilation, relative humidity, and CO<sub>2</sub> concentration
columns of the object have the expected units, (2) adds a new column
containing values of the Ball-Berry index, and (3) uses the category of
the new column to indicate it was calculated by
<code>calculate_ball_berry_index</code>.</p>
<p>Thus, <code>exdf</code> objects provide a clear method for ensuring
that requirements about units are met before making calculations and for
retaining a record of how the values of new columns were calculated.
Because of these important properties, nearly all functions in the
<code>PhotoGEA</code> package create or modify <code>exdf</code> objects
rather than regular data frames. In the following sections, this
vignette will demonstrate how to create <code>exdf</code> objects,
extract information from them, and modify their contents.</p>
<p><em>Note</em>: here, we will assume that you have some basic
familiarity with common R data structures like lists, vectors, and data
frames. If you are unfamiliar with these, it may be helpful to consult
with another online guide or tutorial such as the <a href="http://adv-r.had.co.nz/Data-structures.html" class="external-link">Data Structures</a>
chapter from <em>Advanced R</em>.</p>
</div>
<div class="section level2">
<h2 id="loading-packages">Loading Packages<a class="anchor" aria-label="anchor" href="#loading-packages"></a>
</h2>
<p>As always, the first step is to load the packages we will be using.
In addition to <code>PhotoGEA</code>, we will also use the
<code>lattice</code> package for generating plots.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/eloch216/PhotoGEA" class="external-link">PhotoGEA</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lattice.r-forge.r-project.org/" class="external-link">lattice</a></span><span class="op">)</span></span></code></pre></div>
<p>If the <code>lattice</code> package is not installed on your R setup,
you can install it by typing
<code>install.packages('lattice')</code>.</p>
</div>
<div class="section level2">
<h2 id="basic-properties-of-an-extended-data-frame">Basic Properties of an Extended Data Frame<a class="anchor" aria-label="anchor" href="#basic-properties-of-an-extended-data-frame"></a>
</h2>
<p>From a technical point of view, an <code>exdf</code> object is simply
an R list with the following properties:</p>
<ul>
<li>It must contain elements named <code>main_data</code>,
<code>units</code>, and <code>categories</code>.</li>
<li>Each of these required elements must be a data frame.</li>
<li>Each of these required elements must have the same column names,
which can be thought of as the column names for the <code>exdf</code>
object as a whole.</li>
<li>The <code>units</code> data frame must contain just one row, whose
values specify the units for each column.</li>
<li>The <code>categories</code> element must have one row containing the
category of each column.</li>
<li>The <code>main_data</code> data frame can have any number of rows
and contains the main data of the <code>exdf</code> object.</li>
</ul>
<p>The function <code>is.exdf</code> can be used to check whether any R
object is an extended data frame. By default, it performs a simple check
on the information returned by the <code>class</code> function, but it
also has an option to perform a more detailed check of each requirement
listed above. For more information, type <code><a href="../reference/is.exdf.html">?is.exdf</a></code> in the R
terminal to access the help menu entry for <code>is.exdf</code>.</p>
<p>Besides these three required elements, it is also possible for an
<code>exdf</code> object to have additional entries such as a
<code>filename</code> that stores the name of the file that was used to
create the <code>exdf</code>. There are no restrictions on the types of
these “extra” elements; they could be numeric values, strings, vectors,
data frames, other lists, etc. Of course, they should not be named
<code>main_data</code>, <code>units</code>, or
<code>categories</code>.</p>
</div>
<div class="section level2">
<h2 id="creating-extended-data-frames">Creating Extended Data Frames<a class="anchor" aria-label="anchor" href="#creating-extended-data-frames"></a>
</h2>
<p>There are three main ways to create an <code>exdf</code> object:</p>
<ul>
<li>From three separate data frames specifying the main data, units, and
categories of the new <code>exdf</code> object.</li>
<li>From a single data frame representing the main data of the new
<code>exdf</code> object; in this case, units and categories will be
initialized to <code>NA</code>.</li>
<li>From a data file such as a Licor Excel file or a tunable diode laser
(TDL) output file.</li>
</ul>
<p>In the following sections, we will demonstrate each of these
methods.</p>
<div class="section level3">
<h3 id="specifying-main-data-units-and-categories">Specifying Main Data, Units, and Categories<a class="anchor" aria-label="anchor" href="#specifying-main-data-units-and-categories"></a>
</h3>
<p>As an example of the first method, we will create an extended data
frame called <code>exdf_1</code> with two columns named <code>A</code>
and <code>B</code>. These two columns will have units of <code>m</code>
and <code>s</code> and categories of <code>Cat1</code> and
<code>Cat2</code>, respectively.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exdf_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/exdf.html">exdf</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">7</span>, <span class="fl">9</span><span class="op">)</span>, B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>A <span class="op">=</span> <span class="st">'m'</span>, B <span class="op">=</span> <span class="st">'s'</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>A <span class="op">=</span> <span class="st">'Cat1'</span>, B <span class="op">=</span> <span class="st">'Cat2'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can view a nicely-formatted version of the object using the
<code>print</code> command:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">exdf_1</span><span class="op">)</span></span>
<span><span class="co">#&gt;   A [Cat1] (m) B [Cat2] (s)</span></span>
<span><span class="co">#&gt; 1            3            4</span></span>
<span><span class="co">#&gt; 2            2            5</span></span>
<span><span class="co">#&gt; 3            7            1</span></span>
<span><span class="co">#&gt; 4            9            8</span></span></code></pre></div>
<p>Notice that each column descriptor in the printed version is
formatted as <code>name [category] (units)</code>.</p>
</div>
<div class="section level3">
<h3 id="initializing-with-default-units-and-categories">Initializing with Default Units and Categories<a class="anchor" aria-label="anchor" href="#initializing-with-default-units-and-categories"></a>
</h3>
<p>As an example of the second method, we will create an extended data
frame called <code>exdf_2</code> with two columns named <code>A</code>
and <code>B</code>, but we won’t specify their units or categories.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exdf_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/exdf.html">exdf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">7</span>, <span class="fl">9</span><span class="op">)</span>, B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>As before, we can <code>print</code> the data frame:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">exdf_2</span><span class="op">)</span></span>
<span><span class="co">#&gt;   A [NA] (NA) B [NA] (NA)</span></span>
<span><span class="co">#&gt; 1           3           4</span></span>
<span><span class="co">#&gt; 2           2           5</span></span>
<span><span class="co">#&gt; 3           7           1</span></span>
<span><span class="co">#&gt; 4           9           8</span></span></code></pre></div>
<p>The units and categories have been initialized to default values of
<code>NA</code>, but we can supply new units and categories using the
<code>document_variables</code> function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exdf_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/document_variables.html">document_variables</a></span><span class="op">(</span><span class="va">exdf_2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Cat1'</span>, <span class="st">'A'</span>, <span class="st">'m'</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Cat2'</span>, <span class="st">'B'</span>, <span class="st">'s'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now <code>exdf_2</code> is identical to <code>exdf_1</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">exdf_1</span>, <span class="va">exdf_2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Sometimes this method is more convenient than the previous one.</p>
</div>
<div class="section level3">
<h3 id="reading-from-an-instrument-log-file">Reading From an Instrument Log File<a class="anchor" aria-label="anchor" href="#reading-from-an-instrument-log-file"></a>
</h3>
<p>As an example of the third method, we will create an extended data
frame from a Microsoft Excel file containing Licor measurements.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exdf_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_gasex_file.html">read_gasex_file</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/PhotoGEA_example_file_path.html">PhotoGEA_example_file_path</a></span><span class="op">(</span><span class="st">'ball_berry_1.xlsx'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This new object has many columns and rows, so we won’t print it here.
However, we can confirm that it is indeed a properly-defined
<code>exdf</code> object:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/is.exdf.html">is.exdf</a></span><span class="op">(</span><span class="va">exdf_3</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="writing-to-and-reading-from-csv-files">Writing to and Reading From CSV Files<a class="anchor" aria-label="anchor" href="#writing-to-and-reading-from-csv-files"></a>
</h2>
<p>Any <code>exdf</code> object can be saved to a CSV file using the
<code>write.csv.exdf</code> function. For example, the Licor log file
discussed above can be saved to a CSV file as follows:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/csv.exdf.html">write.csv.exdf</a></span><span class="op">(</span><span class="va">exdf_3</span>, file <span class="op">=</span> <span class="st">'ball_berry_1.csv'</span><span class="op">)</span></span></code></pre></div>
<p>CSV files created using <code>write.csv.exdf</code> can be read later
using <code>read.csv.exdf</code>, which will create an <code>exdf</code>
object from the information in the file. For example, the CSV file
created with the last command can be read as follows:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exdf_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/csv.exdf.html">read.csv.exdf</a></span><span class="op">(</span><span class="st">'ball_berry_1.csv'</span><span class="op">)</span></span></code></pre></div>
<p>Writing an <code>exdf</code> to a CSV file and then reading it again
preserves all of its information, including categories, units, and
column names. Because of this, the <code>exdf_4</code> should be
identical to <code>exdf_3</code>.</p>
</div>
<div class="section level2">
<h2 id="extracting-information-from-extended-data-frames">Extracting Information from Extended Data Frames<a class="anchor" aria-label="anchor" href="#extracting-information-from-extended-data-frames"></a>
</h2>
<p>There are three main ways to extract information from an extended
data frame:</p>
<ul>
<li>The “top-level” elements such as <code>main_data</code> and
<code>units</code> can be directly accessed.</li>
<li>Columns or other subsets of the <code>main_data</code> element can
be accessed.</li>
<li>An extended data frame with a subset of the original data can be
obtained.</li>
</ul>
<p>In the following sections, we will demonstrate each of these
possibilities. They are also described in a help page that can be
accessed from within R by typing <code><a href="../reference/extract.exdf.html">?extract.exdf</a></code>.</p>
<div class="section level3">
<h3 id="accessing-top-level-elements">Accessing Top-Level Elements<a class="anchor" aria-label="anchor" href="#accessing-top-level-elements"></a>
</h3>
<p>Because an extended data frame is technically just a list, its
“top-level” elements can be viewed using <code>names</code>,
<code>$</code>, and <code>[[</code>. For example, all of the top-level
elements can be retrieved using <code>names</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">exdf_1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "main_data"  "units"      "categories"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">exdf_3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "main_data"         "units"             "categories"       </span></span>
<span><span class="co">#&gt; [4] "preamble"          "data_row"          "file_name"        </span></span>
<span><span class="co">#&gt; [7] "file_type"         "instrument_type"   "timestamp_colname"</span></span></code></pre></div>
<p>Here we see that both <code>exdf</code> objects have the three
required elements: <code>main_data</code>, <code>units</code>, and
<code>categories</code>. <code>exdf_3</code> has a few “extra” elements
that were automatically created by the <code>read_gasex_file</code>
function. Any of these top-level elements be accessed by name using the
<code>$</code> and <code>[[</code> operators:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exdf_1</span><span class="op">$</span><span class="va">units</span></span>
<span><span class="co">#&gt;   A B</span></span>
<span><span class="co">#&gt; 1 m s</span></span>
<span></span>
<span><span class="va">exdf_3</span><span class="op">[[</span><span class="st">'file_name'</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] "/home/runner/work/_temp/Library/PhotoGEA/extdata/ball_berry_1.xlsx"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="accessing-the-main-data-frame">Accessing The Main Data Frame<a class="anchor" aria-label="anchor" href="#accessing-the-main-data-frame"></a>
</h3>
<p>When <code>colnames</code> or the <code>[</code> operator are applied
to an <code>exdf</code> object, they act directly on the object’s
<code>main_data</code> element. For example, the following commands are
equivalent ways to access the column names of <code>exdf_1</code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">exdf_1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "A" "B"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">exdf_1</span><span class="op">$</span><span class="va">main_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "A" "B"</span></span></code></pre></div>
<p>Likewise, the following commands are equivalent ways to extract the
<code>A</code> column from <code>exdf_1</code> as a vector:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exdf_1</span><span class="op">[</span>, <span class="st">'A'</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 3 2 7 9</span></span>
<span></span>
<span><span class="va">exdf_1</span><span class="op">$</span><span class="va">main_data</span><span class="op">[</span>, <span class="st">'A'</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 3 2 7 9</span></span>
<span></span>
<span><span class="va">exdf_1</span><span class="op">$</span><span class="va">main_data</span><span class="op">$</span><span class="va">A</span></span>
<span><span class="co">#&gt; [1] 3 2 7 9</span></span></code></pre></div>
<p>It is usually preferable to apply these functions to the
<code>exdf</code> object rather than its <code>main_data</code> element
since the resulting code is cleaner.</p>
</div>
<div class="section level3">
<h3 id="creating-a-subset">Creating a Subset<a class="anchor" aria-label="anchor" href="#creating-a-subset"></a>
</h3>
<p>Sometimes it is necessary to extract a subset of an <code>exdf</code>
object. For example, we may wish to extract just the rows from
<code>exdf_1</code> where the value of the <code>A</code> column is
greater than 5, keeping all the columns. This can be accomplished as
follows, using a syntax that is nearly identical to the syntax of
extracting a subset of a data frame:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exdf_1</span><span class="op">[</span><span class="va">exdf_1</span><span class="op">[</span>, <span class="st">'A'</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">5</span>, , return_exdf <span class="op">=</span> <span class="cn">TRUE</span><span class="op">]</span></span>
<span><span class="co">#&gt;   A [Cat1] (m) B [Cat2] (s)</span></span>
<span><span class="co">#&gt; 3            7            1</span></span>
<span><span class="co">#&gt; 4            9            8</span></span></code></pre></div>
<p>Here it is critical to specify <code>return_exdf = TRUE</code>;
otherwise, the command will instead return a subset of the
<code>exdf</code> object’s <code>main_data</code> element, as discussed
in <a href="#accessing-the-main-data-frame">Accessing The Main Data
Frame</a>:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/is.exdf.html">is.exdf</a></span><span class="op">(</span><span class="va">exdf_1</span><span class="op">[</span><span class="va">exdf_1</span><span class="op">[</span>, <span class="st">'A'</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">5</span>, , <span class="cn">TRUE</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame</a></span><span class="op">(</span><span class="va">exdf_1</span><span class="op">[</span><span class="va">exdf_1</span><span class="op">[</span>, <span class="st">'A'</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">5</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="modifying-extended-data-frames">Modifying Extended Data Frames<a class="anchor" aria-label="anchor" href="#modifying-extended-data-frames"></a>
</h2>
<p>As is the case with extracting information, it is possible to modify
the “top-level” elements of an <code>exdf</code> object as well as the
contents of its <code>main_data</code>. The following sections provide
examples of both types of operations.</p>
<div class="section level3">
<h3 id="modifying-top-level-elements">Modifying Top-Level Elements<a class="anchor" aria-label="anchor" href="#modifying-top-level-elements"></a>
</h3>
<p>Top-level elements can be added or modified using
<code>[[&lt;-</code> and <code>$&lt;-</code> as with any list. As an
example, we will change the <code>file_name</code> element of
<code>exdf_3</code> and add a new top-level element:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exdf_3</span><span class="op">$</span><span class="va">file_name</span> <span class="op">&lt;-</span> <span class="st">'new_file_name.xlsx'</span></span>
<span></span>
<span><span class="va">exdf_3</span><span class="op">[[</span><span class="st">'new_element'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">5</span></span></code></pre></div>
<p>We can confirm the changes:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exdf_3</span><span class="op">$</span><span class="va">file_name</span></span>
<span><span class="co">#&gt; [1] "new_file_name.xlsx"</span></span>
<span></span>
<span><span class="va">exdf_3</span><span class="op">$</span><span class="va">new_element</span></span>
<span><span class="co">#&gt; [1] 5</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="modifying-the-main-data">Modifying the Main Data<a class="anchor" aria-label="anchor" href="#modifying-the-main-data"></a>
</h3>
<p>The contents of the <code>main_data</code> of an <code>exdf</code>
object can be modified using the <code>[&lt;-</code> operator. For
example, we could add 1 to each value in the <code>A</code> column of
<code>exdf_2</code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exdf_2</span><span class="op">[</span>, <span class="st">'A'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">exdf_2</span><span class="op">[</span>, <span class="st">'A'</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span></span></code></pre></div>
<p>We could also add a new column called <code>C</code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exdf_2</span><span class="op">[</span>, <span class="st">'C'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">7</span></span></code></pre></div>
<p>In this case, the units and category of the new column will be
initialized to <code>NA</code>:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">exdf_2</span><span class="op">)</span></span>
<span><span class="co">#&gt;   A [Cat1] (m) B [Cat2] (s) C [NA] (NA)</span></span>
<span><span class="co">#&gt; 1            4            4           7</span></span>
<span><span class="co">#&gt; 2            3            5           7</span></span>
<span><span class="co">#&gt; 3            8            1           7</span></span>
<span><span class="co">#&gt; 4           10            8           7</span></span></code></pre></div>
<p>The units and category of the new column can be modified later with
<code>document_variables</code> as in <a href="#initializing-with-default-units-and-categories">Initializing with
Default Units and Categories</a>.</p>
<p>Alternatively, the <code>set_variable</code> function can be used to
set the value, units, and category of a column in an extended data frame
in one step. Here we use this function to add a new column called
<code>D</code> with units of <code>kg</code> and category
<code>cat4</code> whose value is 20:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exdf_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_variable.html">set_variable</a></span><span class="op">(</span><span class="va">exdf_2</span>, <span class="st">'D'</span>, <span class="st">'kg'</span>, <span class="st">'cat4'</span>, <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">exdf_2</span><span class="op">)</span></span>
<span><span class="co">#&gt;   A [Cat1] (m) B [Cat2] (s) C [NA] (NA) D [cat4] (kg)</span></span>
<span><span class="co">#&gt; 1            4            4           7            20</span></span>
<span><span class="co">#&gt; 2            3            5           7            20</span></span>
<span><span class="co">#&gt; 3            8            1           7            20</span></span>
<span><span class="co">#&gt; 4           10            8           7            20</span></span></code></pre></div>
<p>The <code>set_variable</code> function also has more advanced
abilities to set separate values of a column for different subsets of an
extended data frame; for more information, see its help menu entry by
typing <code><a href="../reference/set_variable.html">?set_variable</a></code>.</p>
<p><strong>Important note</strong>: It is generally a bad idea to
directly modify <code>main_data</code> because this can cause problems.
For example, we could try adding another new column called
<code>E</code> using the following code:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exdf_2</span><span class="op">$</span><span class="va">main_data</span><span class="op">$</span><span class="va">E</span> <span class="op">&lt;-</span> <span class="fl">17</span></span></code></pre></div>
<p>Now, <code>exdf_2</code> is no longer a properly defined
<code>exdf</code> object because there is a <code>E</code> column in
<code>exdf_2$main_data</code> that is not present in
<code>exdf_2$units</code> or <code>exdf_2$categories</code>. This may
prevent other functions from working properly; for example,
<code>print</code> will not properly display the <code>E</code> column.
This is a subtle problem that can only be detected using
<code>is.exdf</code> with <code>consistency_check</code> set to
<code>TRUE</code>:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">exdf_2</span><span class="op">)</span></span>
<span><span class="co">#&gt;   A [Cat1] (m) B [Cat2] (s) C [NA] (NA) D [cat4] (kg) NA</span></span>
<span><span class="co">#&gt; 1            4            4           7            20 17</span></span>
<span><span class="co">#&gt; 2            3            5           7            20 17</span></span>
<span><span class="co">#&gt; 3            8            1           7            20 17</span></span>
<span><span class="co">#&gt; 4           10            8           7            20 17</span></span>
<span></span>
<span><span class="fu"><a href="../reference/is.exdf.html">is.exdf</a></span><span class="op">(</span><span class="va">exdf_2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="fu"><a href="../reference/is.exdf.html">is.exdf</a></span><span class="op">(</span><span class="va">exdf_2</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in is.exdf(exdf_2, TRUE): `x$main_data`, `x$units`, and `x$categories`</span></span>
<span><span class="co">#&gt; must have the same column names</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="common-patterns">Common Patterns<a class="anchor" aria-label="anchor" href="#common-patterns"></a>
</h2>
<p>Here will we explain a few common ways that <code>exdf</code> objects
are created, modified, or otherwise used.</p>
<div class="section level3">
<h3 id="combining-data-from-several-files">Combining Data From Several Files<a class="anchor" aria-label="anchor" href="#combining-data-from-several-files"></a>
</h3>
<p>It is quite common for one data set to be spread across multiple data
files; for example, if multiple Licors are used to measure response
curves from a set of plants, there will be one data file for each
machine. On the other hand, the data is much easier to process and
analyze if it is stored in a single <code>exdf</code> object. Thus, it
is common to take the following steps in a script:</p>
<ol style="list-style-type: decimal">
<li>Define a vector of file names that identify the files to be
loaded.</li>
<li>Use <code>lapply</code> and <code>read_gasex_file</code> to load
each file, producing a <code>list</code> of <code>exdf</code>
objects.</li>
<li>Identify common columns using <code>identify_common_columns</code>;
in other words, determine which columns are present in each of the
<code>exdf</code> objects.</li>
<li>Limit each <code>exdf</code> object to just the common columns using
the <code>[</code> operator with <code>return_exdf</code> set to
<code>TRUE</code>.</li>
<li>Use <code>rbind</code> to combine the <code>exdf</code> objects into
a single <code>exdf</code> containing the data from all of the
files.</li>
</ol>
<p>In this process, steps 3 and 4 are required because <code>exdf</code>
objects cannot be combined with <code>rbind</code> if they have
different columns. This way of combining can be visualized as stacking
tables on top of each other vertically, and it only makes sense if they
all have the same columns. It is common for Licor files to have some
differences between their columns, so these steps are usually necessary.
Even if all the files <em>do</em> have the same columns, taking these
steps will not cause any issues, so there’s no harm in always doing
this. The following image illustrates this process visually for a set of
three files.</p>
<div class="figure" style="text-align: center">
<img src="images%2Ffile_loading_illustration.png" alt="Illustration of combining multiple tables using `identify_common_columns` and
  `rbind`. In this example, the `YY` and `ZZ` columns are not present in all of
  the tables, so they are removed before the tables are vertically stacked." width="95%"><p class="caption">
Illustration of combining multiple tables using
<code>identify_common_columns</code> and <code>rbind</code>. In this
example, the <code>YY</code> and <code>ZZ</code> columns are not present
in all of the tables, so they are removed before the tables are
vertically stacked.
</p>
</div>
<p>The following is an example of code that accomplishes these
steps:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define a vector of paths to the files we wish to load</span></span>
<span><span class="va">file_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/PhotoGEA_example_file_path.html">PhotoGEA_example_file_path</a></span><span class="op">(</span><span class="st">'ball_berry_1.xlsx'</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/PhotoGEA_example_file_path.html">PhotoGEA_example_file_path</a></span><span class="op">(</span><span class="st">'ball_berry_2.xlsx'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load each file, storing the result in a list</span></span>
<span><span class="va">licor_exdf_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">file_paths</span>, <span class="kw">function</span><span class="op">(</span><span class="va">fpath</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="../reference/read_gasex_file.html">read_gasex_file</a></span><span class="op">(</span><span class="va">fpath</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the names of all columns that are present in all of the Licor files</span></span>
<span><span class="va">columns_to_keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">identify_common_columns</span>, <span class="va">licor_exdf_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract just these columns</span></span>
<span><span class="va">licor_exdf_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">licor_exdf_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span> , <span class="va">columns_to_keep</span>, <span class="cn">TRUE</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use `rbind` to combine all the data</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">licor_exdf_list</span><span class="op">)</span></span></code></pre></div>
<p>This pattern (where files are loaded, truncated to common columns,
and then combined) is found in most analysis scripts, such as the one in
the <a href="analyzing_ball_berry_data.html">Analyzing Ball-Berry
Data</a> vignette.</p>
<p>Now that the data from the files has been combined into one
<code>exdf</code> object, it’s easy to perform calculations on all of it
at once. For example, we can calculate total pressure, additional gas
properties, and the Ball-Berry index:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate the total pressure in the Licor chamber</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_total_pressure.html">calculate_total_pressure</a></span><span class="op">(</span><span class="va">licor_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate additional gas properties, including `RHleaf` and `Csurface`</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_gas_properties.html">calculate_gas_properties</a></span><span class="op">(</span><span class="va">licor_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the Ball-Berry index</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_ball_berry_index.html">calculate_ball_berry_index</a></span><span class="op">(</span><span class="va">licor_data</span><span class="op">)</span></span></code></pre></div>
<p>In this example, the vector of files to load was defined manually by
typing out the file names; files can also be selected interactively
using the <code>choose_input_files</code>,
<code>choose_input_licor_files</code>, and
<code>choose_input_tdl_files</code> functions.</p>
</div>
<div class="section level3">
<h3 id="processing-multiple-pieces-of-an-extended-data-frame">Processing Multiple Pieces of an Extended Data Frame<a class="anchor" aria-label="anchor" href="#processing-multiple-pieces-of-an-extended-data-frame"></a>
</h3>
<p>It is common for an <code>exdf</code> object to contain data that
represents multiple “chunks,” such as response curves, that can each be
located using the value of one or more “identifier” columns like
<code>event</code>, <code>replicate</code>, <code>species</code>, etc.
In this scenario, it is often desirable to apply a function, such as a
fitting function, to each chunk in the data set. As a concrete example,
the <code>licor_data</code> <code>exdf</code> created in <a href="#combining-data-from-several-files">Combining Data From Several
Files</a> contains several Ball-Berry curves, and the
<code>fit_ball_berry</code> function applies a fitting procedure to one
curve to determine values for the Ball-Berry parameters. How can we
apply <code>fit_ball_berry</code> to each curve in the data in a simple
way?</p>
<p>Often the easiest route is to use the <code>by</code> function. This
function requires four inputs:</p>
<ul>
<li>An <code>exdf</code> object containing multiple “chunks” of
data.</li>
<li>One or more vectors whose values can be used to split the
<code>exdf</code> into chunks.</li>
<li>A function that should be appled to each chunk.</li>
<li>Any additional arguments that should be passed to the function.</li>
</ul>
<p>With this information, <code>by</code> will split the
<code>exdf</code> object into chunks and apply the function to each one.
Its return value will be a list, where each list element is the output
from one function call, as applied to one chunk. For more information,
access the built-in help system entry by typing <code><a href="../reference/by.exdf.html">?by.exdf</a></code>.
Here we show how <code>by</code> can be used to apply the Ball-Berry
fitting procedure to each curve in <code>licor_data</code>:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">by_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span></span>
<span>  <span class="va">licor_data</span>,                                          <span class="co"># exdf object</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">licor_data</span><span class="op">[</span>, <span class="st">'species'</span><span class="op">]</span>, <span class="va">licor_data</span><span class="op">[</span>, <span class="st">'plot'</span><span class="op">]</span><span class="op">)</span>, <span class="co"># identifier columns</span></span>
<span>  <span class="va">fit_ball_berry</span>                                       <span class="co"># function to apply to chunks</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code>fit_ball_berry</code> function returns a list of two
<code>exdf</code> objects named <code>fits</code> and
<code>parameters</code>, so the return value from <code>by</code> is a
complicated object: it is a list of lists of exdf objects; in other
words, a nested list. We can see this structure as follows:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">by_result</span>, max.level <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 8</span></span>
<span><span class="co">#&gt;  $ soybean.1 :List of 2</span></span>
<span><span class="co">#&gt;   ..$ parameters:'data.frame':   1 obs. of  80 variables:</span></span>
<span><span class="co">#&gt;   ..$ fits      :'data.frame':   7 obs. of  254 variables:</span></span>
<span><span class="co">#&gt;  $ soybean.1a:List of 2</span></span>
<span><span class="co">#&gt;   ..$ parameters:'data.frame':   1 obs. of  79 variables:</span></span>
<span><span class="co">#&gt;   ..$ fits      :'data.frame':   7 obs. of  254 variables:</span></span>
<span><span class="co">#&gt;  $ soybean.1b:List of 2</span></span>
<span><span class="co">#&gt;   ..$ parameters:'data.frame':   1 obs. of  77 variables:</span></span>
<span><span class="co">#&gt;   ..$ fits      :'data.frame':   7 obs. of  254 variables:</span></span>
<span><span class="co">#&gt;  $ tobacco.2 :List of 2</span></span>
<span><span class="co">#&gt;   ..$ parameters:'data.frame':   1 obs. of  77 variables:</span></span>
<span><span class="co">#&gt;   ..$ fits      :'data.frame':   7 obs. of  254 variables:</span></span>
<span><span class="co">#&gt;  $ soybean.5 :List of 2</span></span>
<span><span class="co">#&gt;   ..$ parameters:'data.frame':   1 obs. of  77 variables:</span></span>
<span><span class="co">#&gt;   ..$ fits      :'data.frame':   7 obs. of  254 variables:</span></span>
<span><span class="co">#&gt;  $ tobacco.5 :List of 2</span></span>
<span><span class="co">#&gt;   ..$ parameters:'data.frame':   1 obs. of  79 variables:</span></span>
<span><span class="co">#&gt;   ..$ fits      :'data.frame':   7 obs. of  254 variables:</span></span>
<span><span class="co">#&gt;  $ soybean.5a:List of 2</span></span>
<span><span class="co">#&gt;   ..$ parameters:'data.frame':   1 obs. of  81 variables:</span></span>
<span><span class="co">#&gt;   ..$ fits      :'data.frame':   7 obs. of  254 variables:</span></span>
<span><span class="co">#&gt;  $ soybean.5c:List of 2</span></span>
<span><span class="co">#&gt;   ..$ parameters:'data.frame':   1 obs. of  81 variables:</span></span>
<span><span class="co">#&gt;   ..$ fits      :'data.frame':   7 obs. of  254 variables:</span></span></code></pre></div>
<p>It would be much easier to work with this information if it were
reorganized by separately combining all of the <code>fits</code> and
<code>parameters</code> elements. Fortunately, this can be easily done
with the <code>consolidate</code> function. This function will collect
all of the second-level elements with the same names and combine them
using <code>rbind</code>:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">consolidate_by_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/consolidate.html">consolidate</a></span><span class="op">(</span><span class="va">by_result</span><span class="op">)</span></span></code></pre></div>
<p>We can now see that instead of a nested list, we have a list of two
<code>exdf</code> objects:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">consolidate_by_result</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ parameters:'data.frame':  8 obs. of  76 variables:</span></span>
<span><span class="co">#&gt;  $ fits      :'data.frame':  56 obs. of  254 variables:</span></span></code></pre></div>
<p>It is common to apply the <code>consolidate</code> and
<code>by</code> functions in the same line to make the code more
concise. Afterwards, the elements from the resulting list can be
separated to make additional analysis easier:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ball_berry_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/consolidate.html">consolidate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span></span>
<span>  <span class="va">licor_data</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">licor_data</span><span class="op">[</span>, <span class="st">'species'</span><span class="op">]</span>, <span class="va">licor_data</span><span class="op">[</span>, <span class="st">'plot'</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="va">fit_ball_berry</span>,</span>
<span>  <span class="st">'gsw'</span>, <span class="st">'bb_index'</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ball_berry_fits</span> <span class="op">&lt;-</span> <span class="va">ball_berry_result</span><span class="op">$</span><span class="va">fits</span></span>
<span><span class="va">ball_berry_parameters</span> <span class="op">&lt;-</span> <span class="va">ball_berry_result</span><span class="op">$</span><span class="va">parameters</span></span></code></pre></div>
<p>This pattern (where a function is applied to multiple curves using
<code>consolidate</code> and <code>by</code>) is found in most analysis
scripts, such as the one in the <a href="analyzing_ball_berry_data.html">Analyzing Ball-Berry Data</a>
vignette. The following image illustrates this process visually.</p>
<div class="figure" style="text-align: center">
<img src="images%2Ftable_processing_illustration.png" alt="Illustration of processing multiple parts of a table using `by` and
  `consolidate`. Here the `id` column is either `1` or `2`, and the processing
  function returns a list of two tables called `fits` and `parameters`." width="95%"><p class="caption">
Illustration of processing multiple parts of a table using
<code>by</code> and <code>consolidate</code>. Here the <code>id</code>
column is either <code>1</code> or <code>2</code>, and the processing
function returns a list of two tables called <code>fits</code> and
<code>parameters</code>.
</p>
</div>
</div>
<div class="section level3">
<h3 id="plotting-data-from-an-extended-data-frame">Plotting Data From an Extended Data Frame<a class="anchor" aria-label="anchor" href="#plotting-data-from-an-extended-data-frame"></a>
</h3>
<p>If an <code>exdf</code> object contains multiple curves, it is often
convenient to plot them using the <code>xyplot</code> function from the
<code>lattice</code> package. This plotting tool makes it easy to put
each curve in its own panel, or to group the curves by an identifier
such as <code>event</code> or <code>species</code>. In this case, it is
common to pass the <code>main_data</code> element of an
<code>exdf</code> object as the <code>data</code> argument of
<code><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">lattice::xyplot</a></code> since it only works with data frames:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">gsw</span> <span class="op">~</span> <span class="va">bb_index</span> <span class="op">|</span> <span class="va">species</span>,</span>
<span>  group <span class="op">=</span> <span class="va">plot</span>,</span>
<span>  data <span class="op">=</span> <span class="va">licor_data</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'right'</span><span class="op">)</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="working_with_extended_data_frames_files/figure-html/unnamed-chunk-37-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Because <code>exdf</code> objects include the units for each column,
it is also possible to add them to the axis labels. This can be
accomplished using the <code>paste0</code> function, which can create
character strings from the values of variables. For example, we could
create a string describing the <code>gsw</code> column as follows:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Stomatal conductance to H2O ('</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">gsw</span>, <span class="st">')'</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Stomatal conductance to H2O (mol m^(-2) s^(-1))"</span></span></code></pre></div>
<p>These labels can then be included in the plot itself:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">gsw</span> <span class="op">~</span> <span class="va">bb_index</span> <span class="op">|</span> <span class="va">species</span>,</span>
<span>  group <span class="op">=</span> <span class="va">plot</span>,</span>
<span>  data <span class="op">=</span> <span class="va">licor_data</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'right'</span><span class="op">)</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Ball-Berry index ('</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">bb_index</span>, <span class="st">')'</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Stomatal conductance to H2O ('</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">gsw</span>, <span class="st">')'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="working_with_extended_data_frames_files/figure-html/unnamed-chunk-39-1.png" width="672" style="display: block; margin: auto;"></p>
<p>This pattern (where the <code>main_data</code> element of an
<code>exdf</code> object is passed to <code><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">lattice::xyplot</a></code> and
its <code>units</code> element is used to create informative axis
labels) is found in most analysis scripts, such as the one in the <a href="analyzing_ball_berry_data.html">Analyzing Ball-Berry Data</a>
vignette.</p>
</div>
</div>
<div class="section level2">
<h2 id="how-to-find-more-information">How To Find More Information<a class="anchor" aria-label="anchor" href="#how-to-find-more-information"></a>
</h2>
<p>All S3 methods defined for the <code>exdf</code> class can be viewed
using the <code>methods</code> function:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/methods.html" class="external-link">methods</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">'exdf'</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] [                        [&lt;-                      as.data.frame           </span></span>
<span><span class="co">#&gt;  [4] by                       cbind                    check_required_variables</span></span>
<span><span class="co">#&gt;  [7] consolidate              dim                      dimnames                </span></span>
<span><span class="co">#&gt; [10] dimnames&lt;-               exclude_outliers         factorize_id_column     </span></span>
<span><span class="co">#&gt; [13] identifier_columns       identify_common_columns  length                  </span></span>
<span><span class="co">#&gt; [16] print                    rbind                    split                   </span></span>
<span><span class="co">#&gt; [19] str                     </span></span>
<span><span class="co">#&gt; see '?methods' for accessing help and source code</span></span></code></pre></div>
<p>However, this does not include all functions related to the
<code>exdf</code> class. Others can be identified by typing
<code>??exdf</code> within the R environment.</p>
<p>Finally, the other vignettes in the <code>PhotoGEA</code> package
include many examples of how <code>exdf</code> objects can be created
and used while analyzing photosynthetic gas exchange data.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Edward B. Lochocki.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
