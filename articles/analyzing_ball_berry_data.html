<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="PhotoGEA">
<title>Analyzing Ball-Berry Data • PhotoGEA</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analyzing Ball-Berry Data">
<meta property="og:description" content="PhotoGEA">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    padding-top: 70px;

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">PhotoGEA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/analyzing_ball_berry_data.html">Analyzing Ball-Berry Data</a>
    <a class="dropdown-item" href="../articles/analyzing_tdl_data.html">Analyzing TDL Data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/eloch216/PhotoGEA/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Analyzing Ball-Berry Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/eloch216/PhotoGEA/blob/HEAD/vignettes/analyzing_ball_berry_data.Rmd" class="external-link"><code>vignettes/analyzing_ball_berry_data.Rmd</code></a></small>
      <div class="d-none name"><code>analyzing_ball_berry_data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>In this vignette, we will give an example showing how to analyze Ball-Berry data using the <code>PhotoGEA</code> package. The commands in this vignette can be used to initialize your own script, as described in <a href="#customizing-your-script">Customizing Your Script</a>.</p>
</div>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<div class="section level3">
<h3 id="the-model">The Model<a class="anchor" aria-label="anchor" href="#the-model"></a>
</h3>
<p>The Ball-Berry model is a simple way to describe the response of a leaf’s stomata to its assimilation rate and local environmental conditions. Specifically, it predicts stomatal conductance to water vapor using the following equation:</p>
<p><span class="math display">\[ g_{sw} = b_0 + b_1 * A_n * h_s / C_s \]</span></p>
<p>where <span class="math inline">\(g_{sw}\)</span> is the stomatal conductance, <span class="math inline">\(A_n\)</span> is the net assimilation rate, <span class="math inline">\(h_s\)</span> is the relative humidity at the leaf surface, and <span class="math inline">\(C_s\)</span> is the CO<sub>2</sub> concentration at the leaf surface. The term <span class="math inline">\(A_n * h_s / C_s\)</span> is commonly referred to as the Ball-Berry index, and the model can be described as predicting a linear relationship between stomatal conductance and the Ball-Berry index. The intercept (<span class="math inline">\(b_0\)</span>) and slope (<span class="math inline">\(b_1\)</span>) of the linear relationship are referred to as the Ball-Berry parameters, and they describe the leaf’s stomatal response.</p>
<p>Although this model is certainly an oversimplification, it does encode some important stomatal responses. For example, when humidity is low, the stomata of a real plant tend to close, reducing stomatal conductance. Likewise, if the CO<sub>2</sub> concentration around the leaf is depleted, the stomata of a real plant tend to open, increasing somatal conductance. For more information about this model and some possible alternatives, see the following papers:</p>
<ul>
<li><span class="citation">Ball, Woodrow, and Berry (<a href="#ref-ball_model_1987" role="doc-biblioref">1987</a>)</span></li>
<li><span class="citation">Tardieu and Davies (<a href="#ref-tardieu_integration_1993" role="doc-biblioref">1993</a>)</span></li>
<li><span class="citation">Leuning (<a href="#ref-leuning_critical_1995" role="doc-biblioref">1995</a>)</span></li>
<li><span class="citation">Dewar (<a href="#ref-dewar_ballberryleuning_2002" role="doc-biblioref">2002</a>)</span></li>
</ul>
</div>
<div class="section level3">
<h3 id="the-data">The Data<a class="anchor" aria-label="anchor" href="#the-data"></a>
</h3>
<p>Ball-Berry parameters are typically determined by measuring a Ball-Berry curve, where one or more of the environmental factors that influence the Ball-Berry index is systematically varied across a range of values. For each value, care is taken that <span class="math inline">\(A_n\)</span> and <span class="math inline">\(g_{sw}\)</span> have reached their steady-state values, and then <span class="math inline">\(A_n\)</span>, <span class="math inline">\(g_{sw}\)</span>, and other key pieces of information are recorded. Finally, a linear fit of the experimentally observed <span class="math inline">\(g_{sw}\)</span> as a function of the Ball-Berry index is performed to extract values for the Ball-Berry intercept and slope.</p>
<p>Such photosynthetic gas exchange measurements are commonly performed using a Licor portable photosynthesis system such as the Li-6400 or Li-6800. These machines record values of <span class="math inline">\(A_n\)</span>, <span class="math inline">\(g_{sw}\)</span>, and many other important quantities. They produce two types of output files: plain-text and Microsoft Excel. It is often more convenient to work with the Excel files since the entries can be easily modified (for example, to remove an extraneous row or add a new column). On the other hand, it can be more difficult to access the file contents using other pieces of software such as R. However, the <code>PhotoGEA</code> package reduces this barrier by including tools for reading Licor Excel files in R, which will be demonstrated in the following section.</p>
</div>
</div>
<div class="section level2">
<h2 id="loading-packages">Loading Packages<a class="anchor" aria-label="anchor" href="#loading-packages"></a>
</h2>
<p>As always, the first step is to load the packages we will be using. In addition to <code>PhotoGEA</code>, we will also use the <code>lattice</code> package for generating plots.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/eloch216/PhotoGEA" class="external-link">PhotoGEA</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://lattice.r-forge.r-project.org/" class="external-link">lattice</a></span><span class="op">)</span></span></code></pre></div>
<p>If the <code>lattice</code> package is not installed on your R setup, you can install it by typing <code>install.packages('lattice')</code>.</p>
</div>
<div class="section level2">
<h2 id="loading-licor-data">Loading Licor Data<a class="anchor" aria-label="anchor" href="#loading-licor-data"></a>
</h2>
<p>The <code>PhotoGEA</code> package includes two files representing Ball-Berry data measured using two Li-6800 instruments. The data is stored in Microsoft Excel files, and includes curves measured from two different crop species (tobacco and soybean) and several different plots of each. Each curve is a seven-point light response curve; in other words, the incident light intensity was varied to change <span class="math inline">\(A_n\)</span> and hence the Ball-Berry index. Although these two files are based on real data, noise was added to it since it is unpublished, so these files should only be used as examples.</p>
<p>The files will be stored on your computer somewhere in your R package installation directory, and full paths to these files can be obtained with <code>system.file</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define a vector of paths to the files we wish to load</span></span>
<span><span class="va">file_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata'</span>, <span class="st">'ball_berry_1.xlsx'</span>, package <span class="op">=</span> <span class="st">'PhotoGEA'</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata'</span>, <span class="st">'ball_berry_2.xlsx'</span>, package <span class="op">=</span> <span class="st">'PhotoGEA'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>To actually read the data in the files and store them in R objects, we will use the <code>read_licor_file</code> function from <code>PhotoGEA</code>. Since there are multiple files to read, we will call this function once for each file using <code>lapply</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load each file, storing the result in a list</span></span>
<span><span class="va">licor_exdf_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">file_paths</span>, <span class="kw">function</span><span class="op">(</span><span class="va">fpath</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/read_licor_file.html">read_licor_file</a></span><span class="op">(</span><span class="va">fpath</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">7</span>, <span class="fl">9</span>, <span class="fl">11</span>, <span class="fl">13</span><span class="op">)</span>, <span class="fl">14</span>, <span class="fl">15</span>, <span class="fl">16</span>, <span class="fl">17</span>, <span class="st">'time'</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>The result from this command is an R list of “extended data frames” (abbreviated as <code>exdf</code> objects). The <code>exdf</code> class is a special data structure defined by the <code>PhotoGEA</code> package. In many ways, an <code>exdf</code> object is equivalent to a data frame, with the major difference being that an <code>exdf</code> object includes the units of each column. For more information, type <code><a href="../reference/exdf.html">?exdf</a></code> in the R terminal to access the built-in help menu entry.</p>
<p>Generally, it is more convenient to work with a single <code>exdf</code> object rather than a list of them, so our next step will be to combine the objects in the list. This action can be accomplished using the <code>rbind</code> function, which combines table-like objects by their rows; in other words, it stacks two or more tables vertically. This action only makes sense if the tables have the same columns, so before we combine the <code>exdf</code> objects, we should make sure this is the case.</p>
<p>The <code>PhotoGEA</code> package includes a function called <code>identify_common_columns</code> that can be used to get the names of all columns that are present in all of the Licor files. Then, we can extract just those columns, and then combine the <code>exdf</code> objects into a single one.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the names of all columns that are present in all of the Licor files</span></span>
<span><span class="va">columns_to_keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">identify_common_columns</span>, <span class="va">licor_exdf_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract just these columns</span></span>
<span><span class="va">licor_exdf_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">licor_exdf_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span> , <span class="va">columns_to_keep</span>, <span class="cn">TRUE</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use `rbind` to combine all the data</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">licor_exdf_list</span><span class="op">)</span></span></code></pre></div>
<p>Now we have a single R object called <code>licor_data</code> that includes all the data from several Licor Excel files.</p>
</div>
<div class="section level2">
<h2 id="checking-licor-data">Checking Licor Data<a class="anchor" aria-label="anchor" href="#checking-licor-data"></a>
</h2>
<p>Before extracting Ball-Berry parameters, it is a good idea to do some basic checks of the data to ensure it is organized properly and that it was measured properly.</p>
<div class="section level3">
<h3 id="basic-checks">Basic Checks<a class="anchor" aria-label="anchor" href="#basic-checks"></a>
</h3>
<p>First, we should make sure there is a column in the data whose value uniquely identifies each curve. In this particular data set, several “user constants” were defined while making the measurements that help to identify each curve: <code>instrument</code>, <code>species</code>, and <code>plot</code>. However, neither of these columns alone are sufficient to uniquely identify each curve. We can solve this issue by creating a new column that combines the values from each of these:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a new identifier column formatted like `instrument - species - plot`</span></span>
<span><span class="va">licor_data</span><span class="op">[</span> , <span class="st">'curve_identifier'</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">licor_data</span><span class="op">[</span> , <span class="st">'instrument'</span><span class="op">]</span>, <span class="st">'-'</span>, <span class="va">licor_data</span><span class="op">[</span> , <span class="st">'species'</span><span class="op">]</span>, <span class="st">'-'</span>, <span class="va">licor_data</span><span class="op">[</span> , <span class="st">'plot'</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>The next step is to make sure that this column correctly identifies each response curve. To do this, we can use the <code>check_licor_data</code> function from <code>PhotoGEA</code>. Here we will supply the name of a column that should uniquely identify each response curve (<code>curve_identifier</code>), the expected number of points in each curve (<code>7</code>), the name of a “driving” column that should follow the same sequence in each curve (<code>Qin</code>), and tolerance for the values of the driving column (<code>1.0 mol / m^2 / s</code>). If the data passes the checks, this function will have no output and will not produce any messages. (For more information, see the built-in help menu entry by typing <code><a href="../reference/check_licor_data.html">?check_licor_data</a></code>.)</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make sure the data meets basic requirements</span></span>
<span><span class="fu"><a href="../reference/check_licor_data.html">check_licor_data</a></span><span class="op">(</span><span class="va">licor_data</span>, <span class="st">'curve_identifier'</span>, <span class="fl">7</span>, <span class="st">'Qin'</span>, <span class="fl">1.0</span><span class="op">)</span></span></code></pre></div>
<p>However, if <code>check_licor_data</code> detects an issue, it will print a helpful message to the R terminal. For example, if we had specified the wrong number of points, the wrong identifier column, or an unrealistic tolerance, we would get error messages:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_licor_data.html">check_licor_data</a></span><span class="op">(</span><span class="va">licor_data</span>, <span class="st">'curve_identifier'</span>, <span class="fl">8</span><span class="op">)</span></span>
<span><span class="co">#&gt;       curve_identifier npts</span></span>
<span><span class="co">#&gt; 1 ripe4 - soybean - 1a    7</span></span>
<span><span class="co">#&gt; 2 ripe4 - soybean - 1b    7</span></span>
<span><span class="co">#&gt; 3  ripe4 - soybean - 5    7</span></span>
<span><span class="co">#&gt; 4  ripe4 - tobacco - 2    7</span></span>
<span><span class="co">#&gt; 5  ripe5 - soybean - 1    7</span></span>
<span><span class="co">#&gt; 6 ripe5 - soybean - 5a    7</span></span>
<span><span class="co">#&gt; 7 ripe5 - soybean - 5c    7</span></span>
<span><span class="co">#&gt; 8  ripe5 - tobacco - 5    7</span></span>
<span><span class="co">#&gt; Error in check_licor_data(licor_data, "curve_identifier", 8): One or more curves does not have the expected number of points.</span></span>
<span></span>
<span><span class="fu"><a href="../reference/check_licor_data.html">check_licor_data</a></span><span class="op">(</span><span class="va">licor_data</span>, <span class="st">'species'</span>, <span class="fl">7</span><span class="op">)</span></span>
<span><span class="co">#&gt;   species npts</span></span>
<span><span class="co">#&gt; 1 soybean   42</span></span>
<span><span class="co">#&gt; 2 tobacco   14</span></span>
<span><span class="co">#&gt; Error in check_licor_data(licor_data, "species", 7): One or more curves does not have the expected number of points.</span></span>
<span></span>
<span><span class="fu"><a href="../reference/check_licor_data.html">check_licor_data</a></span><span class="op">(</span><span class="va">licor_data</span>, <span class="st">'curve_identifier'</span>, <span class="fl">7</span>, <span class="st">'Qin'</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="co">#&gt; ripe4 - soybean - 1a ripe4 - soybean - 1b  ripe4 - soybean - 5 </span></span>
<span><span class="co">#&gt;              2000.03              1999.85              1999.98 </span></span>
<span><span class="co">#&gt;  ripe4 - tobacco - 2  ripe5 - soybean - 1 ripe5 - soybean - 5a </span></span>
<span><span class="co">#&gt;              2000.02              2000.05              2000.14 </span></span>
<span><span class="co">#&gt; ripe5 - soybean - 5c  ripe5 - tobacco - 5 </span></span>
<span><span class="co">#&gt;              2000.12              1999.81</span></span>
<span><span class="co">#&gt; Error in check_licor_data(licor_data, "curve_identifier", 7, "Qin", 0.1): Values of the `Qin` column are not identical (within the tolerance of 0.1) for point 1 within the curve sequence.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="qualitative-checks">Qualitative Checks<a class="anchor" aria-label="anchor" href="#qualitative-checks"></a>
</h3>
<p>Since the data has passed the basic checks, we can now take a look at it to make sure it seems reasonable. Sometimes a Licor will override the temperature or humidity controls while making measurements; in this case, conditions inside the measurement chamber may not be stable, and these curves may not accurately reflect the plant’s true steady-state stomatal response. We can check for these types of issues by making plots. In this situation, the <code>lattice</code> library makes it simple to include each curve as its own separate subplot of a figure. In the following sections, we will generate several different plots to check each curve for quality.</p>
<div class="section level4">
<h4 id="humidity-control">Humidity Control<a class="anchor" aria-label="anchor" href="#humidity-control"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a plot to check humidity control</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">RHcham</span> <span class="op">+</span> <span class="va">`Humidifier_%`</span> <span class="op">+</span> <span class="va">`Desiccant_%`</span> <span class="op">~</span> <span class="va">Qin</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">licor_data</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2200</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Incident PPFD ('</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Qin</span>, <span class="st">')'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_ball_berry_data_files/figure-html/plot_humidity-1.png" width="720" style="display: block; margin: auto;"></p>
<p>Here, <code>Humidifier_%</code> and <code>Desiccant_%</code> represent the flow from the humidifier and desiccant columns, where a value of 0 indicates that the valve to the column is fully closed and a value of 100 indicates that the valve to the column is fully opened. <code>RHcham</code> represents the relative humidity inside the chamber as a percentage (in other words, as a value between 0 and 100). <code>Qin</code> is the incident photosynthetically active flux density (PPFD). When these curves were measured, a chamber humidity setpoint was specified. So, when looking at this plot, we should check that the relative humidity is fairly constant during each curve. Typically, this should be accompanied by relatively smooth changes in the valve percentages as they accomodate changes in ambient humidity and leaf photosynthesis. In this plot, all the data looks good.</p>
</div>
<div class="section level4">
<h4 id="temperature-control">Temperature Control<a class="anchor" aria-label="anchor" href="#temperature-control"></a>
</h4>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a plot to check temperature control</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">TleafCnd</span> <span class="op">+</span> <span class="va">Txchg</span> <span class="op">~</span> <span class="va">Qin</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">licor_data</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2200</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Incident PPFD ('</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Qin</span>, <span class="st">')'</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Temperature ('</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">TleafCnd</span>, <span class="st">')'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_ball_berry_data_files/figure-html/plot_temperature-1.png" width="720" style="display: block; margin: auto;"></p>
<p>Here, <code>TleafCnd</code> is the leaf temperature measured using a thermocouple, and <code>Txchg</code> is the temperature of the heat exhanger that is used to control the air temperature in the measurement instrument. When these curves were measured, an exchanger setpoint was specified. So, when looking at this plot, we should check that <code>Txchg</code> is constant during each curve and that the leaf temperature does not vary in an erratic way. In this plot, all the data looks good.</p>
</div>
<div class="section level4">
<h4 id="co2-control">CO<sub>2</sub> Control<a class="anchor" aria-label="anchor" href="#co2-control"></a>
</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a plot to check CO2 control</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">CO2_s</span> <span class="op">+</span> <span class="va">CO2_r</span> <span class="op">~</span> <span class="va">Qin</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">licor_data</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">360</span>, <span class="fl">480</span><span class="op">)</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2200</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Incident PPFD ('</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Qin</span>, <span class="st">')'</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'CO2 concentration ('</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">CO2_r</span>, <span class="st">')'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_ball_berry_data_files/figure-html/plot_co2-1.png" width="720" style="display: block; margin: auto;"></p>
<p>Here, <code>CO2_s</code> is the CO<sub>2</sub> concentration in the sample cell and <code>CO2_r</code> is the CO<sub>2</sub> concentration in the reference cell. When these curves were measured, a sample cell CO<sub>2</sub> concentration setpoint was supplied. So, when looking at this plot, we should check that <code>CO2_s</code> is constant during each curve. Here, it looks like the <code>ripe5</code> instrument was not controlling CO<sub>2</sub> as expected during several of its curves; <code>CO2_s</code> is not constant for <code>ripe5 - soybean - 1</code>, <code>ripe5 - soybean - 5c</code>, and <code>ripe5 - soybean - 5</code>. However, <code>CO2_r</code> is relatively constant during these curves, and the changes in <code>CO2_s</code> are smooth, so it is reasonable to expect that the measurements represent true steady-state values. Considering this, all of these curves are acceptable based on the CO<sub>2</sub> plots.</p>
</div>
<div class="section level4">
<h4 id="light-response-curves">Light-Response Curves<a class="anchor" aria-label="anchor" href="#light-response-curves"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a plot to check light-response curves</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">A</span> <span class="op">~</span> <span class="va">Qin</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">licor_data</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">50</span><span class="op">)</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2200</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Incident PPFD ('</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Qin</span>, <span class="st">')'</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Net assimilation ('</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">A</span>, <span class="st">')'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_ball_berry_data_files/figure-html/plot_assimilation-1.png" width="720" style="display: block; margin: auto;"></p>
<p>Here we are simply looking for a reasonable light-response curve shape, where assimilation is low when light is low, assimilation has a roughly linear response to initial increases in light intensity, and then finally reaches a plateau. Any strong deviations from the expected shape may indicate that the plant was stressed or otherwise behaving abnormally, and we might not want to use such a curve for Ball-Berry analysis. In this plot, three of the curves do not look like normal C<sub>3</sub> light response curves: <code>ripe4 - soybean - 1a</code>, <code>ripe4 - soybean - 1b</code>, and <code>ripe4 - soybean - 5</code>. These strange curves are likely a byproduct of the noise that was intentionally added to the true measured data (see <a href="#the-data">The Data</a>). Nevertheless, it may be a good idea to remove them before proceeding with the Ball-Berry fitting.</p>
</div>
</div>
<div class="section level3">
<h3 id="removing-bad-curves">Removing Bad Curves<a class="anchor" aria-label="anchor" href="#removing-bad-curves"></a>
</h3>
<p>Since we have identified a few curves that may not be acceptable for Ball-Berry fitting, we can remove them as follows:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define a list of curves to remove from the data set</span></span>
<span><span class="va">curves_to_remove</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">'ripe4 - soybean - 1a'</span>,</span>
<span>  <span class="st">'ripe4 - soybean - 1b'</span>,</span>
<span>  <span class="st">'ripe4 - soybean - 5'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove them</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">licor_data</span><span class="op">[</span><span class="op">!</span><span class="va">licor_data</span><span class="op">[</span>, <span class="st">'curve_identifier'</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">curves_to_remove</span>, , <span class="cn">TRUE</span><span class="op">]</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="fitting-licor-data">Fitting Licor Data<a class="anchor" aria-label="anchor" href="#fitting-licor-data"></a>
</h2>
<p>Now that we have checked the data quality, we are ready to perform the fitting. As they are produced by the instruments, Licor data files do not include values of the Ball-Berry index; in fact, they do not even include values of <span class="math inline">\(h_s\)</span> and <span class="math inline">\(C_s\)</span> required to calculate the Ball-Berry index. However, the <code>PhotoGEA</code> package includes two functions to help with these calculations: <code>calculate_gas_properties</code> and <code>calculate_ball_berry_index</code>. Each of these requires an <code>exdf</code> object containing Licor data, as well as the names of several important columns in the data. The units for each column will be checked in an attempt to avoid unit-related errors. More information about these functions can be obtained from the built-in help system by typing <code><a href="../reference/calculate_gas_properties.html">?calculate_gas_properties</a></code> or <code><a href="../reference/calculate_ball_berry_index.html">?calculate_ball_berry_index</a></code>. Here we will use them sequentially to calculate values of the Ball-Berry index:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate additional gas properties, including `RHleaf` and `Csurface`</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_gas_properties.html">calculate_gas_properties</a></span><span class="op">(</span></span>
<span>  <span class="va">licor_data</span>,</span>
<span>  <span class="st">'A'</span>, <span class="st">'Ca'</span>, <span class="st">'DeltaPcham'</span>, <span class="st">'E'</span>, <span class="st">'gbw'</span>, <span class="st">'gsw'</span>, <span class="st">'H2O_s'</span>, <span class="st">'Pa'</span>, <span class="st">'TleafCnd'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the Ball-Berry index</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_ball_berry_index.html">calculate_ball_berry_index</a></span><span class="op">(</span><span class="va">licor_data</span>, <span class="st">'A'</span>, <span class="st">'RHleaf'</span>, <span class="st">'Csurface'</span><span class="op">)</span></span></code></pre></div>
<p>Together, these functions add several new columns to <code>licor_data</code>, including one called <code>bb_index</code>, which includes values of the Ball-Berry index. With this information, we are now ready to perform the fitting procedure. For this operation, we can use the <code>fit_ball_berry</code> function from the <code>PhotoGEA</code> package, which fits a single Ball-Berry curve to extract the Ball-Berry parameters. To apply this function to each curve in a larger data set and then consolidate the results, we can use it in conjunction with <code>by</code> and <code>consolidate</code>, which are also part of <code>PhotoGEA</code>. (For more information about these functions, see the built-in help menu entries by typing <code><a href="../reference/fit_ball_berry.html">?fit_ball_berry</a></code>, <code><a href="../reference/by.exdf.html">?by.exdf</a></code>, or <code><a href="../reference/consolidate.html">?consolidate</a></code>.) Together, these functions will split apart the main data using the curve identifier column we defined before (<a href="#basic-checks">Basic Checks</a>), make a linear fit of <span class="math inline">\(g_{sw}\)</span> against the Ball-Berry index, and return the resulting parameters and fits:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit a linear model to the Ball-Berry data</span></span>
<span><span class="va">ball_berry_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/consolidate.html">consolidate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span></span>
<span>  <span class="va">licor_data</span>,                       <span class="co"># The `exdf` object containing the curves</span></span>
<span>  <span class="va">licor_data</span><span class="op">[</span>, <span class="st">'curve_identifier'</span><span class="op">]</span>, <span class="co"># A factor used to split `licor_data` into chunks</span></span>
<span>  <span class="va">fit_ball_berry</span>,                   <span class="co"># The function to apply to each chunk of `licor_data`</span></span>
<span>  <span class="st">'gsw'</span>,                            <span class="co"># Additional argument required by `fit_ball_berry`</span></span>
<span>  <span class="st">'bb_index'</span>                        <span class="co"># Additional argument required by `fit_ball_berry`</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="viewing-the-fitted-curves">Viewing the Fitted Curves<a class="anchor" aria-label="anchor" href="#viewing-the-fitted-curves"></a>
</h3>
<p>Having made the fits, it is now a good idea to visually check them, making sure they look reasonable. As before, we can use <code>xyplot</code> from the <code>lattice</code> library to quickly make plots of all the fits, which are stored in <code>ball_berry_results$fits</code>, an <code>exdf</code> object:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the Ball-Berry fits</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">gsw</span> <span class="op">+</span> <span class="va">gsw_fit</span> <span class="op">~</span> <span class="va">bb_index</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">ball_berry_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Ball-Berry index ('</span>, <span class="va">ball_berry_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">bb_index</span>, <span class="st">')'</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Stomatal conductance to H2O ('</span>, <span class="va">ball_berry_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">gsw</span>, <span class="st">')'</span><span class="op">)</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.8</span><span class="op">)</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="analyzing_ball_berry_data_files/figure-html/plot_fits-1.png" width="720" style="display: block; margin: auto;"></p>
<p>All these fits look good!</p>
</div>
<div class="section level3">
<h3 id="viewing-the-fitted-parameter-values">Viewing the Fitted Parameter Values<a class="anchor" aria-label="anchor" href="#viewing-the-fitted-parameter-values"></a>
</h3>
<p>We can also take a look at the fitted Ball-Berry parameter values, which are stored in <code>ball_berry_results$parameters</code>, another <code>exdf</code> object. This object includes many columns but we only care about a few of them. We can view them as follows:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View the Ball-Berry parameters</span></span>
<span><span class="va">columns_for_viewing</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'instrument'</span>, <span class="st">'species'</span>, <span class="st">'plot'</span>, <span class="st">'bb_intercept'</span>, <span class="st">'bb_slope'</span>, <span class="st">'r_squared'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ball_berry_parameters</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">ball_berry_results</span><span class="op">$</span><span class="va">parameters</span><span class="op">[</span> , <span class="va">columns_for_viewing</span>, <span class="cn">TRUE</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ball_berry_parameters</span><span class="op">)</span></span>
<span><span class="co">#&gt;    instrument [UserDefCon] (NA) species [UserDefCon] (NA)</span></span>
<span><span class="co">#&gt; 22                        ripe4                   tobacco</span></span>
<span><span class="co">#&gt; 36                        ripe5                   soybean</span></span>
<span><span class="co">#&gt; 29                        ripe5                   soybean</span></span>
<span><span class="co">#&gt; 43                        ripe5                   soybean</span></span>
<span><span class="co">#&gt; 50                        ripe5                   tobacco</span></span>
<span><span class="co">#&gt;    plot [UserDefCon] (NA) bb_intercept [fit_ball_berry] (mol m^(-2) s^(-1))</span></span>
<span><span class="co">#&gt; 22                      2                                        0.09410874</span></span>
<span><span class="co">#&gt; 36                      1                                        0.18849637</span></span>
<span><span class="co">#&gt; 29                     5a                                        0.10722148</span></span>
<span><span class="co">#&gt; 43                     5c                                        0.09976589</span></span>
<span><span class="co">#&gt; 50                      5                                        0.12819393</span></span>
<span><span class="co">#&gt;    bb_slope [fit_ball_berry] (dimensionless) r_squared [fit_ball_berry] ()</span></span>
<span><span class="co">#&gt; 22                                  3.613489                     0.7186892</span></span>
<span><span class="co">#&gt; 36                                  5.240165                     0.9321769</span></span>
<span><span class="co">#&gt; 29                                  4.823671                     0.8866346</span></span>
<span><span class="co">#&gt; 43                                  5.123674                     0.8454999</span></span>
<span><span class="co">#&gt; 50                                  4.332600                     0.9846671</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extracting-average-values">Extracting Average Values<a class="anchor" aria-label="anchor" href="#extracting-average-values"></a>
</h3>
<p>Finally, we can extract average values of the Ball-Berry parameters for each species using the <code>basic_stats</code> function from <code>PhotoGEA</code>:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute the average and standard error for the Ball-Berry slope and intercept</span></span>
<span><span class="co"># for each species</span></span>
<span><span class="va">ball_berry_averages</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_stats.html">basic_stats</a></span><span class="op">(</span></span>
<span>  <span class="va">ball_berry_results</span><span class="op">$</span><span class="va">parameters</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'species'</span>, <span class="st">'K'</span>, <span class="st">'bb_intercept'</span>, <span class="st">'bb_slope'</span><span class="op">)</span>, <span class="cn">TRUE</span><span class="op">]</span>,</span>
<span>  <span class="st">'species'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the averages and errors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ball_berry_averages</span><span class="op">)</span></span>
<span><span class="co">#&gt;   species [UserDefCon] (NA) K [Const] (NA)</span></span>
<span><span class="co">#&gt; 1                   soybean            0.5</span></span>
<span><span class="co">#&gt; 2                   tobacco            0.5</span></span>
<span><span class="co">#&gt;   bb_intercept_avg [fit_ball_berry] (mol m^(-2) s^(-1))</span></span>
<span><span class="co">#&gt; 1                                             0.1318279</span></span>
<span><span class="co">#&gt; 2                                             0.1111513</span></span>
<span><span class="co">#&gt;   bb_intercept_stderr [fit_ball_berry] (mol m^(-2) s^(-1))</span></span>
<span><span class="co">#&gt; 1                                               0.02841585</span></span>
<span><span class="co">#&gt; 2                                               0.01704259</span></span>
<span><span class="co">#&gt;   bb_slope_avg [fit_ball_berry] (dimensionless)</span></span>
<span><span class="co">#&gt; 1                                      5.062503</span></span>
<span><span class="co">#&gt; 2                                      3.973044</span></span>
<span><span class="co">#&gt;   bb_slope_stderr [fit_ball_berry] (dimensionless)</span></span>
<span><span class="co">#&gt; 1                                        0.1240609</span></span>
<span><span class="co">#&gt; 2                                        0.3595554</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="customizing-your-script">Customizing Your Script<a class="anchor" aria-label="anchor" href="#customizing-your-script"></a>
</h2>
<p>Note that most of the commands in this vignette have been written in a general way so they can be used as the basis for your own Ball-Berry analysis script (see <a href="#commands-from-this-document">Commands From This Document</a>). In order to use them in your own script, some or all of the following changes may be required. There may also be others not specifically mentioned here.</p>
<div class="section level3">
<h3 id="input-files">Input Files<a class="anchor" aria-label="anchor" href="#input-files"></a>
</h3>
<p>The file paths specified in <code>file_paths</code> will need to be modified so they point to your Licor files. In your own script, you may want to consider using the <code>choose_input_licor_files</code> function from <code>PhotoGEA</code>; this function will create a pop-up browser window where you can interactively select a set of Excel files. Sometimes this is more convenient than writing out full file paths. For example, you could replace the previous definition of <code>file_paths</code> with this one:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Interactively define a vector of paths to the files we wish to load</span></span>
<span><span class="va">file_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/choose_input_licor_files.html">choose_input_licor_files</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Unfortunately, <code>choose_input_licor_files</code> is only available in interactive R sessions running on Microsoft Windows.</p>
</div>
<div class="section level3">
<h3 id="curve-identifier">Curve Identifier<a class="anchor" aria-label="anchor" href="#curve-identifier"></a>
</h3>
<p>Depending on which user constants are defined in your Licor Excel files, you may need to modify the definition of the <code>curve_identifier</code> column.</p>
</div>
<div class="section level3">
<h3 id="excluded-curves">Excluded Curves<a class="anchor" aria-label="anchor" href="#excluded-curves"></a>
</h3>
<p>Depending on the qualitative data checks, you may need to change the definition of the <code>curves_to_remove</code> vector.</p>
</div>
<div class="section level3">
<h3 id="averages-and-standard-errors">Averages and Standard Errors<a class="anchor" aria-label="anchor" href="#averages-and-standard-errors"></a>
</h3>
<p>Depending on how your data is organized, you may want to change the column used to divide the data when calculating averages and standard errors.</p>
</div>
<div class="section level3">
<h3 id="plots">Plots<a class="anchor" aria-label="anchor" href="#plots"></a>
</h3>
<p>You may need to change the axis limits in some or all of the plots. Alternatively, you can remove them, allowing <code>xyplot</code> to automatically choose them for you.</p>
</div>
<div class="section level3">
<h3 id="saving-results">Saving Results<a class="anchor" aria-label="anchor" href="#saving-results"></a>
</h3>
<p>You may want to use <code>write.csv</code> to save some or all of the fitting results as <code>csv</code> files. For example, the following commands will allow you to interactively choose output filenames for the resulting <code>csv</code> files:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">ball_berry_results</span><span class="op">$</span><span class="va">fits</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.choose.html" class="external-link">file.choose</a></span><span class="op">(</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">ball_berry_results</span><span class="op">$</span><span class="va">parameters</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.choose.html" class="external-link">file.choose</a></span><span class="op">(</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">ball_berry_averages</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.choose.html" class="external-link">file.choose</a></span><span class="op">(</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="commands-from-this-document">Commands From This Document<a class="anchor" aria-label="anchor" href="#commands-from-this-document"></a>
</h2>
<p>The following code chunk includes all the central commands used throughout this document. They are compiled here to make them easy to copy/paste into a text file to initialize your own script.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/eloch216/PhotoGEA" class="external-link">PhotoGEA</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://lattice.r-forge.r-project.org/" class="external-link">lattice</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a vector of paths to the files we wish to load</span></span>
<span><span class="va">file_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata'</span>, <span class="st">'ball_berry_1.xlsx'</span>, package <span class="op">=</span> <span class="st">'PhotoGEA'</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata'</span>, <span class="st">'ball_berry_2.xlsx'</span>, package <span class="op">=</span> <span class="st">'PhotoGEA'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load each file, storing the result in a list</span></span>
<span><span class="va">licor_exdf_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">file_paths</span>, <span class="kw">function</span><span class="op">(</span><span class="va">fpath</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/read_licor_file.html">read_licor_file</a></span><span class="op">(</span><span class="va">fpath</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">7</span>, <span class="fl">9</span>, <span class="fl">11</span>, <span class="fl">13</span><span class="op">)</span>, <span class="fl">14</span>, <span class="fl">15</span>, <span class="fl">16</span>, <span class="fl">17</span>, <span class="st">'time'</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the names of all columns that are present in all of the Licor files</span></span>
<span><span class="va">columns_to_keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">identify_common_columns</span>, <span class="va">licor_exdf_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract just these columns</span></span>
<span><span class="va">licor_exdf_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">licor_exdf_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span> , <span class="va">columns_to_keep</span>, <span class="cn">TRUE</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use `rbind` to combine all the data</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">licor_exdf_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a new identifier column formatted like `instrument - species - plot`</span></span>
<span><span class="va">licor_data</span><span class="op">[</span> , <span class="st">'curve_identifier'</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">licor_data</span><span class="op">[</span> , <span class="st">'instrument'</span><span class="op">]</span>, <span class="st">'-'</span>, <span class="va">licor_data</span><span class="op">[</span> , <span class="st">'species'</span><span class="op">]</span>, <span class="st">'-'</span>, <span class="va">licor_data</span><span class="op">[</span> , <span class="st">'plot'</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make sure the data meets basic requirements</span></span>
<span><span class="fu"><a href="../reference/check_licor_data.html">check_licor_data</a></span><span class="op">(</span><span class="va">licor_data</span>, <span class="st">'curve_identifier'</span>, <span class="fl">7</span>, <span class="st">'Qin'</span>, <span class="fl">1.0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make a plot to check humidity control</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">RHcham</span> <span class="op">+</span> <span class="va">`Humidifier_%`</span> <span class="op">+</span> <span class="va">`Desiccant_%`</span> <span class="op">~</span> <span class="va">Qin</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">licor_data</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2200</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Incident PPFD ('</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Qin</span>, <span class="st">')'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make a plot to check temperature control</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">TleafCnd</span> <span class="op">+</span> <span class="va">Txchg</span> <span class="op">~</span> <span class="va">Qin</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">licor_data</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2200</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Incident PPFD ('</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Qin</span>, <span class="st">')'</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Temperature ('</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">TleafCnd</span>, <span class="st">')'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make a plot to check CO2 control</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">CO2_s</span> <span class="op">+</span> <span class="va">CO2_r</span> <span class="op">~</span> <span class="va">Qin</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">licor_data</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">360</span>, <span class="fl">480</span><span class="op">)</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2200</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Incident PPFD ('</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Qin</span>, <span class="st">')'</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'CO2 concentration ('</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">CO2_r</span>, <span class="st">')'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make a plot to check light-response curves</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">A</span> <span class="op">~</span> <span class="va">Qin</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">licor_data</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">50</span><span class="op">)</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2200</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Incident PPFD ('</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Qin</span>, <span class="st">')'</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Net assimilation ('</span>, <span class="va">licor_data</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">A</span>, <span class="st">')'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a list of curves to remove from the data set</span></span>
<span><span class="va">curves_to_remove</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">'ripe4 - soybean - 1a'</span>,</span>
<span>  <span class="st">'ripe4 - soybean - 1b'</span>,</span>
<span>  <span class="st">'ripe4 - soybean - 5'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove them</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">licor_data</span><span class="op">[</span><span class="op">!</span><span class="va">licor_data</span><span class="op">[</span>, <span class="st">'curve_identifier'</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">curves_to_remove</span>, , <span class="cn">TRUE</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Calculate additional gas properties, including `RHleaf` and `Csurface`</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_gas_properties.html">calculate_gas_properties</a></span><span class="op">(</span></span>
<span>  <span class="va">licor_data</span>,</span>
<span>  <span class="st">'A'</span>, <span class="st">'Ca'</span>, <span class="st">'DeltaPcham'</span>, <span class="st">'E'</span>, <span class="st">'gbw'</span>, <span class="st">'gsw'</span>, <span class="st">'H2O_s'</span>, <span class="st">'Pa'</span>, <span class="st">'TleafCnd'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the Ball-Berry index</span></span>
<span><span class="va">licor_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_ball_berry_index.html">calculate_ball_berry_index</a></span><span class="op">(</span><span class="va">licor_data</span>, <span class="st">'A'</span>, <span class="st">'RHleaf'</span>, <span class="st">'Csurface'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit a linear model to the Ball-Berry data</span></span>
<span><span class="va">ball_berry_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/consolidate.html">consolidate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span></span>
<span>  <span class="va">licor_data</span>,                       <span class="co"># The `exdf` object containing the curves</span></span>
<span>  <span class="va">licor_data</span><span class="op">[</span>, <span class="st">'curve_identifier'</span><span class="op">]</span>, <span class="co"># A factor used to split `licor_data` into chunks</span></span>
<span>  <span class="va">fit_ball_berry</span>,                   <span class="co"># The function to apply to each chunk of `licor_data`</span></span>
<span>  <span class="st">'gsw'</span>,                            <span class="co"># Additional argument required by `fit_ball_berry`</span></span>
<span>  <span class="st">'bb_index'</span>                        <span class="co"># Additional argument required by `fit_ball_berry`</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the Ball-Berry fits</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">gsw</span> <span class="op">+</span> <span class="va">gsw_fit</span> <span class="op">~</span> <span class="va">bb_index</span> <span class="op">|</span> <span class="va">curve_identifier</span>,</span>
<span>  data <span class="op">=</span> <span class="va">ball_berry_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">main_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Ball-Berry index ('</span>, <span class="va">ball_berry_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">bb_index</span>, <span class="st">')'</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Stomatal conductance to H2O ('</span>, <span class="va">ball_berry_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">gsw</span>, <span class="st">')'</span><span class="op">)</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.8</span><span class="op">)</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the Ball-Berry parameters</span></span>
<span><span class="va">columns_for_viewing</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'instrument'</span>, <span class="st">'species'</span>, <span class="st">'plot'</span>, <span class="st">'bb_intercept'</span>, <span class="st">'bb_slope'</span>, <span class="st">'r_squared'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ball_berry_parameters</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">ball_berry_results</span><span class="op">$</span><span class="va">parameters</span><span class="op">[</span> , <span class="va">columns_for_viewing</span>, <span class="cn">TRUE</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ball_berry_parameters</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute the average and standard error for the Ball-Berry slope and intercept</span></span>
<span><span class="co"># for each species</span></span>
<span><span class="va">ball_berry_averages</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basic_stats.html">basic_stats</a></span><span class="op">(</span></span>
<span>  <span class="va">ball_berry_results</span><span class="op">$</span><span class="va">parameters</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'species'</span>, <span class="st">'K'</span>, <span class="st">'bb_intercept'</span>, <span class="st">'bb_slope'</span><span class="op">)</span>, <span class="cn">TRUE</span><span class="op">]</span>,</span>
<span>  <span class="st">'species'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the averages and errors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ball_berry_averages</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-ball_model_1987" class="csl-entry">
Ball, J. Timothy, Ian E. Woodrow, and Joseph A. Berry. 1987. <span>“A <span>Model</span> <span>Predicting</span> <span>Stomatal</span> <span>Conductance</span> and Its <span>Contribution</span> to the <span>Control</span> of <span>Photosynthesis</span> Under <span>Different</span> <span>Environmental</span> <span>Conditions</span>.”</span> In <em>Progress in <span>Photosynthesis</span> <span>Research</span>: <span>Volume</span> 4 <span>Proceedings</span> of the <span>VIIth</span> <span>International</span> <span>Congress</span> on <span>Photosynthesis</span> <span>Providence</span>, <span>Rhode</span> <span>Island</span>, <span>USA</span>, <span>August</span> 10–15, 1986</em>, edited by J. Biggins, 221–24. Dordrecht: Springer Netherlands. <a href="https://doi.org/10.1007/978-94-017-0519-6_48" class="external-link">https://doi.org/10.1007/978-94-017-0519-6_48</a>.
</div>
<div id="ref-dewar_ballberryleuning_2002" class="csl-entry">
Dewar, R. C. 2002. <span>“The <span>Ball</span>–<span>Berry</span>–<span>Leuning</span> and <span>Tardieu</span>–<span>Davies</span> Stomatal Models: Synthesis and Extension Within a Spatially Aggregated Picture of Guard Cell Function.”</span> <em>Plant, Cell &amp; Environment</em> 25 (11): 1383–98. <a href="https://doi.org/10.1046/j.1365-3040.2002.00909.x" class="external-link">https://doi.org/10.1046/j.1365-3040.2002.00909.x</a>.
</div>
<div id="ref-leuning_critical_1995" class="csl-entry">
Leuning, R. 1995. <span>“A Critical Appraisal of a Combined Stomatal-Photosynthesis Model for <span>C3</span> Plants.”</span> <em>Plant, Cell &amp; Environment</em> 18 (4): 339–55. <a href="https://doi.org/10.1111/j.1365-3040.1995.tb00370.x" class="external-link">https://doi.org/10.1111/j.1365-3040.1995.tb00370.x</a>.
</div>
<div id="ref-tardieu_integration_1993" class="csl-entry">
Tardieu, F., and W. J. Davies. 1993. <span>“Integration of Hydraulic and Chemical Signalling in the Control of Stomatal Conductance and Water Status of Droughted Plants.”</span> <em>Plant, Cell &amp; Environment</em> 16 (4): 341–49. <a href="https://doi.org/10.1111/j.1365-3040.1993.tb00880.x" class="external-link">https://doi.org/10.1111/j.1365-3040.1993.tb00880.x</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Edward B. Lochocki.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
