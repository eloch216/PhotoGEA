<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fits the Medlyn model to an experimental curve — fit_medlyn • PhotoGEA</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fits the Medlyn model to an experimental curve — fit_medlyn"><meta name="description" content="Fits measured values of stomatal conductance using the Medlyn model. This
  function can accomodate alternative column names for the variables taken from
  gas exchange log files in case they change at some point in the future. This
  function also checks the units of each required column and will produce an
  error if any units are incorrect."><meta property="og:description" content="Fits measured values of stomatal conductance using the Medlyn model. This
  function can accomodate alternative column names for the variables taken from
  gas exchange log files in case they change at some point in the future. This
  function also checks the units of each required column and will produce an
  error if any units are incorrect."><meta property="og:image" content="https://eloch216.github.io/PhotoGEA/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    padding-top: 70px;

    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PhotoGEA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/PhotoGEA.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-user-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">User Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-user-guides"><li><h6 class="dropdown-header" data-toc-skip>ANALYSIS GUIDES</h6></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/web_only/analyzing_ball_berry_data.html">Analyzing Ball-Berry Data</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/analyzing_c3_aci_curves.html">Analyzing C3 A-Ci Curves</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/analyzing_c4_aci_curves.html">Analyzing C4 A-Ci Curves</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/analyzing_gm_data.html">Analyzing Mesophyll Conductance Data</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/analyzing_tdl_data.html">Analyzing TDL Data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>GENERAL PHOTOGEA ADVICE</h6></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/web_only/combining_with_other_packages.html">Combining PhotoGEA With Other Packages</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/creating_your_own_processing_tools.html">Creating Your Own Processing Tools</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/developing_a_data_analysis_pipeline.html">Developing a Data Analysis Pipeline</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/working_with_extended_data_frames.html">Working With Extended Data Frames</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/frequent_questions.html">Frequently Asked Questions</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>GENERAL GAS EXCHANGE ADVICE</h6></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/web_only/LI6800_user_constants.html">Guide to Licor LI-6800 User Constants</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../articles/web_only/publications.html">Publications</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/eloch216/PhotoGEA/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Fits the Medlyn model to an experimental curve</h1>

      <div class="d-none name"><code>fit_medlyn.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fits measured values of stomatal conductance using the Medlyn model. This
  function can accomodate alternative column names for the variables taken from
  gas exchange log files in case they change at some point in the future. This
  function also checks the units of each required column and will produce an
  error if any units are incorrect.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fit_medlyn</span><span class="op">(</span></span>
<span>    <span class="va">replicate_exdf</span>,</span>
<span>    a_column_name <span class="op">=</span> <span class="st">'A'</span>,</span>
<span>    csurface_column_name <span class="op">=</span> <span class="st">'Csurface'</span>,</span>
<span>    gsw_column_name <span class="op">=</span> <span class="st">'gsw'</span>,</span>
<span>    vpdleaf_column_name <span class="op">=</span> <span class="st">'VPDleaf'</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-replicate-exdf">replicate_exdf<a class="anchor" aria-label="anchor" href="#arg-replicate-exdf"></a></dt>
<dd><p>An <code>exdf</code> object representing one Ball-Berry curve.</p></dd>


  <dt id="arg-a-column-name">a_column_name<a class="anchor" aria-label="anchor" href="#arg-a-column-name"></a></dt>
<dd><p>The name of the column in <code>replicate_exdf</code> that contains the net
    assimilation in <code>micromol m^(-2) s^(-1)</code>.</p></dd>


  <dt id="arg-csurface-column-name">csurface_column_name<a class="anchor" aria-label="anchor" href="#arg-csurface-column-name"></a></dt>
<dd><p>The name of the column in <code>replicate_exdf</code> that contains the
    CO2 concentration at the leaf surface in <code>micromol mol^(-1)</code>.</p></dd>


  <dt id="arg-gsw-column-name">gsw_column_name<a class="anchor" aria-label="anchor" href="#arg-gsw-column-name"></a></dt>
<dd><p>The name of the column in <code>replicate_exdf</code> that contains the stomatal
    conductance to water vapor in <code>mol m^(-2) s^(-1)</code>.</p></dd>


  <dt id="arg-vpdleaf-column-name">vpdleaf_column_name<a class="anchor" aria-label="anchor" href="#arg-vpdleaf-column-name"></a></dt>
<dd><p>The name of the column in <code>replicate_exdf</code> that contains the vapor
    pressure deficit at the leaf surface in <code>kPa</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The Medlyn model is a simple way to describe the response of a leaf's stomata
  to its assimilation rate and local environmental consitions. Specifically, it
  predicts that the stomatal conductance to water vapor (<code>gsw</code>) using the
  following equation:</p>
<p><code>gsw = g0 + 1.6 * (1 + g1 / sqrt(VPDleaf)) * A / Csurface</code>,</p>
<p>where <code>VPDleaf</code> is the vapor pressure deficit at the leaf surface,
  <code>A</code> is the net CO2 assimilation rate, <code>Csurface</code> is the CO2
  concentration at the leaf surface, <code>g0</code> is the stomatal conductance when
  <code>A</code> is zero, and <code>g1</code> is a parameter describing the leaf's combined
  response to environmental parameters.</p>
<p>Fits from this model are typically plotted with <code>gsw</code> on the Y-axis and
  <code>A / (Csurface * sqrt(VPDleaf))</code> on the X-axis. Because <code>g1</code> is
  typically close to or larger than 1, the model exhibits an almost linear
  response of <code>gsw</code> to <code>A / (Csurface * sqrt(VPDleaf))</code>, which we
  refer to as the "Medlyn index" in analogy with the Ball-Berry index (see
  <code><a href="calculate_ball_berry_index.html">calculate_ball_berry_index</a></code>).</p>
<p>Although this model is certainly an oversimplification, it does encode some
  important stomatal responses. For example, when humidity is low, the stomata
  close, reducing stomatal conductance. Likewise, if the CO2 concentration
  around the leaf is depleted, the stomata open to allow more CO2 to diffuse
  into the leaf's interior, increasing somatal conductance.</p>
<p>The Medlyn model was originally described in Medlyn, B. E. et al. "Reconciling
  the optimal and empirical approaches to modelling stomatal conductance."
  Global Change Biology 17, 2134–2144 (2011)
  [<a href="https://doi.org/10.1111/j.1365-2486.2010.02375.x" class="external-link">doi:10.1111/j.1365-2486.2010.02375.x</a>
].</p>
<p>Medlyn parameters are typically determined using the same type of response
  curve measured for parameterizing the Ball-Berry model. See
  <code><a href="fit_ball_berry.html">fit_ball_berry</a></code> for more details.</p>
<p>This function uses <code><a href="https://rdrr.io/r/stats/nls.html" class="external-link">nls</a></code> to perform the fit, beginning from
  an initial guess of <code>g0 = 0.005</code> and <code>g1 = 4</code>.</p>
<p>This function assumes that <code>replicate_exdf</code> represents a single response
  curve. To fit multiple curves at once, this function is often used along with
  <code><a href="by.exdf.html">by.exdf</a></code> and <code><a href="consolidate.html">consolidate</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with two elements:</p><ul><li><p><code>fits</code>: An <code>exdf</code> object including the measured values and
          the fitted values of stomatal conductance. The fitted values will be
          stored in a column whose name is determined by appending
          <code>'_fits'</code> to the end of <code>gsw_column_name</code>; typically, this
          will be <code>'gsw_fits'</code>. Also includes residuals in the
          <code>gsw_residuals</code> column and values of the Medlyn model parameters
          <code>medlyn_g0</code> and <code>medlyn_g1</code>.</p></li>
<li><p><code>parameters</code>: An <code>exdf</code> object including the fitting
          parameters and R-squared value. The Medlyn model parameters are stored
          in the <code>medlyn_g0</code> and <code>medlyn_g1</code> columns, their standard
          errors are stored in the <code>medlyn_g0_err</code> and <code>medlyn_g1_err</code>
          columns. Other statistical descriptors of the fit as calculated by
          <code><a href="residual_stats.html">residual_stats</a></code> are also included.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Read an example Licor file included in the PhotoGEA package, calculate</span></span></span>
<span class="r-in"><span><span class="co"># additional gas properties, calculate the Ball-Berry index, define a new column</span></span></span>
<span class="r-in"><span><span class="co"># that uniquely identifies each curve, and then perform a fit to extract the</span></span></span>
<span class="r-in"><span><span class="co"># Ball-Berry parameters from each curve.</span></span></span>
<span class="r-in"><span><span class="va">licor_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="read_gasex_file.html">read_gasex_file</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="PhotoGEA_example_file_path.html">PhotoGEA_example_file_path</a></span><span class="op">(</span><span class="st">'ball_berry_1.xlsx'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">licor_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="calculate_total_pressure.html">calculate_total_pressure</a></span><span class="op">(</span><span class="va">licor_file</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">licor_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="calculate_gas_properties.html">calculate_gas_properties</a></span><span class="op">(</span><span class="va">licor_file</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">licor_file</span><span class="op">[</span>,<span class="st">'species_plot'</span><span class="op">]</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">licor_file</span><span class="op">[</span>,<span class="st">'species'</span><span class="op">]</span>, <span class="st">'-'</span>, <span class="va">licor_file</span><span class="op">[</span>,<span class="st">'plot'</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fit just one curve from the data set (it is rare to do this)</span></span></span>
<span class="r-in"><span><span class="va">one_result</span> <span class="op">&lt;-</span> <span class="fu">fit_medlyn</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">licor_file</span><span class="op">[</span><span class="va">licor_file</span><span class="op">[</span>, <span class="st">'species_plot'</span><span class="op">]</span> <span class="op">==</span> <span class="st">'soybean - 1a'</span>, , <span class="cn">TRUE</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fit all curves in the data set (it is more common to do this)</span></span></span>
<span class="r-in"><span><span class="va">medlyn_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="consolidate.html">consolidate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">licor_file</span>,</span></span>
<span class="r-in"><span>  <span class="va">licor_file</span><span class="op">[</span>, <span class="st">'species_plot'</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  <span class="va">fit_medlyn</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># View the fitting parameters for each species / plot</span></span></span>
<span class="r-in"><span><span class="va">col_to_keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'species'</span>, <span class="st">'plot'</span>, <span class="st">'species_plot'</span>, <span class="st">'medlyn_g0'</span>, <span class="st">'medlyn_g1'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">medlyn_results</span><span class="op">$</span><span class="va">parameters</span><span class="op">[</span> , <span class="va">col_to_keep</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   species plot species_plot  medlyn_g0 medlyn_g1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 soybean   1a soybean - 1a 0.10346656 0.9324673</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 soybean   1b soybean - 1b 0.08805109 2.6410048</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 soybean    5  soybean - 5 0.11431838 2.9748932</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 tobacco    2  tobacco - 2 0.09017758 0.8902868</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># View the fits for each species / plot</span></span></span>
<span class="r-in"><span><span class="fu">lattice</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">gsw</span> <span class="op">+</span> <span class="va">gsw_fit</span> <span class="op">~</span> <span class="va">medlyn_index</span> <span class="op">|</span> <span class="va">species_plot</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">medlyn_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">main_data</span>,</span></span>
<span class="r-in"><span>  type <span class="op">=</span> <span class="st">'b'</span>,</span></span>
<span class="r-in"><span>  pch <span class="op">=</span> <span class="fl">16</span>,</span></span>
<span class="r-in"><span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Medlyn index ['</span>, <span class="va">medlyn_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">medlyn_index</span>, <span class="st">']'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Stomatal conductance to H2O ['</span>, <span class="va">medlyn_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">gsw</span>, <span class="st">']'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="fit_medlyn-1.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Edward B. Lochocki, Coralie E. Salesse-Smith, Justin M. McGrath.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

