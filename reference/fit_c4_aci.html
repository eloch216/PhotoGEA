<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Fits a model to an experimentally measured C4 CO2 response curve using the
  data in the exdf object along with a few other user-supplied
  parameters. This function can accomodate alternative column names for the
  variables taken from the Licor file in case they change at some point in the
  future. This function also checks the units of each required column and will
  produce an error if any units are incorrect."><title>Fits a C4 assimilation model to an experimental curve — fit_c4_aci • PhotoGEA</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fits a C4 assimilation model to an experimental curve — fit_c4_aci"><meta property="og:description" content="Fits a model to an experimentally measured C4 CO2 response curve using the
  data in the exdf object along with a few other user-supplied
  parameters. This function can accomodate alternative column names for the
  variables taken from the Licor file in case they change at some point in the
  future. This function also checks the units of each required column and will
  produce an error if any units are incorrect."><meta property="og:image" content="https://eloch216.github.io/PhotoGEA/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    padding-top: 70px;

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">PhotoGEA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/PhotoGEA.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/analyzing_ball_berry_data.html">Analyzing Ball-Berry Data</a>
    <a class="dropdown-item" href="../articles/analyzing_c3_aci_curves.html">Analyzing C3 A-Ci Curves</a>
    <a class="dropdown-item" href="../articles/analyzing_c4_aci_curves.html">Analyzing C4 A-Ci Curves</a>
    <a class="dropdown-item" href="../articles/analyzing_gm_data.html">Analyzing Mesophyll Conductance Data</a>
    <a class="dropdown-item" href="../articles/analyzing_tdl_data.html">Analyzing TDL Data</a>
    <a class="dropdown-item" href="../articles/combining_with_other_packages.html">Combining PhotoGEA With Other Packages</a>
    <a class="dropdown-item" href="../articles/creating_your_own_processing_tools.html">Creating Your Own Processing Tools</a>
    <a class="dropdown-item" href="../articles/developing_a_data_analysis_pipeline.html">Developing a Data Analysis Pipeline</a>
    <a class="dropdown-item" href="../articles/working_with_extended_data_frames.html">Working With Extended Data Frames</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/eloch216/PhotoGEA/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Fits a C4 assimilation model to an experimental curve</h1>
      
      <div class="d-none name"><code>fit_c4_aci.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fits a model to an experimentally measured C4 CO2 response curve using the
  data in the <code>exdf</code> object along with a few other user-supplied
  parameters. This function can accomodate alternative column names for the
  variables taken from the Licor file in case they change at some point in the
  future. This function also checks the units of each required column and will
  produce an error if any units are incorrect.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fit_c4_aci</span><span class="op">(</span></span>
<span>    <span class="va">replicate_exdf</span>,</span>
<span>    a_column_name <span class="op">=</span> <span class="st">'A'</span>,</span>
<span>    pcm_column_name <span class="op">=</span> <span class="st">'PCm'</span>,</span>
<span>    kc_column_name <span class="op">=</span> <span class="st">'Kc'</span>,</span>
<span>    ko_column_name <span class="op">=</span> <span class="st">'Ko'</span>,</span>
<span>    kp_column_name <span class="op">=</span> <span class="st">'Kp'</span>,</span>
<span>    gamma_star_column_name <span class="op">=</span> <span class="st">'gamma_star'</span>,</span>
<span>    ao_column_name <span class="op">=</span> <span class="st">'ao'</span>,</span>
<span>    vcmax_norm_column_name <span class="op">=</span> <span class="st">'Vcmax_norm'</span>,</span>
<span>    vpmax_norm_column_name <span class="op">=</span> <span class="st">'Vpmax_norm'</span>,</span>
<span>    rd_norm_column_name <span class="op">=</span> <span class="st">'Rd_norm'</span>,</span>
<span>    POm <span class="op">=</span> <span class="fl">210000</span>,</span>
<span>    gbs <span class="op">=</span> <span class="fl">0.003</span>,</span>
<span>    Rm_frac <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    OPTIM_FUN <span class="op">=</span> <span class="fu"><a href="default_optimizer.html">default_optimizer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    initial_guess_fun <span class="op">=</span> <span class="fu"><a href="initial_guess_c4_aci.html">initial_guess_c4_aci</a></span><span class="op">(</span></span>
<span>      gbs <span class="op">=</span> <span class="va">gbs</span>,</span>
<span>      Rm_frac <span class="op">=</span> <span class="va">Rm_frac</span>,</span>
<span>      a_column_name <span class="op">=</span> <span class="va">a_column_name</span>,</span>
<span>      pcm_column_name <span class="op">=</span> <span class="va">pcm_column_name</span>,</span>
<span>      kp_column_name <span class="op">=</span> <span class="va">kp_column_name</span>,</span>
<span>      rd_norm_column_name <span class="op">=</span> <span class="va">rd_norm_column_name</span>,</span>
<span>      vcmax_norm_column_name <span class="op">=</span> <span class="va">vcmax_norm_column_name</span>,</span>
<span>      vpmax_norm_column_name <span class="op">=</span> <span class="va">vpmax_norm_column_name</span></span>
<span>    <span class="op">)</span>,</span>
<span>    lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,   <span class="fl">0</span>,   <span class="fl">0</span>,    <span class="fl">0</span><span class="op">)</span>,</span>
<span>    upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span>, <span class="fl">1000</span>, <span class="fl">1000</span><span class="op">)</span>,</span>
<span>    fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>,  <span class="cn">NA</span>,  <span class="cn">NA</span>,   <span class="fl">1000</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>replicate_exdf</dt>
<dd><p>An <code>exdf</code> object representing one CO2 response curve.</p></dd>


  <dt>a_column_name</dt>
<dd><p>The name of the column in <code>replicate_exdf</code> that contains the net
    assimilation in <code>micromol m^(-2) s^(-1)</code>.</p></dd>


  <dt>pcm_column_name</dt>
<dd><p>The name of the column in <code>exdf_obj</code> that contains the partial pressure
    of CO2 in the mesophyll, expressed in <code>microbar</code>.</p></dd>


  <dt>kc_column_name</dt>
<dd><p>The name of the column in <code>exdf_obj</code> that contains the Michaelis-Menten
    constant for rubisco carboxylation in <code>microbar</code>.</p></dd>


  <dt>ko_column_name</dt>
<dd><p>The name of the column in <code>exdf_obj</code> that contains the Michaelis-Menten
    constant for rubisco oxygenation in <code>mbar</code>.</p></dd>


  <dt>kp_column_name</dt>
<dd><p>The name of the column in <code>exdf_obj</code> that contains the Michaelis-Menten
    constant for PEP carboxylase carboxylation in <code>microbar</code>.</p></dd>


  <dt>gamma_star_column_name</dt>
<dd><p>The name of the column in <code>exdf_obj</code> that contains the dimensionless
    <code>gamma_star</code> values.</p></dd>


  <dt>ao_column_name</dt>
<dd><p>The name of the column in <code>exdf_obj</code> that contains the dimensionless
    ratio of solubility and diffusivity of O2 to CO2.</p></dd>


  <dt>vcmax_norm_column_name</dt>
<dd><p>The name of the column in <code>exdf_obj</code> that contains the normalized
    <code>Vcmax</code> values (with units of
    <code>normalized to Vcmax at 25 degrees C</code>).</p></dd>


  <dt>vpmax_norm_column_name</dt>
<dd><p>The name of the column in <code>exdf_obj</code> that contains the normalized
    <code>Vpmax</code> values (with units of
    <code>normalized to Vpmax at 25 degrees C</code>).</p></dd>


  <dt>rd_norm_column_name</dt>
<dd><p>The name of the column in <code>exdf_obj</code> that contains the normalized
    <code>Rd</code> values (with units of <code>normalized to Rd at 25 degrees C</code>).</p></dd>


  <dt>POm</dt>
<dd><p>The partial pressure of O2 in the mesophyll, expressed in <code>microbar</code>.
    This is often assumed to be the ambient value. For air measurements, this
    would be 21 percent O2, which is about 210000 microbar at standard
    atmospheric pressure. For low oxygen measurements, this would be 2 percent
    O2, which is about 20000 microbar.</p></dd>


  <dt>gbs</dt>
<dd><p>The bundle sheath conductance to CO2 in <code>mol m^(-2) s^(-1) bar^(-1)</code>.</p></dd>


  <dt>Rm_frac</dt>
<dd><p>The fraction of the total mitochondrial respiration that occurs in the
    mesophyll.</p></dd>


  <dt>alpha</dt>
<dd><p>The fraction of photosystem II activity in the bundle sheath.</p></dd>


  <dt>OPTIM_FUN</dt>
<dd><p>An optimization function that accepts the following input arguments: an
    initial guess, an error function, lower bounds, and upper bounds. It should
    return a list with the following elements: <code>par</code>, <code>convergence</code>,
    <code>value</code>, and (optionally) <code>message</code>. The bounded optimizers from
    the <code>dfoptim</code> package meet these requirements. The base function
    <code>optim</code> with the <code>L-BFGS-B</code> method can also be used.</p></dd>


  <dt>initial_guess_fun</dt>
<dd><p>A function that estimates values of <code>Rd</code>, <code>Vcmax</code>, <code>Vpmax</code>,
    and <code>Vpr</code>; <code>initial_guess_fun</code> should have one input argument (an
    <code>exdf</code> object representing a single response curve and should return a
    vector of the estimated values (at 25 degrees C) in the order above.</p></dd>


  <dt>lower</dt>
<dd><p>A numeric vector containing lower bounds for the values of <code>Rd</code>,
    <code>Vcmax</code>, <code>Vpmax</code>, and <code>Vpr</code>, in that order.</p></dd>


  <dt>upper</dt>
<dd><p>A numeric vector containing upper bounds for the values of <code>Rd</code>,
    <code>Vcmax</code>, <code>Vpmax</code>, and <code>Vpr</code>, in that order.</p></dd>


  <dt>fixed</dt>
<dd><p>A numeric vector specifying fixed values of <code>Rd</code>, <code>Vcmax</code>,
    <code>Vpmax</code>, and <code>Vpr</code>, in that order. Values of <code>NA</code> indicate
    that the corresponding parameter is not fixed and should be varied during
    the optimization procedure. The default value of this argument fixes
    <code>Vpr</code> to a high value (so net assimilation is rarely limited by PEP
    carboxylase regeneration) and allows the other parameters to vary. To vary
    all of the parameters, set <code>fixed</code> to <code>c(NA, NA, NA, NA)</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function calls <code><a href="calculate_c4_assimilation.html">calculate_c4_assimilation</a></code> to calculate
  values of net assimilation. The user-supplied optimization function is used to
  vary the values of <code>Rd</code>, <code>Vcmax</code>, <code>Vpmax</code>, and <code>Vpr</code> to
  find ones that best reproduce the experimentally measured values of net
  assimilation.</p>
<p>The photosynthesis model represented by <code>calculate_c4_assimilation</code> is
  not smooth in the sense that small changes in the input parameters do not
  necessarily cause changes in its outputs. This is related to the calculation
  of the PEP carboxylase activity <code>Vp</code>, which is taken to be the minimum of
  <code>Vpr</code> and <code>Vpc</code>. For example, if <code>Vpr</code> is high and <code>Vp =
  Vpc</code> at all points along the curve, modifying <code>Vpr</code> by a small amount
  will not change the model's outputs. For this reason, derivative-based
  optimizers tend to struggle when fitting C4 A-Ci curves. Best results are
  obtained using derivative-free methods. It has been found that
  <code><a href="https://rdrr.io/pkg/dfoptim/man/nmkb.html" class="external-link">dfoptim::nmkb</a></code> is often able to find a good fit.</p>
<p>By default, this function will use <code>initial_guess_c4_aci</code> to make rough
  estimates of the parameters to use as an initial guess. However, it is
  possible to also use a fixed initial guess by using something like the
  following for the <code>initial_guess_fun</code>:
  <code>function(x){c(1, 20, 60, 90)}</code>, which would set the initial guess to
  <code>Rd = 1</code>, <code>Vcmax = 20</code>, <code>Vpmax = 60</code>, and <code>Vpr = 90</code>.</p>
<p>By default, this function fixes <code>Vpr</code> to a high value (<code>800 micromol
  m^(-2) s^(-1)</code>) and allows the other parameters to be fitted. This behavior
  is determined by the value of the <code>fixed</code> input argument, and the value
  of <code>Vpr</code> specified in this way will override any value returned by
  <code>initial_guess_fun</code>.</p>
<p>This function assumes that <code>replicate_exdf</code> represents a single
  C4 A-Ci curve. To fit multiple curves at once, this function is often used
  along with <code><a href="by.exdf.html">by.exdf</a></code> and <code><a href="consolidate.html">consolidate</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list with two elements:</p>
<p></p>
<ul><li><p><code>fits</code>: An <code>exdf</code> object including the original contents of
          <code>replicate_exdf</code> along with several new columns:</p><ul><li><p>The fitted values of net assimilation will be stored in a
                  column whose name is determined by appending <code>'_fit'</code> to
                  the end of <code>a_column_name</code>; typically, this will be
                  <code>'A_fit'</code>.</p></li>
<li><p>Residuals (measured - fitted) will be stored in a column whose
                  name is determined by appending <code>'_residuals'</code> to the end
                  of <code>a_column_name</code>; typically, this will be
                  <code>'A_residuals'</code>.</p></li>
<li><p>The other outputs from <code><a href="calculate_c4_assimilation.html">calculate_c4_assimilation</a></code>
                  will be stored in columns with the usual names:
                  <code>Vcmax_tl</code>, <code>Vpmax_tl</code>, <code>Rd_tl</code>, <code>Rm_tl</code>,
                  <code>Vp</code>, <code>Apc</code>, <code>Apr</code>, <code>Ap</code>, and <code>Ar</code>.</p></li>
</ul></li>
<li><p><code>parameters</code>: An <code>exdf</code> object including the identifiers,
          fitting parameters, and convergence information for the A-Ci curve:</p><ul><li><p>The best-fit values are stored in the <code>Rd_at_25</code>,
                  <code>Vcmax_at_25</code>, <code>Vpmax_at_25</code>, and <code>Vpr</code>
                  columns.</p></li>
<li><p>For parameters that depend on leaf temperature, the average
                  leaf-temperature-dependent values are stored in
                  <code>X_tl_avg</code> columns: <code>Rd_tl_avg</code>,
                  <code>Vcmax_tl_avg</code>, and <code>Vpmax_tl_avg</code>.</p></li>
<li><p>The <code>convergence</code> column indicates whether the fit was
                  successful (<code>==0</code>) or if the optimizer encountered a
                  problem (<code>!=0</code>).</p></li>
<li><p>The <code>feval</code> column indicates how many cost function
                  evaluations were required while finding the optimal parameter
                  values.</p></li>
<li><p>The residual stats as returned by <code><a href="residual_stats.html">residual_stats</a></code>
                  are included as columns with the default names: <code>dof</code>,
                  <code>RSS</code>, <code>RMSE</code>, etc.</p></li>
</ul></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Read an example Licor file included in the PhotoGEA package</span></span></span>
<span class="r-in"><span><span class="va">licor_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="read_gasex_file.html">read_gasex_file</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata'</span>, <span class="st">'c4_aci_1.xlsx'</span>, package <span class="op">=</span> <span class="st">'PhotoGEA'</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define a new column that uniquely identifies each curve</span></span></span>
<span class="r-in"><span><span class="va">licor_file</span><span class="op">[</span>, <span class="st">'species_plot'</span><span class="op">]</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">licor_file</span><span class="op">[</span>, <span class="st">'species'</span><span class="op">]</span>, <span class="st">'-'</span>, <span class="va">licor_file</span><span class="op">[</span>, <span class="st">'plot'</span><span class="op">]</span> <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Organize the data</span></span></span>
<span class="r-in"><span><span class="va">licor_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="organize_response_curve_data.html">organize_response_curve_data</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">licor_file</span>,</span></span>
<span class="r-in"><span>    <span class="st">'species_plot'</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">10</span>, <span class="fl">16</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="st">'CO2_r_sp'</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate temperature-dependent values of C4 photosynthetic parameters</span></span></span>
<span class="r-in"><span><span class="va">licor_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="calculate_arrhenius.html">calculate_arrhenius</a></span><span class="op">(</span><span class="va">licor_file</span>, <span class="va">c4_arrhenius_von_caemmerer</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate the total pressure in the Licor chamber</span></span></span>
<span class="r-in"><span><span class="va">licor_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="calculate_total_pressure.html">calculate_total_pressure</a></span><span class="op">(</span><span class="va">licor_file</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate PCm</span></span></span>
<span class="r-in"><span><span class="va">licor_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="apply_gm.html">apply_gm</a></span><span class="op">(</span><span class="va">licor_file</span>, <span class="st">'C4'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fit just one curve from the data set (it is rare to do this)</span></span></span>
<span class="r-in"><span><span class="va">one_result</span> <span class="op">&lt;-</span> <span class="fu">fit_c4_aci</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">licor_file</span><span class="op">[</span><span class="va">licor_file</span><span class="op">[</span>, <span class="st">'species_plot'</span><span class="op">]</span> <span class="op">==</span> <span class="st">'maize - 5'</span>, , <span class="cn">TRUE</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fit all curves in the data set (it is more common to do this)</span></span></span>
<span class="r-in"><span><span class="va">aci_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="consolidate.html">consolidate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">licor_file</span>,</span></span>
<span class="r-in"><span>  <span class="va">licor_file</span><span class="op">[</span>, <span class="st">'species_plot'</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  <span class="va">fit_c4_aci</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># View the fitting parameters for each species / plot</span></span></span>
<span class="r-in"><span><span class="va">col_to_keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="st">'species'</span>, <span class="st">'plot'</span>,                                       <span class="co"># identifiers</span></span></span>
<span class="r-in"><span>  <span class="st">'Rd_at_25'</span>, <span class="st">'Vcmax_at_25'</span>, <span class="st">'Vpmax_at_25'</span>, <span class="st">'Vpr'</span>,         <span class="co"># parameters scaled to 25 degrees C</span></span></span>
<span class="r-in"><span>  <span class="st">'Rd_tl_avg'</span>, <span class="st">'Vcmax_tl_avg'</span>, <span class="st">'Vpmax_tl_avg'</span>,             <span class="co"># average temperature-dependent values</span></span></span>
<span class="r-in"><span>  <span class="st">'dof'</span>, <span class="st">'RSS'</span>, <span class="st">'MSE'</span>, <span class="st">'RMSE'</span>, <span class="st">'RSE'</span>,                      <span class="co"># residual stats</span></span></span>
<span class="r-in"><span>  <span class="st">'convergence'</span>, <span class="st">'convergence_msg'</span>, <span class="st">'feval'</span>, <span class="st">'optimum_val'</span> <span class="co"># convergence info</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">aci_results</span><span class="op">$</span><span class="va">parameters</span><span class="op">[</span> , <span class="va">col_to_keep</span>, <span class="cn">TRUE</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   species [UserDefCon] (NA) plot [UserDefCon] (NA)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                     maize                      5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                   sorghum                      2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                   sorghum                      3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Rd_at_25 [fit_c4_aci] (micromol m^(-2) s^(-1))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                                   3.186012e-08</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                                   7.313382e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                                   6.980638e-10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Vcmax_at_25 [fit_c4_aci] (micromol m^(-2) s^(-1))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                                          36.30228</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                                          42.62241</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                                          38.84480</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Vpmax_at_25 [fit_c4_aci] (micromol m^(-2) s^(-1))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                                          180.5114</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                                          149.4698</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                                          145.9849</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Vpr [fit_c4_aci] (micromol m^(-2) s^(-1))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                                      1000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                                      1000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                                      1000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Rd_tl_avg [fit_c4_aci] (micromol m^(-2) s^(-1))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                                    5.091267e-08</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                                    1.133561e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                                    1.118607e-09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Vcmax_tl_avg [fit_c4_aci] (micromol m^(-2) s^(-1))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                                           62.96484</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                                           71.32106</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                                           67.59896</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Vpmax_tl_avg [fit_c4_aci] (micromol m^(-2) s^(-1)) dof [residual_stats] (NA)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                                           257.0925                        10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                                           208.0441                        10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                                           208.3413                        10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   RSS [residual_stats] ((micromol m^(-2) s^(-1))^2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                                         230.39540</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                                         448.93327</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                                          70.77968</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   MSE [residual_stats] ((micromol m^(-2) s^(-1))^2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                                         17.722723</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                                         34.533328</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                                          5.444591</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   RMSE [residual_stats] (micromol m^(-2) s^(-1))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                                       4.209836</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                                       5.876506</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                                       2.333365</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   RSE [residual_stats] (micromol m^(-2) s^(-1)) convergence [fit_c4_aci] ()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                                      4.799952                           0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                                      6.700248                           0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                                      2.660445                           0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   convergence_msg [fit_c4_aci] () feval [fit_c4_aci] ()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          Successful convergence                   194</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2          Successful convergence                   175</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3          Successful convergence                   249</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   optimum_val [fit_c4_aci] ()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                   230.39540</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                   448.93327</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                    70.77968</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># View the fits for each species / plot</span></span></span>
<span class="r-in"><span><span class="fu">lattice</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">Ar</span> <span class="op">+</span> <span class="va">Apc</span> <span class="op">+</span> <span class="va">A_fit</span> <span class="op">+</span> <span class="va">A</span> <span class="op">~</span> <span class="va">Ci</span> <span class="op">|</span> <span class="va">species_plot</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">aci_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">main_data</span>,</span></span>
<span class="r-in"><span>  type <span class="op">=</span> <span class="st">'b'</span>,</span></span>
<span class="r-in"><span>  pch <span class="op">=</span> <span class="fl">16</span>,</span></span>
<span class="r-in"><span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Intercellular CO2 concentration ['</span>, <span class="va">aci_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Ci</span>, <span class="st">']'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Assimilation rate ['</span>, <span class="va">aci_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">A</span>, <span class="st">']'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="fit_c4_aci-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># View the residuals for each species / plot</span></span></span>
<span class="r-in"><span><span class="fu">lattice</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">A_residuals</span> <span class="op">~</span> <span class="va">Ci</span> <span class="op">|</span> <span class="va">species_plot</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">aci_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">main_data</span>,</span></span>
<span class="r-in"><span>  type <span class="op">=</span> <span class="st">'b'</span>,</span></span>
<span class="r-in"><span>  pch <span class="op">=</span> <span class="fl">16</span>,</span></span>
<span class="r-in"><span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Intercellular CO2 concentration ['</span>, <span class="va">aci_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">Ci</span>, <span class="st">']'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Assimilation rate residuals ['</span>, <span class="va">aci_results</span><span class="op">$</span><span class="va">fits</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">A_residuals</span>, <span class="st">']'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="fit_c4_aci-2.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Edward B. Lochocki.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

