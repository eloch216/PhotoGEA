<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate C4 assimilation rates — calculate_c4_assimilation • PhotoGEA</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate C4 assimilation rates — calculate_c4_assimilation"><meta name="description" content="Calculates C4 assimilation rates based on the von Caemmerer (2000) model. This
  function can accomodate alternative colum names for the variables taken from
  Licor files in case they change at some point in the future. This function
  also checks the units of each required column and will produce an error if any
  units are incorrect."><meta property="og:description" content="Calculates C4 assimilation rates based on the von Caemmerer (2000) model. This
  function can accomodate alternative colum names for the variables taken from
  Licor files in case they change at some point in the future. This function
  also checks the units of each required column and will produce an error if any
  units are incorrect."><meta property="og:image" content="https://eloch216.github.io/PhotoGEA/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    padding-top: 70px;

    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PhotoGEA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/PhotoGEA.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/analyzing_ball_berry_data.html">Analyzing Ball-Berry Data</a></li>
    <li><a class="dropdown-item" href="../articles/analyzing_c3_aci_curves.html">Analyzing C3 A-Ci Curves</a></li>
    <li><a class="dropdown-item" href="../articles/analyzing_c4_aci_curves.html">Analyzing C4 A-Ci Curves</a></li>
    <li><a class="dropdown-item" href="../articles/analyzing_gm_data.html">Analyzing Mesophyll Conductance Data</a></li>
    <li><a class="dropdown-item" href="../articles/analyzing_tdl_data.html">Analyzing TDL Data</a></li>
    <li><a class="dropdown-item" href="../articles/combining_with_other_packages.html">Combining PhotoGEA With Other Packages</a></li>
    <li><a class="dropdown-item" href="../articles/creating_your_own_processing_tools.html">Creating Your Own Processing Tools</a></li>
    <li><a class="dropdown-item" href="../articles/developing_a_data_analysis_pipeline.html">Developing a Data Analysis Pipeline</a></li>
    <li><a class="dropdown-item" href="../articles/working_with_extended_data_frames.html">Working With Extended Data Frames</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/eloch216/PhotoGEA/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Calculate C4 assimilation rates</h1>

      <div class="d-none name"><code>calculate_c4_assimilation.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculates C4 assimilation rates based on the von Caemmerer (2000) model. This
  function can accomodate alternative colum names for the variables taken from
  Licor files in case they change at some point in the future. This function
  also checks the units of each required column and will produce an error if any
  units are incorrect.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calculate_c4_assimilation</span><span class="op">(</span></span>
<span>    <span class="va">exdf_obj</span>,</span>
<span>    <span class="va">alpha_psii</span>,</span>
<span>    <span class="va">gbs</span>,</span>
<span>    <span class="va">J_at_25</span>,</span>
<span>    <span class="va">RL_at_25</span>,</span>
<span>    <span class="va">Rm_frac</span>,</span>
<span>    <span class="va">Vcmax_at_25</span>,</span>
<span>    <span class="va">Vpmax_at_25</span>,</span>
<span>    <span class="va">Vpr</span>,</span>
<span>    x_etr <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>    ao_column_name <span class="op">=</span> <span class="st">'ao'</span>,</span>
<span>    gamma_star_column_name <span class="op">=</span> <span class="st">'gamma_star'</span>,</span>
<span>    j_norm_column_name <span class="op">=</span> <span class="st">'J_norm'</span>,</span>
<span>    kc_column_name <span class="op">=</span> <span class="st">'Kc'</span>,</span>
<span>    ko_column_name <span class="op">=</span> <span class="st">'Ko'</span>,</span>
<span>    kp_column_name <span class="op">=</span> <span class="st">'Kp'</span>,</span>
<span>    oxygen_column_name <span class="op">=</span> <span class="st">'oxygen'</span>,</span>
<span>    pcm_column_name <span class="op">=</span> <span class="st">'PCm'</span>,</span>
<span>    qin_column_name <span class="op">=</span> <span class="st">'Qin'</span>,</span>
<span>    rl_norm_column_name <span class="op">=</span> <span class="st">'RL_norm'</span>,</span>
<span>    total_pressure_column_name <span class="op">=</span> <span class="st">'total_pressure'</span>,</span>
<span>    vcmax_norm_column_name <span class="op">=</span> <span class="st">'Vcmax_norm'</span>,</span>
<span>    vpmax_norm_column_name <span class="op">=</span> <span class="st">'Vpmax_norm'</span>,</span>
<span>    hard_constraints <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    perform_checks <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    return_exdf <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-exdf-obj">exdf_obj<a class="anchor" aria-label="anchor" href="#arg-exdf-obj"></a></dt>
<dd><p>An <code>exdf</code> object.</p></dd>


  <dt id="arg-alpha-psii">alpha_psii<a class="anchor" aria-label="anchor" href="#arg-alpha-psii"></a></dt>
<dd><p>The fraction of photosystem II activity in the bundle sheath
    (<code>dimensionless</code>). If <code>alpha_psii</code> is not a number, then there
    must be a column in <code>exdf_obj</code> called <code>alpha_psii</code> with
    appropriate units. A numeric value supplied here will overwrite the values
    in the <code>alpha_psii</code> column of <code>exdf_obj</code> if it exists.</p></dd>


  <dt id="arg-gbs">gbs<a class="anchor" aria-label="anchor" href="#arg-gbs"></a></dt>
<dd><p>The bundle sheath conductance to CO2 in <code>mol m^(-2) s^(-1) bar^(-1)</code>.
    If <code>gbs</code> is not a number, then there must be a column in
    <code>exdf_obj</code> called <code>gbs</code> with appropriate units. A numeric value
    supplied here will overwrite the values in the <code>gbs</code> column of
    <code>exdf_obj</code> if it exists.</p></dd>


  <dt id="arg-j-at-">J_at_25<a class="anchor" aria-label="anchor" href="#arg-j-at-"></a></dt>
<dd><p>The electron transport rate at 25 degrees C, expressed in
    <code>micromol m^(-2) s^(-1)</code>. Note that this is _not_ <code>Jmax</code>, and in
    general will depend on the incident photosynthetically active flux density.
    If <code>J_at_25</code> is not a number, then there must be a column in
    <code>exdf_obj</code> called <code>J_at_25</code> with appropriate units. A numeric
    value supplied here will override the values in the <code>J_at_25</code> column of
    <code>exdf_obj</code> if it exists.</p></dd>


  <dt id="arg-rl-at-">RL_at_25<a class="anchor" aria-label="anchor" href="#arg-rl-at-"></a></dt>
<dd><p>The total rate of mitochondrial respiration across the mesophyll and bundle
    sheath at 25 degrees C, expressed in <code>micromol m^(-2) s^(-1)</code>. If
    <code>RL_at_25</code> is not a number, then there must be a column in
    <code>exdf_obj</code> called <code>RL_at_25</code> with appropriate units. A numeric
    value supplied here will overwrite the values in the <code>RL_at_25</code> column
    of <code>exdf_obj</code> if it exists.</p></dd>


  <dt id="arg-rm-frac">Rm_frac<a class="anchor" aria-label="anchor" href="#arg-rm-frac"></a></dt>
<dd><p>The fraction of the total mitochondrial respiration that occurs in the
    mesophyll. If <code>Rm_frac</code> is not a number, then there must be a column in
    <code>exdf_obj</code> called <code>Rm_frac</code> with appropriate units. A numeric
    value supplied here will overwrite the values in the <code>Rm_frac</code> column
    of <code>exdf_obj</code> if it exists.</p></dd>


  <dt id="arg-vcmax-at-">Vcmax_at_25<a class="anchor" aria-label="anchor" href="#arg-vcmax-at-"></a></dt>
<dd><p>The maximum rate of rubisco carboxylation at 25 degrees C, expressed in
    <code>micromol m^(-2) s^(-1)</code>. If <code>Vcmax_at_25</code> is not a number, then
    there must be a column in <code>exdf_obj</code> called <code>Vcmax_at_25</code> with
    appropriate units. A numeric value supplied here will overwrite the values
    in the <code>Vcmax_at_25</code> column of <code>exdf_obj</code> if it exists.</p></dd>


  <dt id="arg-vpmax-at-">Vpmax_at_25<a class="anchor" aria-label="anchor" href="#arg-vpmax-at-"></a></dt>
<dd><p>The maximum rate of PEP carboxylase activity at 25 degrees C, expressed in
    <code>micromol m^(-2) s^(-1)</code>. If <code>Vpmax_at_25</code> is not a number, then
    there must be a column in <code>exdf_obj</code> called <code>Vpmax_at_25</code> with
    appropriate units. A numeric value supplied here will overwrite the values
    in the <code>Vpmax_at_25</code> column of <code>exdf_obj</code> if it exists.</p></dd>


  <dt id="arg-vpr">Vpr<a class="anchor" aria-label="anchor" href="#arg-vpr"></a></dt>
<dd><p>The rate of PEP carboxylase regeneration, expressed in
    <code>micromol m^(-2) s^(-1)</code>. If <code>Vpr</code> is not a number, then there
    must be a column in <code>exdf_obj</code> called <code>Vpr</code> with appropriate
    units. A numeric value supplied here will overwrite the values in the
    <code>Vpr</code> column of <code>exdf_obj</code> if it exists.</p></dd>


  <dt id="arg-x-etr">x_etr<a class="anchor" aria-label="anchor" href="#arg-x-etr"></a></dt>
<dd><p>The fraction of whole-chain electron transport occurring in the mesophyll
    (dimensionless). See Equation 29 from S. von Caemmerer (2021).</p></dd>


  <dt id="arg-ao-column-name">ao_column_name<a class="anchor" aria-label="anchor" href="#arg-ao-column-name"></a></dt>
<dd><p>The name of the column in <code>exdf_obj</code> that contains the dimensionless
    ratio of solubility and diffusivity of O2 to CO2.</p></dd>


  <dt id="arg-gamma-star-column-name">gamma_star_column_name<a class="anchor" aria-label="anchor" href="#arg-gamma-star-column-name"></a></dt>
<dd><p>The name of the column in <code>exdf_obj</code> that contains the dimensionless
    <code>gamma_star</code> values.</p></dd>


  <dt id="arg-j-norm-column-name">j_norm_column_name<a class="anchor" aria-label="anchor" href="#arg-j-norm-column-name"></a></dt>
<dd><p>The name of the column in <code>exdf_obj</code> that contains the normalized
    <code>Jmax</code> values (with units of
    <code>normalized to Jmax at 25 degrees C</code>).</p></dd>


  <dt id="arg-kc-column-name">kc_column_name<a class="anchor" aria-label="anchor" href="#arg-kc-column-name"></a></dt>
<dd><p>The name of the column in <code>exdf_obj</code> that contains the Michaelis-Menten
    constant for rubisco carboxylation in <code>microbar</code>.</p></dd>


  <dt id="arg-ko-column-name">ko_column_name<a class="anchor" aria-label="anchor" href="#arg-ko-column-name"></a></dt>
<dd><p>The name of the column in <code>exdf_obj</code> that contains the Michaelis-Menten
    constant for rubisco oxygenation in <code>mbar</code>.</p></dd>


  <dt id="arg-kp-column-name">kp_column_name<a class="anchor" aria-label="anchor" href="#arg-kp-column-name"></a></dt>
<dd><p>The name of the column in <code>exdf_obj</code> that contains the Michaelis-Menten
    constant for PEP carboxylase carboxylation in <code>microbar</code>.</p></dd>


  <dt id="arg-oxygen-column-name">oxygen_column_name<a class="anchor" aria-label="anchor" href="#arg-oxygen-column-name"></a></dt>
<dd><p>The name of the column in <code>exdf_obj</code> that contains the concentration
    of O2 in the ambient air, expressed as a percentage (commonly 21% or 2%);
    the units must be <code>percent</code>.</p></dd>


  <dt id="arg-pcm-column-name">pcm_column_name<a class="anchor" aria-label="anchor" href="#arg-pcm-column-name"></a></dt>
<dd><p>The name of the column in <code>exdf_obj</code> that contains the partial pressure
    of CO2 in the mesophyll, expressed in <code>microbar</code>.</p></dd>


  <dt id="arg-qin-column-name">qin_column_name<a class="anchor" aria-label="anchor" href="#arg-qin-column-name"></a></dt>
<dd><p>The name of the column in <code>exdf_obj</code> that contains values of the
    incident photosynthetically active flux density in
    <code>micromol m^(-2) s^(-1)</code>.</p></dd>


  <dt id="arg-rl-norm-column-name">rl_norm_column_name<a class="anchor" aria-label="anchor" href="#arg-rl-norm-column-name"></a></dt>
<dd><p>The name of the column in <code>exdf_obj</code> that contains the normalized
    <code>RL</code> values (with units of <code>normalized to RL at 25 degrees C</code>).</p></dd>


  <dt id="arg-total-pressure-column-name">total_pressure_column_name<a class="anchor" aria-label="anchor" href="#arg-total-pressure-column-name"></a></dt>
<dd><p>The name of the column in <code>exdf_obj</code> that contains the total pressure
    in <code>bar</code>.</p></dd>


  <dt id="arg-vcmax-norm-column-name">vcmax_norm_column_name<a class="anchor" aria-label="anchor" href="#arg-vcmax-norm-column-name"></a></dt>
<dd><p>The name of the column in <code>exdf_obj</code> that contains the normalized
    <code>Vcmax</code> values (with units of
    <code>normalized to Vcmax at 25 degrees C</code>).</p></dd>


  <dt id="arg-vpmax-norm-column-name">vpmax_norm_column_name<a class="anchor" aria-label="anchor" href="#arg-vpmax-norm-column-name"></a></dt>
<dd><p>The name of the column in <code>exdf_obj</code> that contains the normalized
    <code>Vpmax</code> values (with units of
    <code>normalized to Vpmax at 25 degrees C</code>).</p></dd>


  <dt id="arg-hard-constraints">hard_constraints<a class="anchor" aria-label="anchor" href="#arg-hard-constraints"></a></dt>
<dd><p>An integer numerical value indicating which types of hard constraints to
    place on the values of input parameters; see below for more details.</p></dd>


  <dt id="arg-perform-checks">perform_checks<a class="anchor" aria-label="anchor" href="#arg-perform-checks"></a></dt>
<dd><p>A logical value indicating whether to check units for the required columns.
    This should almost always be <code>TRUE</code>. The option to disable these checks
    is only intended to be used when <code><a href="fit_c4_aci.html">fit_c4_aci</a></code> calls this
    function, since performing these checks many times repeatedly slows down the
    fitting procedure.</p></dd>


  <dt id="arg-return-exdf">return_exdf<a class="anchor" aria-label="anchor" href="#arg-return-exdf"></a></dt>
<dd><p>A logical value indicating whether to return an <code>exdf</code> object. This
    should almost always be <code>TRUE</code>. The option to return a vector is mainly
    intended to be used when  <code><a href="fit_c4_aci.html">fit_c4_aci</a></code> calls this function,
    since creating an <code>exdf</code> object to return will slow down the fitting
    procedure.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>General Description of the Model</strong></p>
<p>This function generally follows Sections 4.2.1 and 4.2.2 from S. von Caemmerer
  (2000), which provides equations for calculating the enzyme-limited net
  assimilation rate <code>Ac</code>, the light- and electron-transport limited rate
  <code>Aj</code>, and the overall net assimilation rate <code>An</code> in a C4 leaf.
  (These equations are also reproduced in S. von Caemmerer (2021), although we
  use the equation numbers from the 2000 textbook here. Also note there is a
  typo in Equation 22 from the 2021 paper.) The enzyme-limited assimilation rate
  in this model is calculated according to Equation 4.21:</p>
<p><code>Ac = (-b - sqrt(b^2 - 4 * a * c)) / (2 * a)</code></p>
<p>where the parameters <code>a</code>, <code>b</code>, and <code>c</code> are determined by
  Equations 4.22, 4.23, and 4.24, respectively. These equations are fairly long,
  so we do not reproduce them here. Similarly, the light-limited rate <code>Aj</code>
  is also calculated according to a quadratic equation. Finally, the overall
  rate is calculated as the smaller of <code>Ac</code> and <code>Aj</code>:</p>
<p><code>An = min(Ac, Aj)</code></p>
<p><strong>An Approximation to the Full Equations</strong></p>
<p>The complicated equations above can be approximiated by simpler ones. For
  <code>Ac</code>, we can use Equation 4.25:</p>
<p><code>Ac = min(Vp + gbs * PCm - RLm, Vcmax - RL)</code></p>
<p>where <code>Vp</code> is the rate of PEP carboxylation, <code>gbs</code> is the bundle
  sheath conductance to CO2, <code>PCm</code> is the partial pressure of CO2 in the
  mesophyll, <code>RLm</code> is the rate of mitochondrial respiration occuring in the
  mesophyll, <code>Vcmax</code> is the maximum rate of Rubisco carboxylation, and
  <code>RL</code> is the rate of mitochondrial respiration occurring in the bundle
  sheath and mesophyll. Essentially, the first term in the equation above
  (<code>Vp + gbs * PCm - RLm</code>) can be thought of as a PEP-carboxylase-limited
  assimilation rate <code>Ap</code>, while the second term (<code>Vcmax - RL</code>) is a
  Rubisco-limited rate <code>Ar</code>.</p>
<p>The PEP carboxylation rate <code>Vp</code> is calculated according to Equation 4.19:</p>
<p><code>Vp = min(Pcm * Vpmax / (PCm + Kp), Vpr)</code></p>
<p>where <code>Vpmax</code> is the maximum rate of PEP carboxylation, <code>Kp</code> is a
  Michaelis-Menten constant for PEP carboxylation, and <code>Vpr</code> is the
  carboxylation rate when PEP carboxylase activity is limited by regeneration
  rather than carbon availability. Thus, we can see that the approximation above
  actually calculates the enzyme-limited rate as the smaller of three separate
  assimilation rates:</p>
<p><code>Ac = min(Apc, Apr, Ar)</code></p>
<p>where <code>Apc = Pcm * Vpmax / (PCm + Kp) + gbs * PCm - RLm</code> is the rate due
  to carbon-limited PEP carboxylation, <code>Apr = Vpr + gbs * PCm - RLm</code> is the
  rate due to regeneration-limited PEP carboxylation, and <code>Ar = Vcmax - RL</code>
  is the rate due to Rubisco-limited assimilation.</p>
<p>In the example at the end of this documentation page, we compare <code>Apc</code>,
  <code>Apr</code>, and <code>Ar</code> to <code>Ac</code> as calculated by Equation 4.21. From
  this example, it is clear that the approximation <code>Ac = min(Apc, Apr, Ar)</code>
  is quite accurate for low values of <code>PCm</code>, but introduces significant
  errors as <code>PCm</code> increases. Thus, while the approximation can be helpful
  for gaining an intuitive understanding of C4 photosynthesis, it should not be
  used for realistic calculations.</p>
<p>To be more precise, the approximation is only reliable when <code>Vcmax</code> is
  much larger than <code>gbs * Kc * (1 + POm / Ko)</code>, which is rarely the case;
  otherwise, the limiting value of <code>An</code> at high <code>PCm</code> will be smaller
  than <code>Ar = Vcmax - RL</code>. Conversely, if <code>gbs</code> and <code>alpha_psii</code>
  are both set to zero, then the approximation is exact.</p>
<p>For <code>Aj</code>, the simplified version is Equation 4.45:</p>
<p><code>Aj = min(x_etr * J / 2 - RLm + gbs * PCm, (1 - x_etr) * J / 3 - RL)</code></p>
<p>where <code>x_etr</code> is the fraction of whole-chain electron transport occurring
  in the mesophyll and <code>J</code> is the electron transport rate. We can therefore
  think of this equation as</p>
<p><code>Aj = min(Ajm, Ajbs)</code></p>
<p>where <code>Ajm</code> is the mesophyll light-limited rate and <code>Ajbs</code> is the
  bundle sheath light-limited rate. These are given by
  <code>Ajm = x_etr * J / 2 - RLm + gbs * PCm</code> and
  <code>(1 - x_etr) * J / 3 - RL</code> As in the case with <code>Ac</code>, this
  approximation is not exact.</p>
<p>Combining these two simplifications, we can see that the overall net
  assimilation rate can be approximated as the smallest of five potential rates:</p>
<p><code>An = min(Apc, Apr, Ar, Ajm, Ajbs)</code>.</p>
<p>Here it is very important to note that some of these potential rates have
  identical or similar dependence on <code>PCm</code>. More specifically, <code>Apr</code>
  and <code>Ajm</code> have identical dependence, as do <code>Ar</code> and <code>Ajbs</code>.
  If <code>gbs</code> is zero, all four of these rates have no dependence on
  <code>PCm</code>. Thus, from a fitting point of view, it is not usually possible to
  distinguish between these potential limiting states. For this reason, it is
  not advisable to fit more than one of <code>Vcmax</code>, <code>Vpr</code>, and
  <code>Jmax</code> when estimating parameters from an experimentally measured curve.</p>
<p><strong>Limiting Cases of the Approximate Equation</strong></p>
<p>The bundle sheath conductance <code>gbs</code> is generally very small and can be
  ignored in a simple analysis of the above equations. In that case, when
  <code>Pcm</code> is very high, the approximate equation for <code>Ac</code> simplifies
  further to:</p>
<p><code>Ac = min(Vpmax - RLm, Vpr - RLm, Vcmax - RL)</code></p>
<p>Since respiration costs are also generally much smaller than the maximum
  enzyme activity and regeneration rates, the enzyme-limited assimilation rate
  at high levels of CO2 is therefore determined by the smaller of <code>Vpmax</code>,
  <code>Vpr</code>, and <code>Vcmax</code>. As shown in Table 4.1 of the textbook,
  <code>Vpmax</code> is typically much larger than the other two rates, so light- and
  CO2-saturated assimilation in C4 leaves is usually limited by either
  <code>Vpr</code> or <code>Vcmax</code>. The exact limiting factor can depend on many
  possible variables, such as the temperature. For example, see Wang (2008).</p>
<p>At lower values of <code>PCm</code>, enzyme-limited net assimilation is determined
  by CO2-limited PEP carboxylation according to:</p>
<p><code>An = PCm * Vpmax / Kp - RLm</code></p>
<p>where we have approximated <code>gbs * PCm = 0</code> and <code>PCm + Kp = Kp</code>, as
  appropriate for small values of <code>Pcm</code>. Thus, we can see that for low CO2
  levels, assimilation is linearly related to <code>PCm</code> with a slope of
  <code>Vpmax / Kp</code> and intercept of <code>-RLm</code>.</p>
<p><strong>Respiration</strong></p>
<p>Table 4.1 from von Caemmerer (2000) suggests that <code>RL = 0.01 * Vcmax</code> and
  <code>RLm = 0.5 * RL</code>. To allow more flexibility, we allow <code>RL</code> to be
  specified independently of <code>Vcmax</code>, and we also consider the ratio of
  <code>RLm / RL = Rm_frac</code> to be a variable (so that <code>RLm</code> is calculated
  from <code>RL</code> according to <code>RLm = Rm_frac * RL</code>). If <code>Rm_frac</code> is
  set to 1, then there is no distinction between <code>RL</code> and <code>RLm</code>.</p>
<p><strong>Hard constraints:</strong></p>
<p>Most input parameters to the C4 assimilation model have hard constraints on
  their values which are set by their biochemical or physical interpretation;
  for example, <code>Vcmax</code> cannot be negative and <code>alpha_psii</code> must lie
  between 0 and 1. Yet, because of measurement noise, sometimes it is necessary
  to use values outside these ranges when fitting an A-Ci curve with
  <code><a href="fit_c4_aci.html">fit_c4_aci</a></code>. To accomodate different potential use cases, it is
  possible to selectively apply these hard constraints by specifying different
  values of the <code>hard_constraints</code> input argument:</p>
<p></p><ul><li><p><code>hard_constraints = 0</code>: Constraints are only placed on inputs
          that are user-supplied and cannot be fit, such as <code>Kc</code>.</p></li>
<li><p><code>hard_constraints = 1</code>: Includes the same constraints as when
          <code>hard_constraints</code> is 0, with the additional constraint that
          all <code>PCm</code> values must be non-negative.</p></li>
<li><p><code>hard_constraints = 2</code>: Includes the same constraints as when
          <code>hard_constraints</code> is 1, which additional constraints on the
          parameters that can be fitted. For example, <code>Vcmax_at_25</code> must be
          non-negative and <code>alpha_psii</code> must lie between 0 and 1.</p></li>
</ul><p>If any input values violate any of the specified constraints, an error message
  will be thrown.</p>
<p><strong>References</strong></p>
<p></p><ul><li><p>von Caemmerer, S. "Biochemical Models of Leaf Photosynthesis" (CSIRO
          Publishing, 2000) [<a href="https://doi.org/10.1071/9780643103405" class="external-link">doi:10.1071/9780643103405</a>
].</p></li>
<li><p>von Caemmerer, S. "Updating the steady-state model of C4
          photosynthesis." Journal of Experimental Botany 72, 6003–6017 (2021)
          [<a href="https://doi.org/10.1093/jxb/erab266" class="external-link">doi:10.1093/jxb/erab266</a>
].</p></li>
<li><p>Wang, D., Portis, A. R., Jr., Moose, S. P. &amp; Long, S. P. "Cool C4
          Photosynthesis: Pyruvate Pi Dikinase Expression and Activity
          Corresponds to the Exceptional Cold Tolerance of Carbon Assimilation
          in Miscanthus × giganteus." Plant Physiology 148, 557–567 (2008)
          [<a href="https://doi.org/10.1104/pp.108.120709" class="external-link">doi:10.1104/pp.108.120709</a>
].</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The return value depends on the value of <code>return_exdf</code>:</p><ul><li><p>If <code>return_exdf</code> is <code>TRUE</code>, the return value is an
          <code>exdf</code> object with the following columns: <code>alpha_psii</code>,
          <code>gbs</code>, <code>J_at_25</code>, <code>Jmax_tl</code>, <code>J_tl</code>,
          <code>Rm_frac</code>, <code>Vcmax_tl</code>, <code>Vpmax_tl</code>, <code>RL_tl</code>,
          <code>RLm_tl</code>, <code>Vpc</code>, <code>Vpr</code>, <code>Vp</code>, <code>Apc</code>,
          <code>Apr</code>, <code>Ap</code>, <code>Ar</code>, <code>Ajm</code>, <code>Ajbs</code>, <code>Ac</code>,
          <code>Aj</code>, <code>An</code>, and <code>c4_assimilation_msg</code>. Most of these
          are calculated as described above, while several are copies of the
          input arguments with the same name. The <code>c4_assimilation_msg</code> is
          usually blank but may contain information about any issues with the
          inputs. The category for each of these new columns is
          <code>calculate_c4_assimilation</code> to indicate that they were created
          using this function.</p></li>
<li><p>If <code>return_exdf</code> is <code>FALSE</code>, the return value is a numeric
          vector containing the calculated values of <code>An</code>.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Simulate a C4 A-Cm curve with specified leaf temperature and photosynthetic</span></span></span>
<span class="r-in"><span><span class="co"># parameters and plot the net assimilation rate.</span></span></span>
<span class="r-in"><span><span class="va">npts</span> <span class="op">&lt;-</span> <span class="fl">101</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="exdf.html">exdf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  PCm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">500</span>, length.out <span class="op">=</span> <span class="va">npts</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  Tleaf <span class="op">=</span> <span class="fl">25</span>,</span></span>
<span class="r-in"><span>  Qin <span class="op">=</span> <span class="fl">1800</span>,</span></span>
<span class="r-in"><span>  total_pressure <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  oxygen <span class="op">=</span> <span class="fl">21</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="document_variables.html">document_variables</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">inputs</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">''</span>, <span class="st">'PCm'</span>,            <span class="st">'microbar'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">''</span>, <span class="st">'Tleaf'</span>,          <span class="st">'degrees C'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">''</span>, <span class="st">'Qin'</span>,            <span class="st">'micromol m^(-2) s^(-1)'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">''</span>, <span class="st">'total_pressure'</span>, <span class="st">'bar'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">''</span>, <span class="st">'oxygen'</span>,         <span class="st">'percent'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="calculate_temperature_response.html">calculate_temperature_response</a></span><span class="op">(</span><span class="va">inputs</span>, <span class="va">c4_temperature_param_vc</span>, <span class="st">'Tleaf'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">assim</span> <span class="op">&lt;-</span> <span class="fu">calculate_c4_assimilation</span><span class="op">(</span><span class="va">inputs</span>, <span class="fl">0</span>, <span class="fl">0.003</span>, <span class="fl">250</span>, <span class="fl">1</span>, <span class="fl">0.5</span>, <span class="fl">40</span>, <span class="fl">200</span>, <span class="fl">80</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now we can plot Ac, Apr, Apc, and Ar. From this plot, we can see that</span></span></span>
<span class="r-in"><span><span class="co"># replacing the complicated quadratic equation with a simple minimum yields</span></span></span>
<span class="r-in"><span><span class="co"># very different results. Although this approximation is helpful for</span></span></span>
<span class="r-in"><span><span class="co"># understanding C4 photosythesis, it should not be used for calculations.</span></span></span>
<span class="r-in"><span><span class="fu">lattice</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">Apr</span> <span class="op">+</span> <span class="va">Apc</span> <span class="op">+</span> <span class="va">Ar</span> <span class="op">+</span> <span class="va">Ac</span> <span class="op">~</span> <span class="va">PCm</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">inputs</span>, <span class="va">assim</span><span class="op">)</span><span class="op">$</span><span class="va">main_data</span>,</span></span>
<span class="r-in"><span>  type <span class="op">=</span> <span class="st">'l'</span>,</span></span>
<span class="r-in"><span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">100</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Partial pressure of CO2 in the mesophyll ('</span>, <span class="va">inputs</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">PCm</span>, <span class="st">')'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Net CO2 assimilation rate ('</span>, <span class="va">assim</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">An</span>, <span class="st">')'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="calculate_c4_assimilation-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Likewise, we can look at Ajm, Ajbs, and Aj</span></span></span>
<span class="r-in"><span><span class="fu">lattice</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">Ajm</span> <span class="op">+</span> <span class="va">Ajbs</span> <span class="op">+</span> <span class="va">Aj</span> <span class="op">~</span> <span class="va">PCm</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">inputs</span>, <span class="va">assim</span><span class="op">)</span><span class="op">$</span><span class="va">main_data</span>,</span></span>
<span class="r-in"><span>  type <span class="op">=</span> <span class="st">'l'</span>,</span></span>
<span class="r-in"><span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">45</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Partial pressure of CO2 in the mesophyll ('</span>, <span class="va">inputs</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">PCm</span>, <span class="st">')'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Net CO2 assimilation rate ('</span>, <span class="va">assim</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">An</span>, <span class="st">')'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="calculate_c4_assimilation-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Finally, we can see whether enzyme activity or light limits overall</span></span></span>
<span class="r-in"><span><span class="co"># assimilation. In this case, assimilation is always enzyme-limited.</span></span></span>
<span class="r-in"><span><span class="fu">lattice</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">Ac</span> <span class="op">+</span> <span class="va">Aj</span> <span class="op">+</span> <span class="va">An</span> <span class="op">~</span> <span class="va">PCm</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">inputs</span>, <span class="va">assim</span><span class="op">)</span><span class="op">$</span><span class="va">main_data</span>,</span></span>
<span class="r-in"><span>  type <span class="op">=</span> <span class="st">'l'</span>,</span></span>
<span class="r-in"><span>  grid <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">40</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Partial pressure of CO2 in the mesophyll ('</span>, <span class="va">inputs</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">PCm</span>, <span class="st">')'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Net CO2 assimilation rate ('</span>, <span class="va">assim</span><span class="op">$</span><span class="va">units</span><span class="op">$</span><span class="va">An</span>, <span class="st">')'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="calculate_c4_assimilation-3.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Edward B. Lochocki.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

