<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate maximum electron transport rate — calculate_jmax • PhotoGEA</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate maximum electron transport rate — calculate_jmax"><meta name="description" content="Calculates maximum electron transport rates (Jmax) from estimates of
  the electron transport rate (J) at particular values of incident light
  (Qin).
This function is typically used after fit_c3_aci,
  fit_c3_variable_j, or fit_c4_aci is used to
  estimate values of J."><meta property="og:description" content="Calculates maximum electron transport rates (Jmax) from estimates of
  the electron transport rate (J) at particular values of incident light
  (Qin).
This function is typically used after fit_c3_aci,
  fit_c3_variable_j, or fit_c4_aci is used to
  estimate values of J."><meta property="og:image" content="https://eloch216.github.io/PhotoGEA/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    padding-top: 70px;

    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PhotoGEA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/PhotoGEA.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/analyzing_ball_berry_data.html">Analyzing Ball-Berry Data</a></li>
    <li><a class="dropdown-item" href="../articles/analyzing_c3_aci_curves.html">Analyzing C3 A-Ci Curves</a></li>
    <li><a class="dropdown-item" href="../articles/analyzing_c4_aci_curves.html">Analyzing C4 A-Ci Curves</a></li>
    <li><a class="dropdown-item" href="../articles/analyzing_gm_data.html">Analyzing Mesophyll Conductance Data</a></li>
    <li><a class="dropdown-item" href="../articles/analyzing_tdl_data.html">Analyzing TDL Data</a></li>
    <li><a class="dropdown-item" href="../articles/combining_with_other_packages.html">Combining PhotoGEA With Other Packages</a></li>
    <li><a class="dropdown-item" href="../articles/creating_your_own_processing_tools.html">Creating Your Own Processing Tools</a></li>
    <li><a class="dropdown-item" href="../articles/developing_a_data_analysis_pipeline.html">Developing a Data Analysis Pipeline</a></li>
    <li><a class="dropdown-item" href="../articles/LI6800_user_constants.html">Guide to Licor LI-6800 User Constants</a></li>
    <li><a class="dropdown-item" href="../articles/working_with_extended_data_frames.html">Working With Extended Data Frames</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/eloch216/PhotoGEA/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Calculate maximum electron transport rate</h1>

      <div class="d-none name"><code>calculate_jmax.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculates maximum electron transport rates (<code>Jmax</code>) from estimates of
  the electron transport rate (<code>J</code>) at particular values of incident light
  (<code>Qin</code>).</p>
<p>This function is typically used after <code><a href="fit_c3_aci.html">fit_c3_aci</a></code>,
  <code><a href="fit_c3_variable_j.html">fit_c3_variable_j</a></code>, or <code><a href="fit_c4_aci.html">fit_c4_aci</a></code> is used to
  estimate values of <code>J</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calculate_jmax</span><span class="op">(</span></span>
<span>    <span class="va">data_table</span>,</span>
<span>    alpha_j_at_25 <span class="op">=</span> <span class="fl">0.293</span>,</span>
<span>    theta_j_at_25 <span class="op">=</span> <span class="fl">0.979</span>,</span>
<span>    alpha_j_norm_column_name <span class="op">=</span> <span class="st">'alpha_j_norm'</span>,</span>
<span>    qin_column_name <span class="op">=</span> <span class="st">'Qin_avg'</span>,</span>
<span>    theta_j_norm_column_name <span class="op">=</span> <span class="st">'theta_j_norm'</span>,</span>
<span>    tleaf_column_name <span class="op">=</span> <span class="st">'TleafCnd_avg'</span>,</span>
<span>    <span class="va">...</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-data-table">data_table<a class="anchor" aria-label="anchor" href="#arg-data-table"></a></dt>
<dd><p>A table-like R object such as a data frame or an <code>exdf</code>.</p></dd>


  <dt id="arg-alpha-j-at-">alpha_j_at_25<a class="anchor" aria-label="anchor" href="#arg-alpha-j-at-"></a></dt>
<dd><p>The apparent quantum efficiency of electron transport <code>alpha_j</code> at 25
    degrees C (dimensionless). If <code>alpha_j_at_25</code> is not a number, then
    there must be a column in <code>data_table</code> called <code>alpha_j_at_25</code> with
    appropriate units. A numeric value supplied here will overwrite the values
    in the <code>alpha_j_at_25</code> column of <code>data_table</code> if it exists.</p></dd>


  <dt id="arg-theta-j-at-">theta_j_at_25<a class="anchor" aria-label="anchor" href="#arg-theta-j-at-"></a></dt>
<dd><p>The empirical curvature parameter <code>theta_j_at_25</code> at 25 degrees C
    (dimensionless). If <code>theta_j_at_25</code> is not a number, then there must be
    a column in <code>data_table</code> called <code>theta_j_at_25</code> with appropriate
    units. A numeric value supplied here will overwrite the values in the
    <code>theta_j_at_25</code> column of <code>data_table</code> if it exists.</p></dd>


  <dt id="arg-alpha-j-norm-column-name">alpha_j_norm_column_name<a class="anchor" aria-label="anchor" href="#arg-alpha-j-norm-column-name"></a></dt>
<dd><p>The name of the column in <code>data_table</code> that contains the normalized
    <code>alpha_j</code> values (with units of
    <code>normalized to alpha_j at 25 degrees C</code>).</p></dd>


  <dt id="arg-qin-column-name">qin_column_name<a class="anchor" aria-label="anchor" href="#arg-qin-column-name"></a></dt>
<dd><p>The name of the column in <code>data_table</code> that contains values of the
    incident photosynthetically active flux density in
    <code>micromol m^(-2) s^(-1)</code>.</p></dd>


  <dt id="arg-theta-j-norm-column-name">theta_j_norm_column_name<a class="anchor" aria-label="anchor" href="#arg-theta-j-norm-column-name"></a></dt>
<dd><p>The name of the column in <code>data_table</code> that contains the normalized
    <code>theta_j</code> values (with units of
    <code>normalized to theta_j at 25 degrees C</code>).</p></dd>


  <dt id="arg-tleaf-column-name">tleaf_column_name<a class="anchor" aria-label="anchor" href="#arg-tleaf-column-name"></a></dt>
<dd><p>The name of the column in <code>data_table</code> that contains the leaf
    temperature in units of <code>degrees C</code>.</p></dd>


  <dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Optional arguments; see below.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>Basic Requirements:</strong></p>
<p>This function requires that <code>data_table</code> contains columns called
  <code>J_at_25</code> and <code>J_tl_avg</code>, as would be included in the output from
  one of the PhotoGEA fitting functions (<code><a href="fit_c3_aci.html">fit_c3_aci</a></code>,
  <code><a href="fit_c3_variable_j.html">fit_c3_variable_j</a></code>, and <code><a href="fit_c4_aci.html">fit_c4_aci</a></code>). These will be
  used to calculate values of <code>Jmax</code> at 25 degrees C and at leaf
  temperature.</p>
<p>If any columns for the <code>J</code> confidence intervals are included in
  <code>data_table</code> (<code>J_at_25_upper</code>, <code>J_at_25_lower</code>,
  <code>J_tl_avg_upper</code>, or <code>J_tl_avg_lower</code>), the corresponding confidence
  intervals for <code>Jmax</code> will also be calculated.</p>
<p>If <code>data_table</code> is an <code><a href="exdf.html">exdf</a></code> object, units will be checked
  for any columns used in the calculations.</p>
<p><strong>Overview of Jmax Calculations:</strong></p>
<p>The potential electron transport rate going to support RuBP regeneration
  (<code>J</code>) depends on the available light energy. <code>J</code> quickly increases
  with the incident photosynthetically active photon flux density (<code>Qin</code>)
  at low light levels, gradually reaching a plateau at high values of
  <code>Qin</code>. Although other mathematical representations have been used (Walker
  et al. 2021), this dependence is typically represented as a non-rectangular
  hyperbola:</p>
<p><code>J = (I2 + Jmax - sqrt[(I2 + Jmax)^2 - 4 * theta_j * I2 * Jmax]) /
  (2 * theta_j)</code>, (Eq. 1)</p>
<p>where <code>Jmax</code> is the maximum value of <code>J</code> that would be achieved at
  infinitely large <code>Qin</code>, <code>0 &lt; theta_j &lt;= 1</code> is an empirical
  curvature parameter, and <code>I2</code> is the useful energy absorbed by
  photosystem II. In turn, <code>I2</code> is calculated by</p>
<p><code>I2 = alpha_j * Qin</code>,</p>
<p>where <code>alpha_j</code> is the apparent quantum efficiency of electron transport.
  <code>alpha_j</code> is often defined as</p>
<p><code>alpha_j = absorptance * phi_psii,max * beta_psii</code>,</p>
<p>where <code>absorptance</code> is the leaf absorptance, <code>phi_psii,max</code> is the
  maximum quantum yield of photosytem II, and <code>beta_psii</code> is the fraction
  of light energy partitioned to photosystem II.</p>
<p>Equation 1 can be understood as a "smooth minimum" of two potential rates of
  electron transport: <code>I2</code> (which increases linearly with <code>Qin</code>) and
  <code>Jmax</code> (which is independent of <code>Qin</code>). For lower light levels,
  <code>I2</code> is the smaller rate, and <code>J</code> is approximately equal to
  <code>I2</code>; for very high light levels, <code>Jmax</code> is the smaller rate, and
  <code>J</code> is approximately equal to <code>Jmax</code>. For intermediate values of
  <code>Qin</code>, <code>J</code> smoothly transitions from <code>I2</code> to <code>Jmax</code>.</p>
<p>One key property of Equation 1 is that the largest possible value of <code>J</code>
  at a given <code>Qin</code> is <code>I2</code>, which only occurs when <code>Jmax</code> is much
  larger than <code>I2</code>. In other words, the range of the function in Equation 1
  is <code>0 &lt;= J &lt;= I2</code>.</p>
<p>Equation 1 can be solved for <code>Jmax</code>, enabling calculations of <code>Jmax</code>
  from estimates of <code>J</code>:</p>
<p><code>Jmax = J * (I2 - theta_j * J) / (I2 - J)</code> (Eq. 2)</p>
<p>Because the range of the function in Equation 1 is <code>0 &lt;= J &lt;= I2</code>, the
  domain of its inverse function (defined in Equation 2) is also
  <code>0 &lt;= J &lt;= I2</code>. In other words, <code>Jmax</code> can only be calculated using
  Equation 2 when <code>J &lt; I2</code>. Otherwise, there is no value of <code>Jmax</code>
  that can reproduce the value of <code>J</code> for the given value of
  <code>alpha_j</code>. This restriction can also be derived more rigorously; see the
  <strong>Detailed algebra</strong> section below for more information.</p>
<p>If <code>J &gt;= I2</code>, the <code>calculate_jmax</code> function will return <code>NA</code>
  for the value of <code>Jmax</code>. This behavior can be bypassed by setting the
  optional input argument <code>ignore_restriction</code> to <code>TRUE</code>, but this is
  not recommended outside of pedagogical purposes. See Example 2 below for a
  demonstration of what goes wrong when Equation 2 is used for <code>J &gt;= I2</code>.</p>
<p>Note that this issue is more significant at lower light levels. For example,
  assuming a typical value of <code>alpha_j</code> (0.293), <code>I2</code> for
  <code>Qin</code> = 1800 micromol / m^2 / s would be 527.4 micromol / m^2 / s. Values
  of <code>J</code> are typically smaller than this, so an estimate of <code>Jmax</code> can
  almost always be made. But if a curve were measured at <code>Qin = 300</code>,
  <code>I2</code> would only be 87.9 micromol / m^2 / s, placing a stronger
  restriction on the values of <code>J</code> where <code>Jmax</code> can be estimated. Say
  the best-fit value of <code>J</code> was 88.9 micromol / m^2 / s for a curve
  measured with <code>Qin</code> = 300 micromol / m^2 / s; in this case, it would not
  be possible to estimate <code>Jmax</code>, potentially indicating that the assumed
  value of <code>alpha_j</code> was not correct.</p>
<p><strong>Typical values:</strong></p>
<p>According to von Caemmerer (2000), typical values of <code>absorptance</code>,
  <code>phi_psii,max</code>, and <code>beta_psii</code> are 0.85, 1 - 0.15, and 0.5,
  respectively, leading to <code>alpha_j</code> = 0.36125, and the curvature parameter
  <code>theta_j</code> is typically 0.7.</p>
<p>Bernacchi et al. (2003) reports that <code>phi_psii,max</code> is 0.6895 for
  light-adapted leaves at 25 degrees C, while <code>theta_j</code> at 25 degrees C is
  0.97875. Using this value of of <code>phi_psii,max</code> with typical values of
  absorptance and <code>beta_psii</code> results in an <code>alpha_j</code> estimate of
  0.2930375. These values, rounded to three decimal places, are used as the
  defaults when calculating <code>Jmax</code>.</p>
<p>It is not clear whether the temperture response defined in Bernacchi et al.
  (2003) is applicable to C4 leaves. For C4 leaves, it may be better to use the
  temperature-independent estimates from von Caemmerer (2000).</p>
<p><strong>Absorbed light basis:</strong></p>
<p>Values of <code>Jmax</code> can also be estimated from the absorbed
  photosynthetically active photon flux density (<code>Qabs</code>). In that case, we
  can regroup the terms in the definition of <code>I2</code> as follows:</p>
<p><code>I2 = (Qin * absorptance) * (phi_psii,max * beta_psii) = Qabs * alpha_j_abs</code>,</p>
<p>where <code>alpha_j_abs</code> is given by <code>phi_psii,max * beta_psii</code>. When
  working in this basis, the default value of <code>alpha_j</code> at 25 degrees C
  should be divided by the assumed absorptance (0.85), yielding an
  <code>alpha_j_abs</code> value of 0.345. Along with this change, it would also be
  necessary to change the name of the light column, likely to <code>Qabs_avg</code>.</p>
<p><strong>Why PhotoGEA Uses a Separate Function for Jmax:</strong></p>
<p>In principle, values of <code>Jmax</code> could be estimated by the fitting
  functions that estimate <code>J</code>: <code><a href="fit_c3_aci.html">fit_c3_aci</a></code>,
  <code><a href="fit_c3_variable_j.html">fit_c3_variable_j</a></code>, and <code><a href="fit_c4_aci.html">fit_c4_aci</a></code>. Instead,
  PhotoGEA requires users to use a separate function (<code>calculate_jmax</code>) to
  estimate <code>Jmax</code>. This serves several purposes:</p>
<p></p><ul><li><p>It highlights that estimates of <code>Jmax</code> are made using the same
          equations for C3 and C4 leaves.</p></li>
<li><p>It leaves open the possibility of other estimates of <code>Jmax</code>, such
          as those based on a rectangular hyperbola instead of the
          non-rectangular hyperbola used here.</p></li>
<li><p>It emphasizes that sometimes it is not possible to provide an estimate
          for <code>Jmax</code>, depending on the values of <code>Qin</code>,
          <code>alpha_j</code>, and <code>J</code>, because of the requirement that
          <code>J &lt; I2 = alpha_j * Qin</code>.</p></li>
</ul><p>The last point is especially important. If <code>Jmax</code> were varied during the
  fitting process, and <code>J</code> was estimated from <code>Jmax</code> using Equation 1,
  there would be a restriction on the possible values of <code>J</code> that could be
  obtained: <code>J &lt; alpha_j * Qin</code>. This could potentially bias the fitting
  results, since it may be the case that the best fit would be found for
  <code>J</code> outside this range.</p>
<p>In other words, keeping estimates of <code>Jmax</code> separate from the fitting
  process ensures that the values of <code>alpha_j</code> and <code>theta_j</code> have no
  influence on the fits or best-fit values of <code>J</code>. This is important since
  the true values of these parameters for a particular leaf are difficult or
  impossible to determine.</p>
<p><strong>Detailed algebra:</strong></p>
<p>Here we will solve Equation 1 for <code>Jmax</code>, arriving at Equation 2. This
  algebra is reproduced here to highlight the important restriction that
  <code>J &lt; I2</code>.</p>
<p>First, multiply both sides of Equation 1 by <code>2 * theta_j</code>:</p>
<p><code>2 * theta_j * J = I2 + Jmax - sqrt[(I2 + Jmax)^2 - 4 * theta_j * I2 * Jmax]</code>. (Eq. 3)</p>
<p>Next, isolate the square root term on one side:</p>
<p><code>I2 + Jmax - 2 * theta_j * J = sqrt[(I2 + Jmax)^2 - 4 * theta_j * I2 * Jmax]</code>. (Eq. 4)</p>
<p>A key point here is that the right hand side cannot be negative, since the
  square root of a real number is never negative. Thus, the left hand side also
  cannot be negative. In other words,</p>
<p><code>I2 + Jmax - 2 * theta_j * J &gt;= 0</code>. (Eq. 5)</p>
<p>We will return to this restriction later. For now, we square both sides of
  Equation 4:</p>
<p><code>(I2 + Jmax)^2 - 4 * theta_j * J * (I2 + Jmax) + 4 * theta_j^2 * J^2 =
  (I2 + Jmax)^2 - 4 * theta_j * I2 * Jmax</code>. (Eq. 6)</p>
<p>The term <code>(I2 + Jmax)^2</code> appears on both sides of Equation 6 and can
  therefore be cancelled out. Grouping the remaining terms that contain
  <code>Jmax</code> on one side, we have:</p>
<p><code>4 * theta_j * Jmax * (I2 - J) = 4 * theta_j * J * (I2 - theta_j * J)</code> (Eq. 7)</p>
<p>Finally, provided that <code>I2 - J</code> is not zero (in other words, that
  <code>I2</code> is not equal to <code>J</code>), we can divide both sides of Equation 7 by
  <code>4 * theta_j * (I2 - J)</code> to obtain Equation 2 above.</p>
<p>Now, we can use this expression (Equation 2) to replace <code>Jmax</code> in
  Equation 5:</p>
<p><code>I2 + J * (I2 - theta_j * J) / (I2 - J) - 2 * theta_j * J &gt;= 0</code>. (Eq. 8)</p>
<p>This can be converted to a single ratio as follows:</p>
<p><code>[(I2 - 2 * theta_j * J) * (I2 - J) + J * (I2 - theta_j * J)] / (I2 - J) &gt;= 0</code>. (Eq. 9)</p>
<p>Multiplying out the factors in the numerator and collecting like terms,
  Equation 9 becomes</p>
<p><code>[I2^2 - 2 * theta_j * I2 * J + theta_j * J^2] / (I2 - J) &gt;= 0</code>. (Eq. 10)</p>
<p>Because <code>theta_j</code> must lie between 0 and 1, <code>theta_j^2</code> is always
  less than or equal to <code>theta_j</code>. This allows us to place a lower bound on
  the value of the numerator of the left hand side of Equation 10:</p>
<p><code>I2^2 - 2 * theta_j * I2 * J + theta_j * J^2 &gt;=
  I2^2 - 2 * theta_j * I2 * J + theta_j^2 * J^2</code>. (Eq. 11)</p>
<p>The right hand side of Equation 11 can be refactored:</p>
<p><code>I2^2 - 2 * theta_j * I2 * J + theta_j * J^2 &gt;=
  (I2 - theta_j J)^2</code>. (Eq. 12)</p>
<p>The right hand side of Equation 12 can never be negative, so from this we can
  also conclude that the numerator of the left hand side of Equation 10 can also
  never be negative. Thus, the inequality in Equation 10 is satisfied whenever
  its denominator is positive. In other words, whenever <code>I2 - J &gt; 0</code>, or,
  equivalently, <code>J &lt; I2</code>.</p>
<p>Thus, we have shown that Equation 2 holds whenever <code>J &lt; I2</code>, since, when
  this inequality is satisfied, Equation 5 is also satisfied.</p>
<p>Although we do not do so here, it can be shown that when <code>I2 &lt; J</code>, the
  value of <code>Jmax</code> that would be calculated by Equation 2 is the inverse of</p>
<p><code>J = (I2 + Jmax + sqrt[(I2 + Jmax)^2 - 4 * theta_j * I2 * Jmax]) /
  (2 * theta_j)</code> (Eq. 13)</p>
<p>rather than the inverse of Equation 1. Note the difference: in Equation 13,
  the square root term is added to <code>I2 + Jmax</code> rather than subtracted. This
  is a "smooth maximum" function, rather than a smooth minimum. In fact,
  whenever <code>I2 &gt; Jmax</code>, Equation 13 would predict <code>J &gt; Jmax</code>, clearly
  a nonsensical result. Likewise, the inverse of the function in Equation 13
  would predict some values of <code>Jmax</code> that are smaller than <code>J</code>.
  Example 2 below shows that it can even return negative values of <code>Jmax</code>,
  which is clearly not reasonable from a biological perspective.</p>
<p><strong>References:</strong></p>
<p></p><ul><li><p>von Caemmerer, S. "Biochemical Models of Leaf Photosynthesis" (CSIRO
          Publishing, 2000) [<a href="https://doi.org/10.1071/9780643103405" class="external-link">doi:10.1071/9780643103405</a>
].</p></li>
<li><p>Walker, A. P. et al. "Multi-hypothesis comparison of Farquhar and
          Collatz photosynthesis models reveals the unexpected influence of
          empirical assumptions at leaf and global scales." Global Change
          Biology 27, 804–822 (2021) [<a href="https://doi.org/10.1111/gcb.15366" class="external-link">doi:10.1111/gcb.15366</a>
].</p></li>
<li><p>Bernacchi, C. J., Pimentel, C. &amp; Long, S. P. "In vivo temperature
          response functions of parameters required to model RuBP-limited
          photosynthesis" Plant, Cell &amp; Environment 26, 1419–1430 (2003)
          [<a href="https://doi.org/10.1046/j.0016-8025.2003.01050.x" class="external-link">doi:10.1046/j.0016-8025.2003.01050.x</a>
].</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The return value is a table based on <code>data_table</code> that includes several
  new columns: <code>I2_at_25</code>, <code>Jmax_at_25</code>, <code>Jmax_at_25_msg</code>,
  <code>I2_tl</code>, <code>Jmax_tl</code>, and <code>Jmax_tl_msg</code>. The <code>_msg</code> columns
  indicate when the error condition <code>J &gt;= I2</code> has occurred.</p>
<p>If <code>J</code> confidence intervals were provided in the inputs, then there will
  be correspoding columns for the related <code>Jmax</code>, and <code>msg</code> values;
  for example, <code>Jmax_at_25_lower</code> and <code>Jmax_at_25_lower_msg</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Example 1: Estimating Jmax after fitting several C3 A-Ci curves</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Read an example Licor file included in the PhotoGEA package</span></span></span>
<span class="r-in"><span><span class="va">licor_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="read_gasex_file.html">read_gasex_file</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="PhotoGEA_example_file_path.html">PhotoGEA_example_file_path</a></span><span class="op">(</span><span class="st">'c3_aci_1.xlsx'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define a new column that uniquely identifies each curve</span></span></span>
<span class="r-in"><span><span class="va">licor_file</span><span class="op">[</span>, <span class="st">'species_plot'</span><span class="op">]</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">licor_file</span><span class="op">[</span>, <span class="st">'species'</span><span class="op">]</span>, <span class="st">'-'</span>, <span class="va">licor_file</span><span class="op">[</span>, <span class="st">'plot'</span><span class="op">]</span> <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Organize the data; we will need average values of leaf temperature and</span></span></span>
<span class="r-in"><span><span class="co"># incident PPFD in order to calculate Jmax later</span></span></span>
<span class="r-in"><span><span class="va">licor_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="organize_response_curve_data.html">organize_response_curve_data</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">licor_file</span>,</span></span>
<span class="r-in"><span>    <span class="st">'species_plot'</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">10</span>, <span class="fl">16</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="st">'CO2_r_sp'</span>,</span></span>
<span class="r-in"><span>    columns_to_average <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'TleafCnd'</span>, <span class="st">'Qin'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate the total pressure in the Licor chamber</span></span></span>
<span class="r-in"><span><span class="va">licor_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="calculate_total_pressure.html">calculate_total_pressure</a></span><span class="op">(</span><span class="va">licor_file</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate temperature-dependent values of C3 photosynthetic parameters</span></span></span>
<span class="r-in"><span><span class="va">licor_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="calculate_temperature_response.html">calculate_temperature_response</a></span><span class="op">(</span><span class="va">licor_file</span>, <span class="va">c3_temperature_param_bernacchi</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># For these examples, we will use a faster (but sometimes less reliable)</span></span></span>
<span class="r-in"><span><span class="co"># optimizer so they run faster</span></span></span>
<span class="r-in"><span><span class="va">optimizer</span> <span class="op">&lt;-</span> <span class="fu"><a href="optimizers.html">optimizer_nmkb</a></span><span class="op">(</span><span class="fl">1e-7</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fit all curves in the data set (it is more common to do this)</span></span></span>
<span class="r-in"><span><span class="va">aci_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="consolidate.html">consolidate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">licor_file</span>,</span></span>
<span class="r-in"><span>  <span class="va">licor_file</span><span class="op">[</span>, <span class="st">'species_plot'</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  <span class="va">fit_c3_aci</span>,</span></span>
<span class="r-in"><span>  Ca_atmospheric <span class="op">=</span> <span class="fl">420</span>,</span></span>
<span class="r-in"><span>  optim_fun <span class="op">=</span> <span class="va">optimizer</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate temperature-dependent values of Jmax-related parameters</span></span></span>
<span class="r-in"><span><span class="va">aci_results</span><span class="op">$</span><span class="va">parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="calculate_temperature_response.html">calculate_temperature_response</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">aci_results</span><span class="op">$</span><span class="va">parameters</span>,</span></span>
<span class="r-in"><span>    <span class="va">jmax_temperature_param_bernacchi</span>,</span></span>
<span class="r-in"><span>    <span class="st">'TleafCnd_avg'</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate Jmax</span></span></span>
<span class="r-in"><span><span class="va">aci_results</span><span class="op">$</span><span class="va">parameters</span> <span class="op">&lt;-</span> <span class="fu">calculate_jmax</span><span class="op">(</span><span class="va">aci_results</span><span class="op">$</span><span class="va">parameters</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Print a few columns</span></span></span>
<span class="r-in"><span><span class="va">col_to_view</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'species_plot'</span>, <span class="st">'J_at_25'</span>, <span class="st">'J_tl_avg'</span>, <span class="st">'Jmax_at_25'</span>, <span class="st">'Jmax_tl'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">aci_results</span><span class="op">$</span><span class="va">parameters</span><span class="op">[</span>, <span class="va">col_to_view</span>, <span class="cn">TRUE</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Converting an `exdf` object to a `data.frame` before printing</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   species_plot [NA] (NA) J_at_25 [fit_c3_aci] (micromol m^(-2) s^(-1))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1           soybean - 5a                                      190.8864</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2            tobacco - 1                                      231.7749</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3            tobacco - 2                                      206.4820</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   J_tl_avg [fit_c3_aci] (micromol m^(-2) s^(-1))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                                       268.1504</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                                       319.2523</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                                       285.9199</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Jmax_at_25 [calculate_jmax] (micromol m^(-2) s^(-1))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                                             192.8230</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                                             234.9598</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                                             208.8411</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Jmax_tl [calculate_jmax] (micromol m^(-2) s^(-1))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                                          275.6992</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                                          331.3579</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                                          294.7020</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Example 2: Illustrating the importance of requiring I2 &gt; J</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define a data frame with input values</span></span></span>
<span class="r-in"><span><span class="va">npts</span> <span class="op">&lt;-</span> <span class="fl">200</span></span></span>
<span class="r-in"><span><span class="va">J_seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">npts</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">jmax_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  J_at_25 <span class="op">=</span> <span class="va">J_seq</span>,</span></span>
<span class="r-in"><span>  J_tl_avg <span class="op">=</span> <span class="va">J_seq</span>,</span></span>
<span class="r-in"><span>  alpha_j_norm <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  Qin_avg <span class="op">=</span> <span class="fl">300</span>,</span></span>
<span class="r-in"><span>  theta_j_norm <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  TleafCnd_avg <span class="op">=</span> <span class="fl">25</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate Jmax values, overriding the default behavior so that values of Jmax</span></span></span>
<span class="r-in"><span><span class="co"># are returned even when I2 &lt; J.</span></span></span>
<span class="r-in"><span><span class="va">jmax_df</span> <span class="op">&lt;-</span> <span class="fu">calculate_jmax</span><span class="op">(</span><span class="va">jmax_df</span>, ignore_restriction <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot the Jmax values, distinguishing between cases where J &lt; I2 and where</span></span></span>
<span class="r-in"><span><span class="co"># J &gt; I2. Here we can see that when J &gt; I2, values of Jmax are smaller than J,</span></span></span>
<span class="r-in"><span><span class="co"># and can even be negative, which is clearly unreasonable from a biological</span></span></span>
<span class="r-in"><span><span class="co"># perspective. To highlight these considerations, J = I2 is plotted as a dashed</span></span></span>
<span class="r-in"><span><span class="co"># black line, Jmax = J is plotted as a black long-dashed line, and Jmax = 0 is</span></span></span>
<span class="r-in"><span><span class="co"># plotted as a solid black line.</span></span></span>
<span class="r-in"><span><span class="va">ymin</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">50</span></span></span>
<span class="r-in"><span><span class="va">ymax</span> <span class="op">&lt;-</span> <span class="fl">250</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">xmin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">J_seq</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">xmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">J_seq</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">I2</span> <span class="op">&lt;-</span> <span class="va">jmax_df</span><span class="op">$</span><span class="va">I2_at_25</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">jmax_df</span><span class="op">$</span><span class="va">Jmax_at_25_msg</span><span class="op">[</span><span class="va">jmax_df</span><span class="op">$</span><span class="va">Jmax_at_25_msg</span> <span class="op">==</span> <span class="st">''</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'J &lt; I2'</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">lattice</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">Jmax_at_25</span> <span class="op">~</span> <span class="va">J_at_25</span>,</span></span>
<span class="r-in"><span>  group <span class="op">=</span> <span class="va">Jmax_at_25_msg</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">jmax_df</span>,</span></span>
<span class="r-in"><span>  auto <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  type <span class="op">=</span> <span class="st">'l'</span>,</span></span>
<span class="r-in"><span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">xmin</span>, <span class="va">xmax</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ymin</span>, <span class="va">ymax</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  xlab <span class="op">=</span> <span class="st">'J (micromol / m^2 / s)'</span>,</span></span>
<span class="r-in"><span>  ylab <span class="op">=</span> <span class="st">'Jmax (micromol / m^2 / s)'</span>,</span></span>
<span class="r-in"><span>  panel <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu">lattice</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/llines.html" class="external-link">panel.lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">xmin</span>, <span class="va">xmax</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu">lattice</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/llines.html" class="external-link">panel.lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ymin</span>, <span class="va">ymax</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">I2</span>, <span class="va">I2</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu">lattice</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/llines.html" class="external-link">panel.lines</a></span><span class="op">(</span><span class="va">J_seq</span> <span class="op">~</span> <span class="va">J_seq</span>, lty <span class="op">=</span> <span class="fl">5</span>, col <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu">lattice</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/panel.xyplot.html" class="external-link">panel.xyplot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="calculate_jmax-1.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Edward B. Lochocki, Coralie E. Salesse-Smith, Justin M. McGrath.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

